@{
    ViewBag.Title = "CreateCOLPA";
}
<style>
    #bankaccount-error {
        margin-left: 50px;
    }

    #contact-error {
        margin-left: 50px;
    }

    .row {
        margin-right: 0px !important;
        margin-left: 0px !important;
    }

    .answerList {
        margin-bottom: 15px;
    }

    ol, ul {
        list-style: none;
    }

    .answerList li:first-child {
        border-top-width: 0;
    }

    .answerList li {
        margin: 10px;
        padding: 3px 0;
        height: 100px;
        width: 25%
    }

    .answerList label {
        height: 100px;
        display: block;
        padding: 6px;
        border-radius: 6px;
        border: solid 1px #dde7e8;
        font-weight: 400;
        font-size: 13px;
        cursor: pointer;
        font-family: Arial, sans-serif;
    }

        .answerList label:hover {
            background-color: #dbeffa !important;
        }

    input[type=checkbox], input[type=radio] {
        margin: 4px 0 0;
        margin-top: 1px;
        line-height: normal;
    }

    @@media(max-width :585px) {
        .answerList li {
            margin: 10px;
            padding: 3px 0;
            height: 100px;
            width: 85%
        }
    }
</style>
<div class="row">
    <div class="col-md-12">
        <div class="wizard">
            <div class="wizard-inner">
                <div class="connecting-line"></div>
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active">
                        <a href="#step1" data-toggle="tab" aria-controls="step1" role="tab" title="Step 1">
                            <span class="round-tab">
                                <i class="fa fa-edit"></i>
                            </span>
                            <span class="span-title">สร้าง COL</span>
                        </a>
                    </li>
                    <li role="presentation" class="disabled">
                        <a href="#step2" data-toggle="tab" aria-controls="step2" role="tab" title="Step 2">
                            <span class="round-tab">
                                <i class="fa fa-edit"></i>
                            </span>
                            <span class="span-title">สร้าง CL</span>
                        </a>
                    </li>
                    <li role="presentation" class="disabled">
                        <a href="#complete" data-toggle="tab" aria-controls="complete" role="tab" title="Complete">
                            <span class="round-tab">
                                <i class="fa fa-check"></i>
                            </span>
                            <span class="span-title" style="left:-12px !important">รายละเอียดบัญชี</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="tab-content">
                @* step 1 *@
                <div class="tab-pane active" role="tabpanel" id="step1">
                    <section id="section_main">
                        <form id="form_main">
                            <div class="box-body">
                                <div class="row pl-2">
                                    <div class="col-xs-12 col-sm-12 col-md-4">
                                        <div class="form-group">
                                            <label>ประเภทเคลม :</label>
                                            <select class="form-control select2" id="ddlClaimType" style="width:100%">

                                                @foreach (var item in @ViewBag.ProductType)
                                                {
                                                    <option value=@item.ProductType_ID>  @item.ProductTypeDetail </option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pl-2">
                                    <div class="col-xs-12 col-sm-12 col-md-4">
                                        <div class="form-group">
                                            <label class="control-label">ผู้ให้บริการ :</label>
                                            <select name="txtSearchService" id="txtSearchService" class="form-control js-search-person" required="required" style="width:100%"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pl-2">
                                    <div class="col-xs-12 col-sm-12 col-md-4">
                                        <div class="form-group">
                                            <label class="control-label">ชื่อเจ้าของรถ :</label>
                                            <select name="txtZebraCarOwnerID" id="txtZebraCarOwnerID" class="form-control js-search-person-1" required="required" style="width:100%"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pl-2">
                                    <div class="col-xs-12 col-sm-12 col-md-4">
                                        <div class="form-group">
                                            <label class="control-label">หมายเหตุ :</label>
                                            <textarea name="txtRemark" id="txtRemark" class="form-control" style="resize:none"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form id="form_searchschool">
                            <div class="box-body">
                                <div class="box-group">
                                    <div class="box box-primary box-solid">
                                        <div class="box-header with-border">
                                            <h3 class="box-title">ค้นหารายการ</h3>
                                        </div>
                                        <div class="box-body">
                                            <div class="box-group">
                                                <div class="row">
                                                    <div class="col-xs-12  col-md-4">
                                                        <label>ปีการศึกษา :</label>
                                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlYear">
                                                            @{
                                                                foreach (var item in ViewBag.CodeGroupPAYear)
                                                                {
                                                                    <option value="@item.Detail">@item.Detail</option>
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-12  col-md-4">
                                                        <label>จังหวัด :</label>
                                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlProvinceSchool" checkNA="checkNA">

                                                            <option value="-1">--โปรดระบุ--</option>

                                                            @{
                                                                foreach (var item in ViewBag.Province)
                                                                {
                                                                    <option value="@item.Code">@item.Detail</option>
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-12 col-md-8">
                                                        <label>สถานศึกษา :</label>
                                                        <input class="form-control" style="width: 100%;" id="txtSchoolSearch" name="txtSchoolSearch" placeholder="ชื่อสถานศึกษา">
                                                    </div>
                                                    <div class="col-xs-12 col-md-3" style="padding-top:25px;">
                                                        <button class="btn btn-primary" type="button" id="btnSearchSchool" style="width:50%">ค้นหา</button>
                                                    </div>
                                                </div>
                                                <div class="box box-primary" style="margin-top:9px">
                                                    <div class="box-header with-border">
                                                        <h3 class="box-title">รายการ</h3>
                                                    </div>
                                                    <div class="box-body">
                                                        <div class="box-group">
                                                            <div class="row">
                                                                <div class="col-xs-12  col-md-12" style="text-align:center">
                                                                    <table id="dtSearchSchool" class="table table-bordered table-hover dataTable" role="grid">
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>No Data</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </section>
                    @* end section pa *@
                    <div class="box-footer clearfix">
                        <ul class="list-inline pull-right">
                            <li><button type="button" id="btnNext1" class="btn btn-primary next-step">ถัดไป </button></li>
                        </ul>
                    </div>
                </div>
                @* step 2 *@
                <div class="tab-pane" role="tabpanel" id="step2">
                    <div class="box-body">
                        <div class="row pl-2 pr-2">
                            <section id="section_detail">
                                <div class="row">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">รายละเอียดเคลมออนไลน์</h3>
                                    </div>
                                    <div class="box-group">
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">ประเภทเคลม :</label>
                                                <label id="lblClaimType" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">ผู้ให้บริการ :</label>
                                                <label id="lblService" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">เจ้าของรถ :</label>
                                                <label id="lblZebraCarOwner" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">ข้อมูลสถานศึกษา</h3>
                                    </div>
                                    <div class="box-group">
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">Application ID :</label>
                                                <label id="lblApplicationID_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">ชื่อสถานศึกษา :</label>
                                                <label id="lblSchoolName_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">แผน :</label>
                                                <label id="lblProduct_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-group">
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">ครูผู้ประสาน :</label>
                                                <label id="lblContactName_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-4">
                                                <label class="control-label" for="textinput">เลขบัญชี :</label>
                                                <label id="lblContactBankAccountNo_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-2">
                                                <label class="control-label" for="textinput">ชื่อบัญชี :</label>
                                                <label id="lblContactBankAccountName_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-xs-12 col-md-2">
                                                <label class="control-label" for="textinput">ธนาคาร :</label>
                                                <label id="lblContactBank_PA" class="control-label" style="color:blue;width:100%"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <section id="section_btnAddClaim" hidden>
                                    <div class="row">
                                        <ul class="list-inline pull-right">
                                            <li><button id="btn_addclaim" type="button" class="btn btn-info"><i class="fa fa-plus-square"></i> เพิ่มรายการเคลม</button></li>
                                        </ul>
                                    </div>
                                </section>
                            </section>

                            <section id="section_claimDT">
                                <div class="row">
                                    <div class="box box-primary box-solid" style="margin-top:9px">
                                        <div class="box-header with-border">
                                            <h3 class="box-title">รายการเคลม</h3>
                                        </div>
                                        <div class="box-body">
                                            <div class="box-group">
                                                <div class="row">
                                                    <div class="col-xs-12 col-md-12" style="text-align:center">
                                                        <table id="dtClaim" class="table table-bordered table-hover dataTable" role="grid">
                                                            <tbody>
                                                                <tr>
                                                                    <td>No data</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section id="section_claimPA" hidden>
                                <div class="box-body">
                                    <div class="box-group">
                                        <div class="row">
                                            <div>
                                                <label style="font-size:2em">เพิ่มเคลมอุบัติเหตุนักเรียน</label>
                                            </div>
                                            <div class="col-xs-12 col-md-5">
                                                <input class="form-control" type="text" width="100" id="txtSearchPA" placeholder="ค้นหาโดย ชื่อ / สกุล" />
                                            </div>
                                            <div class="col-xs-12 col-md-3">
                                                <button class="btn btn-primary" type="button" id="btnSearchPA">ค้นหา</button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="box box-primary box-solid" style="margin-top:9px">
                                                <div class="box-header with-border">
                                                    <h3 class="box-title">รายการ</h3>
                                                </div>
                                                <div class="box-body">
                                                    <div class="box-group">
                                                        <div class="row">
                                                            <div id="divDTMainPA" class="col-xs-12 col-md-12" style="text-align:center">
                                                                <table id="dtMainPA" class="table table-bordered table-hover dataTable" role="grid">
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>No data</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <form id="formClaimPA">
                                            <div class="box box-primary box-solid">
                                                <div class="box-header with-border">
                                                    <h3 class="box-title">บันทึกเคลมอุบัติเหตุนักเรียน </h3>
                                                </div>
                                                <div class="box-body">
                                                    @* start *@
                                                    <div>
                                                        <ul class="nav nav-pills">
                                                            <li id="claim_t1" class="active"><a id="a_appDetail" data-toggle="pill" href="#appDetail"><h5>รายละเอียด Application</h5></a></li>
                                                            <li id="claim_t2"><a id="a_history" data-toggle="pill" href="#history"><h5>ประวัติการเคลม</h5></a></li>
                                                        </ul>
                                                        <div class="tab-content">
                                                            <div id="appDetail" style="padding-top:0px !important" class="tab-pane fade in active">
                                                                <div class="box-group">
                                                                    <div class="row">
                                                                        <div class="col-xs-12 col-md-12">
                                                                            <div class="box box-primary">
                                                                                <div class="box-header with-border">
                                                                                    <h3 class="box-title">รายละเอียด Application</h3>
                                                                                </div>
                                                                                <div class="box-body">

                                                                                    <div class="box-group">
                                                                                        <div class="row">
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>ApplicationID :</label>
                                                                                                <label class="" id="lblApplicationID" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>สถานศึกษา :</label>
                                                                                                <label class="" id="lblSchoolName" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>ชื่อ - สกุล ผู้เอาประกัน :</label>
                                                                                                <label class="" id="lblCustFullName" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <a id="lnkDetail">ดูรายละเอียด</a>
                                                                                            </div>
                                                                                        </div>

                                                                                        <div class="row">
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>วันเริ่มคุ้มครอง :</label>
                                                                                                <label class="" id="lblStartCoverDate" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>วันสิ้นสุดความคุ้มครอง :</label>
                                                                                                <label class="" id="lblEndCoverDate" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>สถานะ :</label>
                                                                                                <label class="" id="lblStatus" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                        </div>

                                                                                        <div class="row">
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>แผนประกัน :</label>
                                                                                                <label class="" id="lblProductDetail" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                            <div class="col-xs-12 col-md-3">
                                                                                                <label>วงเงินคุ้มครอง :</label>
                                                                                                <label class="" id="lblCoverage" style="color:blue;width:100%"></label>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="row">
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>วันที่เข้ารักษา :</label>
                                                                            <div class="input-group date">
                                                                                <div class="input-group-addon">
                                                                                    <i class="fa fa-calendar"></i>
                                                                                </div>
                                                                                <input type="text" class="form-control pull-right dpk" id="dtpDateHappen_PA" name="dtpDateHappen_PA" data-provide="datepicker" data-date-language="th-th" required>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>วันที่ออก รพ. :</label>
                                                                            <div class="input-group date">
                                                                                <div class="input-group-addon">
                                                                                    <i class="fa fa-calendar"></i>
                                                                                </div>
                                                                                <input type="text" class="form-control pull-right dpk" id="dtpNoticeDate_PA" name="dtpNoticeDate_PA" data-provide="datepicker" data-date-language="th-th" required>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>ประเภทการรักษา :</label>
                                                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlClaimType_PA" name="ddlClaimType_PA" checkNA="checkNA"></select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>จังหวัดสถานพยาบาล :</label>
                                                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlProvinceHospital_PA" name="ddlProvinceHospital_PA" checkNA="checkNA">
                                                                                <option value="-1">--โปรดระบุ--</option>
                                                                                @{
                                                                                    foreach (var item in ViewBag.Province)
                                                                                    {
                                                                                        <option value="@item.Code">@item.Detail</option>
                                                                                    }

                                                                                }
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-xs-12 col-md-6">
                                                                            <label>สถานพยาบาล :</label>
                                                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlHospitalName_PA" name="ddlHospitalName_PA" required></select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>สถานะ :</label>
                                                                            <select class="form-control select2" style="width:100%" id="ddlStatusClaim" name="ddlStatusClaim" disabled>
                                                                                @{
                                                                                    foreach (var item in ViewBag.StatusClaim)
                                                                                    {
                                                                                        <option value="@item.Code">@item.Detail</option>
                                                                                    }

                                                                                }
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-xs-12 col-md-3" id="divCancelCause" hidden>
                                                                            <label>สาเหตุการปฏิเสธ :</label>
                                                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" disabled id="ddlCancelCause" required></select>
                                                                        </div>
                                                                        <div class="col-xs-12 col-md-3">
                                                                            <label>ยอดเงิน :</label>
                                                                            <input type="text" class="form-control" id="txtAmount" name="txtAmount" style="color:blue;width:100%" required="required">
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-xs-12 col-md-9">
                                                                            <label>หมายเหตุ(อุบัติเหตุ/อาการ):</label>
                                                                            <input class="form-control" type="text" id="txtAccidentDetail" name="txtAccidentDetail" required="required">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="history" style="padding-top:0px !important" class="tab-pane fade">
                                                                <div class="box-body">
                                                                    <div class="box-group">
                                                                        <div class="row">
                                                                            <div class="col-xs-12 col-md-12" style="text-align:center">
                                                                                <table id="dtHistory" class="table table-bordered table-hover dataTable display nowrap" style="width:100%" role="grid">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>เลขที่เคลม</th>
                                                                                            <th>วันที่เข้า รพ.</th>
                                                                                            <th>สถานพยาบาล</th>
                                                                                            <th>สาเหตุอุบัติเหตุ</th>
                                                                                            <th>ChiefComplain</th>
                                                                                            <th>วันที่เคลม</th>
                                                                                            <th>สถานะ</th>
                                                                                            <th>รายละเอียด</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody id="bodyHistory"></tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    @* end *@
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                    <section id="section_btnNextAcc">
                        <div class="box-footer clearfix">
                            <ul class="list-inline pull-right">
                                <li><button id="btn_prev2" type="button" class="btn btn-default prev-step">ย้อนกลับ</button></li>
                                <li><button id="btnNext2" type="button" class="btn btn-primary next-step">ถัดไป</button></li>
                                <li><button id="btnNextAcc" type="button" class="btn btn-primary next-step">บันทึกและระบุบัญชีรับสินไหม</button></li>
                            </ul>
                        </div>
                    </section>
                </div>
                @* step 3 *@
                <div class="tab-pane" role="tabpanel" id="complete">
                    <form id="formBankAccount">
                        <div class="box-body">
                            <div class="box-group">
                                <div class="row">
                                    <div class="col-xs-12 col-md-12">
                                        <label style="font-size:2em"> บัญชีรับสินไหม :</label>
                                    </div>
                                </div>
                                <div class="row radio-err">
                                    <ul class="answerList" id="banklist"></ul>
                                    <div style="padding-left: 50px;">
                                        <!-- Button trigger modal -->
                                        <button id="btnAddBankAccount" type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">
                                            <i class="fa fa-plus-square"></i> เพิ่มบัญชีรับสินไหมใหม่
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <form id="formContact">
                        <div class="box-body">
                            <div class="box-group">
                                <div class="row">
                                    <div class="col-xs-12 col-md-12">
                                        <label style="font-size:2em"> เบอร์โทรผู้ติดต่อ :</label>
                                    </div>
                                </div>
                                <div class="row radio-err">
                                    <ul class="answerList" id="contactlist"></ul>
                                    <div style="padding-left: 50px;">
                                        <!-- Button trigger modal -->
                                        <button id="btnAddContact" type="button" class="btn btn-info" data-toggle="modal" data-target="#myModalContact">
                                            <i class="fa fa-plus-square"></i> เพิ่มเบอร์โทรผู้ติดต่อใหม่
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <hr />
                    <div class="box-body">
                        <div class="box-group">
                            <div class="row">
                                <div class="col-xs-12 col-md-12">
                                    <label style="font-size:2em">แนบเอกสารหน้าบัญชีรับสินไหมใหม่ :</label>
                                </div>
                            </div>
                            <div class="box-body">
                                <div class="box-group">
                                    <div class="row">
                                        <div id="divDTMain" class="col-xs-12 col-md-12" style="text-align:center">
                                            <table id="dtDocument" class="table table-bordered table-hover dataTable display nowrap" style="width:100%" role="grid">
                                                <thead>
                                                    <tr>
                                                        <th>ประเภท</th>
                                                        <th>แนบเอกสาร</th>
                                                        <th>เรียกดู</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-footer clearfix">
                        <ul class="list-inline pull-right">
                            <li><button type="button" class="btn btn-default prev-step">ย้อนกลับ</button></li>
                            <li><button id="btnNext3" type="button" class="btn btn-primary btn-info-full next-step">ถัดไป</button></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">เพิ่มบัญชีรับสินไหม</h4>
            </div>
            <div class="modal-body">
                <form id="formAddAccountModal">
                    <div class="form-group">
                        <label class="control-label">ธนาคาร :</label>
                        <select class="form-control select2 " style="width: 100%;" tabindex="-1" aria-hidden="true" id="ddlBank" name="ddlBank" checkNA="checkNA">
                            <option value="-1"> -- โปรดระบุ -- </option>

                            @foreach (var item in @ViewBag.Bank)
                            {

                                <option value=@item.Bank_ID>  @item.BankDetail </option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">เลขบัญชี :</label>
                        <input class="form-control" style="width: 100%;" tabindex="-1" aria-hidden="true" id="txtBankAccountNo" name="txtBankAccountNo" onkeypress="return /[0-9]/i.test(event.key)" required>
                    </div>
                    <div class="form-group">
                        <label class="control-label">ชื่อบัญชี :</label>
                        <input class="form-control" style="width: 100%;" tabindex="-1" aria-hidden="true" id="txtBankAccountName" name="txtBankAccountName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="btnCancelBankAccount" type="button" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
                <button id="btnSaveBankAccount" type="button" class="btn btn-primary">บันทึก</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModalContact" tabindex="-1" role="dialog" aria-labelledby="myModalLabelContact">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabelContact">เพิ่มเบอร์ผู้ติดต่อ</h4>
            </div>
            <div class="modal-body">
                <form id="formAddContactModal">
                    <div class="form-group">
                        <label class="control-label">ประเภทผู้ติดต่อ :</label>
                        <select class="form-control select2 " style="width: 100%;" tabindex="-1" aria-hidden="true" id="ddlContactType" name="ddlContactType" checkNA="checkNA">
                            <option value="-1"> -- โปรดระบุ -- </option>

                            @foreach (var item in @ViewBag.PersonContactType)
                            {

                                <option value=@item.PersonContactTypeId>  @item.PersonContactType </option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">ชื่อผู้ติดต่อ :</label>
                        <input class="form-control" style="width: 100%;" tabindex="-1" aria-hidden="true" id="txtContactName" name="txtContactName" required>
                    </div>
                    <div class="form-group">
                        <label class="control-label">เบอร์ผู้ติดต่อ :</label>
                        <input class="form-control" style="width: 100%;" tabindex="-1" aria-hidden="true" id="txtContactPhone" name="txtContactPhone" placeholder="ระบุหมายเลขโทรศัพท์เฉพาะตัวเลขเท่านั้น ตัวอย่าง 0924567892" checkFormatPhoneNumbers="checkFormatPhoneNumbers" maxlength="10" minLength="10" required>
                    </div>
                    <div class="form-group" id="divContactOther" hidden>
                        <label class="control-label">อื่นๆ โปรดระบุ :</label>
                        <input class="form-control" style="width: 100%;" tabindex="-1" aria-hidden="true" id="txtContactOther" name="txtContactOther" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="btnCancelContact" type="button" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
                <button id="btnSaveContact" type="button" class="btn btn-primary">บันทึก</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModalConfirm" tabindex="-1" role="dialog" aria-labelledby="myModalLabelConfirm">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabelConfirm">ยืนยันการส่งข้อมูล</h4>
            </div>
            <div class="modal-body">
                <div class="box-group">
                    <div class="row">
                        <div class="col-xs-12 col-md-12 ">
                            <label style="font-size:1em">รายการเคลม :</label>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="box-group">
                            <div class="row">
                                <div class="col-xs-12" style="text-align:center">
                                    <table id="dtClaimList" class="table table-bordered table-hover dataTable" role="grid">
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-group">
                    <div class="row">
                        <div class="col-xs-12 col-md-12 ">
                            <label style="font-size:1em">บัญชีรับสินไหม :</label>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="box-group">
                            <div class="row">
                                <div class="col-xs-12 col-md-12 " style="text-align:center">
                                    <table id="dtBankAccountList" class="table table-bordered table-hover dataTable" role="grid">
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-group">
                    <div class="row">
                        <div class="col-xs-12 col-md-12">
                            <label style="font-size:1em">เบอร์โทรผู้ติดต่อ :</label>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="box-group">
                            <div class="row">
                                <div class="col-xs-12 col-md-12" style="text-align:center">
                                    <table id="dtContactList" class="table table-bordered table-hover dataTable" role="grid">
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCancel" type="button" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
                <button id="btnConfirm" type="button" class="btn btn-success">ยืนยัน</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModalEdit" tabindex="-1" role="dialog" aria-labelledby="myModalEdit">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#f39c12">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" style="color:white" id="myModalLabelEdit">แก้ไขข้อมูล</h4>
            </div>
            <div class="modal-body">
                <form id="formEdit">
                    <div class="box-group">
                        <div class="row">
                            <div class="col-xs-12 col-md-12">

                                <div class="box-group">
                                    <div class="row">
                                        <div class="col-xs-12 col-md-4">
                                            <label>ApplicationID :</label>
                                            <label class="" id="lblApplicationID_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                        <div class="col-xs-12 col-md-4">
                                            <label>สถานศึกษา :</label>
                                            <label class="" id="lblSchoolName_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                        <div class="col-xs-12 col-md-4">
                                            <label>ชื่อ - สกุล ผู้เอาประกัน :</label>
                                            <label class="" id="lblCustFullName_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-12 col-md-4">
                                            <label>วันเริ่มคุ้มครอง :</label>
                                            <label class="" id="lblStartCoverDate_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                        <div class="col-xs-12 col-md-4">
                                            <label>วันสิ้นสุดความคุ้มครอง :</label>
                                            <label class="" id="lblEndCoverDate_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                        <div class="col-xs-12 col-md-4">
                                            <label>สถานะ :</label>
                                            <label class="" id="lblStatus_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-12 col-md-4">
                                            <label>แผนประกัน :</label>
                                            <label class="" id="lblProductDetail_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                        <div class="col-xs-12 col-md-4">
                                            <label>วงเงินคุ้มครอง :</label>
                                            <label class="" id="lblCoverage_Edit" style="color:blue;width:100%"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12 col-md-3">
                            <label>วันที่เข้ารักษา :</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control pull-right dpk" id="dtpDateHappen_PA_Edit" name="dtpDateHappen_PA_Edit" data-provide="datepicker" data-date-language="th-th" required>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-3">
                            <label>วันที่ออก รพ. :</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control pull-right dpk" id="dtpNoticeDate_PA_Edit" name="dtpNoticeDate_PA_Edit" data-provide="datepicker" data-date-language="th-th" required>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-3">
                            <label>ประเภทการรักษา :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlClaimType_PA_Edit" name="ddlClaimType_PA_Edit" checkNA="checkNA"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-md-3">
                            <label>จังหวัดสถานพยาบาล :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlProvinceHospital_PA_Edit" name="ddlProvinceHospital_PA_Edit" checkNA="checkNA">
                                <option value="-1">--โปรดระบุ--</option>
                                @{
                                    foreach (var item in ViewBag.Province)
                                    {
                                        <option value="@item.Code">@item.Detail</option>
                                    }

                                }
                            </select>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <label>สถานพยาบาล :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlHospitalName_PA_Edit" name="ddlHospitalName_PA_Edit" required></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-md-3">
                            <label>สถานะ :</label>
                            <select class="form-control select2" style="width:100%" id="ddlStatusClaim_Edit" name="ddlStatusClaim_Edit" disabled>
                                @{
                                    foreach (var item in ViewBag.StatusClaim)
                                    {
                                        <option value="@item.Code">@item.Detail</option>
                                    }

                                }
                            </select>
                        </div>
                        <div class="col-xs-12 col-md-3" id="divCancelCause_Edit" hidden>
                            <label>สาเหตุการปฏิเสธ :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" disabled id="ddlCancelCause_Edit" required></select>
                        </div>
                        <div class="col-xs-12 col-md-3">
                            <label>ยอดเงิน :</label>
                            <input type="text" class="form-control" id="txtAmount_Edit" name="txtAmount_Edit" style="color:blue;width:100%" required="required">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-md-9">
                            <label>หมายเหตุ(อุบัติเหตุ/อาการ):</label>
                            <input class="form-control" type="text" id="txtAccidentDetail_Edit" name="txtAccidentDetail_Edit" required="required">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
                <button id="btnEdit" name="btnEdit" type="button" class="btn btn-warning">บันทึกการแก้ไข</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModalBenefit" tabindex="-1" role="dialog" aria-labelledby="myModalLabelBenefit">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabelBenefit">สิทธิประโยชน์</h4>
            </div>
            <div class="modal-body">
                <div class="box-body">
                    <div class="box-group">
                        <div class="row">
                            <div class="col-xs-12 col-md-12 " style="text-align:center">
                                <table id="dtBenefit" class="table table-bordered table-hover dataTable" role="grid">
                                    <thead>
                                        <tr>
                                            <th>BenefitDetail</th>
                                            <th>ความคุ้มครอง</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="hdfuuId_Edit" hidden />
<input type="hidden" id="hdfCustomerDetail" hidden />
<input type="hidden" id="hdfCustomerDetail_Edit" hidden />
<input type="hidden" id="hdfProductCategory" hidden />
<input type="hidden" id="hdfProductCategory_Edit" hidden />
<input type="hidden" id="hdfCustomerStatusCode" hidden />
<input type="hidden" id="hdfCustomerStatusCode_Edit" hidden />
<input type="hidden" id="hdfSchoolId" hidden />
<input type="hidden" id="hdfSchoolId_Edit" hidden />

@section ViewSpecificJavascript {
    <script>
        var objDoc = {};
        var objCOLPA = {};
        var arrCLPA = [];
        var arrDocCode = [];
        var arrBankAccount = [];
        var arrContact = [];
        var hasClassSelected = false;
        var currentAccountNo;
        var Coverage;
        var CoverageForEdit;
        class BankAccount {
            constructor(bankid, bankname, bankaccountno, bankaccountname) {
                this.bankid = bankid;
                this.bankname = bankname;
                this.bankaccountno = bankaccountno;
                this.bankaccountname = bankaccountname;
            }
        }

        class Contact {
            constructor(contacttypeid, contacttype, contactname, contactphone, contactother) {
                this.contacttypeid = contacttypeid;
                this.contacttype = contacttype;
                this.contactname = contactname;
                this.contactphone = contactphone;
                this.contactother = contactother;
            }
        }

        class Claim {
            constructor(uuid, appid, customerdetailcode, custname, schoolname, schoolid, startcoverdate, endcoverdate, customerstatus, customerstatusid, datehappen, noticedate, statusclaim, statusclaimid, claimtype, claimtypeid, provincehospital, provincehospitalid, hospital, hospitalid, amount, accident, denycauseid) {
                this.uuid = uuid;
                this.appid = appid;
                this.customerdetailcode = customerdetailcode;
                this.custname = custname;
                this.schoolname = schoolname;
                this.schoolid = schoolid;
                this.startcoverdate = startcoverdate;
                this.endcoverdate = endcoverdate;
                this.customerstatus = customerstatus;
                this.customerstatusid = customerstatusid;
                this.datehappen = datehappen;
                this.noticedate = noticedate;
                this.statusclaim = statusclaim;
                this.statusclaimid = statusclaimid;
                this.denycauseid = denycauseid;
                this.claimtype = claimtype;
                this.claimtypeid = claimtypeid;
                this.provincehospital = provincehospital;
                this.provincehospitalid = provincehospitalid;
                this.hospital = hospital;
                this.hospitalid = hospitalid;
                this.amount = amount;
                this.accident = accident;
            }
        }
        $(document).ready(function () {
            /*---------------------------------------------------------------------------------------------------------- */

            //$('#dtpDateHappen_PA').datepicker({ format: "dd/mm/yyyy", autoclose: true }).datepicker("setDate", new Date());
            //$('#dtpNoticeDate_PA').datepicker({ format: "dd/mm/yyyy", autoclose: true }).datepicker("setDate", new Date());

            $('.select2').select2();
            $('.content-header').hide();

            //ไม่ให้ input mask currency ใส่ค่าลบ(-)
            Inputmask.extendAliases({
                'currency': {
                    allowMinus: false
                }
            });

            $("#txtAmount").inputmask({
                rightAlign: true,
                alias: "currency",
                prefix: ''
            });

            $("#txtAmount_Edit").inputmask({
                rightAlign: true,
                alias: "currency",
                prefix: ''
            });

            //load default
            GetHospitalNameDetail();
            GetHospitalNameDetailForEdit();

            //jquery validation
            $('#formBankAccount').validate({
                rules:
                {
                    bankaccount: { required: true },
                },
                messages:
                {
                    bankaccount: { required: "<br>กรุณาเลือกบัญชีธนาคาร..<br />" },
                },
                errorPlacement: function (error, element) {
                    if (element.is(":radio")) {
                        error.prependTo(element.parents('.radio-err'));
                    } else if (element.is(":checkbox")) {
                        error.prependTo(element.parents('.radio-err'));
                    }
                    else { // This is the default behavior
                        error.insertAfter(element);
                    }
                }
            });

            //jquery validation
            $('#formContact').validate({
                rules:
                {
                    contact: { required: true },
                },
                messages:
                {
                    contact: { required: "<br>กรุณาเลือกเบอร์ผู้ติดต่อ..<br />" },
                },
                errorPlacement: function (error, element) {
                    if (element.is(":radio")) {
                        error.prependTo(element.parents('.radio-err'));
                    } else if (element.is(":checkbox")) {
                        error.prependTo(element.parents('.radio-err'));
                    }
                    else { // This is the default behavior
                        error.insertAfter(element);
                    }
                }
            });

            //Initialize tooltips
            $('.nav-tabs > li a[title]').tooltip();

            //----------Wizard----------//
            $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {

                var $target = $(e.target);

                if ($target.parent().hasClass('disabled')) {
                    return false;
                }
            });

            $('a[data-toggle="pill"]').on('show.bs.tab', function (e) {
                var $id = e.currentTarget.id;

                if ($id === "a_history") {
                    $('#section_btnNextAcc').hide();
                } else {
                    $('#section_btnNextAcc').show();
                }
            });

            $(".next-step").click(function (e) {
                let btn = $(this)[0].id;
                switch (btn) {
                    case 'btnNext1':

                        if ($('#form_main').valid()) {
                            objCOLPA.claimtype = $('#ddlClaimType option:selected').text().trim();
                            objCOLPA.claimtypeId = $('#ddlClaimType').val();
                            objCOLPA.servicename = $('#txtSearchService option:selected').text().trim();
                            objCOLPA.servicenameId = $('#txtSearchService').val();
                            objCOLPA.zebraCarOwner = $('#txtZebraCarOwnerID option:selected').text().trim();
                            objCOLPA.zebraCarOwnerId = $('#txtZebraCarOwnerID').val();
                            objCOLPA.remark = $('#txtRemark').val().trim();
                            //console.log(objCOLPA);

                            $('#lblClaimType').text(objCOLPA.claimtype);
                            $('#lblService').text(objCOLPA.servicename);
                            $('#lblZebraCarOwner').text(objCOLPA.zebraCarOwner);

                            //show section button add claim
                            $('#section_btnAddClaim').show();

                            if (objCOLPA.hasOwnProperty('applicationCode') && objCOLPA.applicationCode !== "") {

                                $('#section_detail').show();

                                $('#lblApplicationID_PA').text(objCOLPA.applicationCode);
                                $('#lblSchoolName_PA').text(objCOLPA.schoolName);
                                $('#lblProduct_PA').text(objCOLPA.product);
                                $('#lblContactName_PA').text(objCOLPA.contactName);

                                $('#lblContactBankAccountName_PA').text(objCOLPA.contactBankAccountName);
                                $('#lblContactBankAccountNo_PA').text(objCOLPA.contactBankAccountNo);
                                $('#lblContactBank_PA').text(objCOLPA.contactBankName);

                                //check array length > 0
                                if (arrCLPA.length > 0) {
                                    //ซ่อน
                                    $('#btn_prev2').hide();
                                    //แสดงปุ่ม ยันทึกและระบุสินไหม
                                    $('#btnNextAcc').show();

                                } else {
                                    //ซ่อน
                                    $('#btn_prev2').show();
                                    $('#btnNext2').hide();
                                    //ซ่อน ปุ่มบันทึกและระบุสืนไหม
                                    $('#btnNextAcc').hide();
                                }

                                let $active = $('.wizard .nav-tabs li.active');
                                $active.next().removeClass('disabled');
                                $active.addClass('disabled');
                                nextTab($active);
                            } else {
                                swal("แจ้งเตือน!","กรุณาเลือกข้อมูลในตาราง","warning");
                            }
                        }
                        break;
                    case 'btnNext2':

                        if ($('#formClaimPA').valid()) {

                            ClearBankAndContactList();
                            if (!hasClassSelected) {
                                swal("แจ้งเตือน!", "กรุณาเลือกรายการก่อนบันทึกเคลม", "warning");
                                return false;
                            }

                            if (!CheckDateInDateOut()) {
                                swal("แจ้งเตือน!", "กรุณาตรวจสอบวันที่เข้ารักษา / วันที่ออก รพ.", "warning");
                                return false;
                            }

                            // ต้องมาทำเพิ่ม --- 21-1-21
                            //ถ้า ประเภทการรักษา ชดเชย ไม่ต้อง validate
                            //ชดเชยอุบัติเหตุ4003 ชดเชยสูยเสียอวัยวะ4005
                            if ($('#ddlClaimType_PA').val() != "4003" && $('#ddlClaimType_PA').val() != "4004" && $('#ddlClaimType_PA').val() != "4005") {
                                //validate amount
                                var validAmount = ValidateAmount();
                                if (!(validAmount.IsResult)) {
                                    swal("แจ้งเตือน!", validAmount.Msg, "warning");
                                    return false;
                                }
                            }

                            //ValidatePA: 2000 = PH
                            let r = ValidatePA($('#hdfCustomerDetail').val(), $('#ddlHospitalName_PA').val(), null, null, $('#dtpDateHappen_PA').val(), $('#dtpNoticeDate_PA').val());
                            if (!(r.IsResult)) {
                                swal("แจ้งเตือน!", r.Msg, "warning");
                                return false;
                            }

                            //assign values to contructor
                            const objCL= new Claim(uuidv4(),
                                $('#lblApplicationID').text(),
                                $('#hdfCustomerDetail').val(),
                                $('#lblCustFullName').text(),
                                $('#lblSchoolName').text(),
                                $('#hdfSchoolId').val(),
                                $('#lblStartCoverDate').text(),
                                $('#lblEndCoverDate').text(),
                                $('#lblStatus').text(),
                                $('#hdfCustomerStatusCode').val(),
                                $('#dtpDateHappen_PA').val(),
                                $('#dtpNoticeDate_PA').val(),
                                $('#ddlStatusClaim option:selected').text(),
                                $('#ddlStatusClaim').val(),
                                $('#ddlClaimType_PA option:selected').text(),
                                $('#ddlClaimType_PA').val(),
                                $('#ddlProvinceHospital_PA option:selected').text(),
                                $('#ddlProvinceHospital_PA').val(),
                                $('#ddlHospitalName_PA option:selected').text(),
                                $('#ddlHospitalName_PA').val(),
                                $('#txtAmount').val().trim(),
                                $('#txtAccidentDetail').val(),
                                $('#ddlCancelCause').val());

                            //push object to array
                            arrCLPA.push(objCL);
                           // console.log(arrCLPA);
                            //ซ่อน section บันทึกเคลม
                            $('#section_claimPA').hide();
                            //แสดง section รายละเอียด
                            $('#section_detail').show();
                            //แสดง section รายการเคลม
                            $('#section_claimDT').show();
                            //ซ่อนปุ่มถัดไป 2
                            $('#btnNext2').hide();
                            //เช็ค array มากกว่า 0 ให้แสดงปุ่ม บันทึกและระบุสินไหม
                            if (arrCLPA.length > 0) {
                                $('#btn_prev2').hide();
                                $('#btnNextAcc').show();
                            }

                            //load datatables
                            ClaimDT(arrCLPA);
                        }
                        break;
                    case 'btnNextAcc':
                        ClearBankAndContactList();
                        GetBankAccount();
                        GetPersonContact()

                        //insert 28หน้าบัญชีธนาคาร 30ใบเสร็จ 31รับรองแพทย์ 32สำเนาบัตรผู้เอาประกัน 33เอกสารอื่นๆ,34สำเนาบัตรประชาชนเจ้าของบัญชี
                        if (!objDoc.doc28) {

                            DocumentInsert("28,30,31,32,33,34");
                        } else {
                            DocumentSelectByDocCode(objDoc.doc28);
                        }

                        let $active = $('.wizard .nav-tabs li.active');
                        $active.next().removeClass('disabled');
                        $active.addClass('disabled');
                        nextTab($active);
                        break;
                    case 'btnNext3':

                        //เช็คบัญชีธนาคาร
                        if (arrBankAccount.length === 0) {
                            swal("แจ้งเตือน!", "กรุณาเพิ่มข้อมูลบัญชี", "warning");
                            return false;
                        }
                        //เช็คผู้ติดต่อ
                        if (arrContact.length === 0) {
                            swal("แจ้งเตือน!", "กรุณาเพิ่มข้อมูลเบอร์ผู้ติดต่อ", "warning");
                            return false;
                        }

                        //form valid
                        if ($('#formBankAccount').valid() && $('#formContact').valid()) {
                            //เช็คบัญชีที่เลือกเป็นบัญชีใหม่
                            if (CheckNewBankAccount()) {

                                //validate Doc 28 - หน้าบัญชี
                                let result = ValidateDocument(objDoc.doc28);
                                if (result.IsResult) {
                                    $("#myModalConfirm").modal("show");
                                    LoadDTClaimList();
                                    LoadDTBankAccountList();
                                    LoadDTContactList();
                                } else {
                                    swal("แจ้งเตือน!", result.Msg, "warning");
                                    return false;
                                }
                            } else {
                                $("#myModalConfirm").modal("show");
                                LoadDTClaimList();
                                LoadDTBankAccountList();
                                LoadDTContactList();
                            }
                        }
                        break;
                    default:
                }
            });

            $(".prev-step").click(function (e) {
                //ถ้า section claim PA ซ่อนอยู่
                if ($('#section_claimPA').is(":hidden")) {
                    var $active = $('.wizard .nav-tabs li.active');
                    $active.prev().removeClass('disabled');
                    $active.addClass('disabled');
                    prevTab($active);

                } else {
                    //แสดง / ซ่อน
                    $('#section_claimPA').hide()
                    $('#section_detail').show();
                    $('#section_btnNextAcc').show();

                    $('#section_claimDT').show()
                    $('#btnNext2').hide();

                    //ถ้า array มากกว่า 0
                    if (arrCLPA.length > 0) {
                        //แสดงปุ่ม บันทึกและระบุสินไหม
                        $('#btnNextAcc').show();
                        $('#btn_prev2').hide();
                    } else {
                        //ซ่อนปุ่ม บันทึกและระบุสินไหม
                        $('#btnNextAcc').hide();
                        $('#btn_prev2').show();
                        $('#btn_addclaim').show();
                    }
                }
            });
            //----------End Wizard----------//

            //button event
            $('#btn_addclaim').off().on('click', function (e) {
                e.preventDefault();

                //default active tab1
                if ($("#claim_t2").hasClass('active')) {
                    $("#claim_t2").removeClass('active');
                    $("#claim_t1").addClass('active');
                } else {
                    $("#claim_t1").addClass('active');
                }
                //เปิดปุ่มย้อนกลับ
                $('#btn_prev2').show();
                //clear and set value default
                hasClassSelected = false;
                $('#txtSearchPA').val('');
                $('#dtHistory tbody').empty();
                $('#formClaimPA').validate().resetForm();
                $(".error").removeClass("error");

                $('#txtSearchIndex').val("");
                $('#divDTMainPA').hide();
                DoClearCustomerDetail();
                DoClearInputSaveClaim();

                $('#section_detail').hide();

                $('#section_claimDT').hide();
                $('#section_claimPA').show();

                $('#section_btnNextAcc').show();
                $('#btnNextAcc').hide()
                $('#btnNext2').show();
            });

            //ค้นหา PA
            $('#btnSearchPA').click(function (e) {
                e.preventDefault();
                $('#divDTMainPA').show();
                DoClearCustomerDetail();
                DoClearInputSaveClaim();
                GetApplicationPADetail();
            });

            //add bank account
            $('#btnAddBankAccount').click(function (e) {
                e.preventDefault();
                //clear element in modal
                $('#ddlBank').select2().val("-1").trigger("change.select2");
                $('#txtBankAccountNo').val("");
                $('#txtBankAccountName').val("");
            });

            $('#btnAddContact').click(function (e) {
                e.preventDefault();
                //clear element in modal
                $('#ddlContactType').select2().val("-1").trigger("change.select2");
                $('#txtContactName').val("");
                $('#txtContactPhone').val("");
                $('#txtContactOther').val("");
            });

            //btn confrim
            $('#btnConfirm').one('click',function (e) {
                e.preventDefault();
                SaveClaimOnLine();
                $(this).prop('disabled', true);
            });

            $('#btnEdit').click(function (e) {
                e.preventDefault();
                if ($('#formEdit').valid())
                {
                    if (!CheckDateInDateOutForEdit()) {
                        swal("แจ้งเตือน!", "กรุณาตรวจสอบวันที่เข้ารักษา / วันที่ออก รพ.", "warning");
                        return false;
                    }

                    //ถ้า ประเภทการรักษา ชดเชย ไม่ต้อง validate
                    //ชดเชยอุบัติเหตุ4003 ชดเชยสูยเสียอวัยวะ4005
                    if ($('#ddlClaimType_PA_Edit').val() != "4003" && $('#ddlClaimType_PA').val() != "4004" && $('#ddlClaimType_PA_Edit').val() != "4005") {
                        //validate amount
                        var validAmount = ValidateAmountForEdit();
                        if (!(validAmount.IsResult)) {
                            swal("แจ้งเตือน!", validAmount.Msg, "warning");
                            return false;
                        }
                    }

                    //ValidatePA
                    let r = ValidatePA($('#hdfCustomerDetail').val(), $('#ddlHospitalName_PA').val(), null, null, $('#dtpDateHappen_PA_Edit').val(), $('#dtpNoticeDate_PA_Edit').val());
                    if (!(r.IsResult)) {
                        swal("แจ้งเตือน!", r.Msg, "warning");
                        return false;
                    }

                    //Save
                    SaveEdit();
                }
            });

            //valid modal add bankaccount
            $('#btnSaveBankAccount').click(function (e) {
                e.preventDefault();
                //valid in modal
                if ($('#formAddAccountModal').valid()) {
                    if (IsValidate()) {
                        let bankId = parseInt($('#ddlBank').val().trim());
                        let bankName = $('#ddlBank option:selected').text().trim();
                        let accountNo = $('#txtBankAccountNo').val().trim();
                        let accountName = $('#txtBankAccountName').val().trim();

                        //check bankaccount no
                        const index = arrBankAccount.findIndex(v => v.bankaccountno === accountNo);

                        if (!(index >= 0)) {
                            const objBankAccount = new BankAccount(bankId, bankName, accountNo, accountName);
                            arrBankAccount.push(objBankAccount);

                            LoadBankAccount(arrBankAccount);

                            $(".modal").modal("hide");
                        } else {
                            swal("แจ้งเตือน!", "เลขที่บัญชีซ้ำ กรุณาตรวจสอบ", "warning");
                        }
                    }

                }
            });

            const IsValidate = () => {
                var accountNo = $('#txtBankAccountNo').val().trim();
                // Using a regular expression to check if the value is numeric
                var isNumeric = /^[0-9]+$/.test(accountNo);

                // Using typeof and isFinite to check if the value is numeric
                if (isNumeric == false) {
                    swal("เลขที่บัญชีต้องเป็นตัวเลขเท่านั้น!", "", "warning");
                    return false;
                }

                return true;
            }

            //valid modal add bankaccount
            $('#btnSaveContact').click(function (e) {
                //valid in modal
                if ($('#formAddContactModal').valid()) {
                    let contacttypeid = parseInt($('#ddlContactType').val().trim());
                    let contacttype = $('#ddlContactType option:selected').text().trim();
                    let contactname = $('#txtContactName').val().trim();
                    let contactphone = $('#txtContactPhone').val().trim();
                    let contactother = $('#txtContactOther').val().trim();

                    //check bankaccount no
                    const index = arrContact.findIndex(v => v.contactphone === contactphone);

                        if (!(index >= 0)) {
                            const objContact = new Contact(contacttypeid, contacttype, contactname, contactphone, contactother);
                            arrContact.push(objContact);

                            LoadPersonContact(arrContact);

                            $(".modal").modal("hide");
                        } else {
                            swal("แจ้งเตือน!", "เบอร์ผู้ติดต่อซ้ำ กรุณาตรวจสอบ", "warning");
                        }

                }
            });

            // เลือกสถานะเคลม
            $('#ddlStatusClaim').change(function (e) {
                e.preventDefault();
                //ถ้าเป้นปฏิเสธเคลม ให้เลือก สาเหตุการปฏิเสธ ได้ ถ้าไม่ใช่ให้ ปิด และเคลียร์
                if ($("#ddlStatusClaim").val() == "3570") {  //3570 คือ ปฏิเสธเคลม
                    //Get CancelCauseClaim
                    GetCancelCauseClaim();
                    //Enabled CancelCauseClaim
                    $('#divCancelCause').show();
                    $('#ddlCancelCause').prop('disabled', false);

                }
                else {
                    $('#divCancelCause').hide();
                    $('#ddlCancelCause').empty();
                    $('#ddlCancelCause').prop('disabled', true);
                }

            });

            $('#ddlContactType').change(function (e) {
                let val = $(this).val();
                //check other ph
                if (val == 9) {
                    $('#divContactOther').show();
                } else {
                    $('#divContactOther').hide();
                }
            });

            //ค้นหาโรงเรียน PA หน้าแรก
            $('#btnSearchSchool').click(function (e) {
                e.preventDefault();
                if ($('#form_searchschool').valid()) {
                //set value empty
                objCOLPA.applicationCode = "";
                //call fn
                SearchSchoolPA();
                }
            });

            //event valid
            $('#txtSearchService').change(function (e) {
                $(this).valid();
            });

            $('#txtZebraCarOwnerID').change(function (e) {
                $(this).valid();
            });

            $('#ddlClaimType_PA').change(function (e) {
                //debuger
                if ($(this).valid()) {
                    let val = $(this).val();
                    //ชดเชย อุบัติเหตุ
                    if (val === '4003') {
                        let customerCode = $('#hdfCustomerDetail').val();
                        PACustomerBenefit(customerCode);
                        $('#myModalBenefit').modal('show');
                    }
                }

            });

            $('#ddlClaimType_PA_Edit').change(function (e) {
                $(this).valid();
            });

            $('#ddlProvinceHospital_PA').change(function (e) {
                $(this).valid();
            });

            $('#ddlHospitalName_PA').change(function (e) {
                $(this).valid();
            });

            $('#ddlHospitalName_PA_Edit').change(function (e) {
                $(this).valid();
            });

            $('#ddlStatusClaim').change(function (e) {
                $(this).valid();
            });

            $('#dtpDateHappen_PA').change(function (e) {
                if ($(this).valid()) {
                    DuplicateClaimOnLine($('#hdfCustomerDetail').val(), $(this).val())
                }
            });

            $('#dtpNoticeDate_PA').change(function (e) {
                $(this).valid();
            });

            $('#dtpDateHappen_PA_Edit').change(function (e) {
                if ($(this).valid()) {
                    DuplicateClaimOnLine($('#hdfCustomerDetail_Edit').val(), $(this).val())
                }
            });

            $('#dtpNoticeDate_PA_Edit').change(function (e) {
                $(this).valid();
            });

            //ถ้ามีการเปลี่ยนจังหวัดในการค้นหาสถานศึกษา ให้เคลียร์ค่าสถานศึกษา ให้เลือกใหม่
            $('#ddlProvinceSchool').change(function (e) {
                e.preventDefault();
                //เคลียร์ ตาราง
                $('#dtSearchSchool').empty();
            });

            //ถ้ามีการเปลี่ยนจังหวัด สถานพยาบาลให้เคลียร์ค่า ให้เลือกใหม่
            $('#ddlProvinceHospital_PA').change(function (e) {
                e.preventDefault();
                $('#ddlHospitalName_PA').empty().trigger('change');
            });

            //ถ้ามีการเปลี่ยนจังหวัด สถานพยาบาลให้เคลียร์ค่า ให้เลือกใหม่ for edit
            $('#ddlProvinceHospital_PA_Edit').change(function (e) {
                e.preventDefault();
                $('#ddlHospitalName_PA_Edit').empty().trigger('change');
            });

            $('.js-search-person').select2({
                ajax: {
                    type: 'GET',
                    url: '@Url.Action("GetEmployee", "ClaimOnLine")',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term,// search term
                            page: params.page
                        };
                    },
                    processResults: function (data, search) {
                        //params.page = params.page || 1;
                        return {
                            results: $.map(data, function (item) {
                                return {
                                    id: item.EmployeeCode,
                                    text: item.EmployeeCode + ' - ' + item.FirstName + ' ' + item.LastName
                                }
                            })
                        };
                    },
                    cache: true
                },
                templateResult: function (item) {
                    if (item.loading) return item.text;
                    return item.text;
                },
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 4,
                language: { inputTooShort: function () { return 'กรอกข้อมูลอย่างน้อย 4 ตัวอักษร'; } }
            });

            $('.js-search-person-1').select2({
                ajax: {
                    type: 'GET',
                    url: '@Url.Action("GetZebraCar", "ClaimOnLine")',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term,// search term
                            page: params.page
                        };
                    },
                    processResults: function (data, search) {
                        //params.page = params.page || 1;
                        return {
                            results: $.map(data, function (item) {
                                return {
                                    id: item.EmployeeCode,
                                    text: item.Detail
                                }
                            })
                        };
                    },
                    cache: true
                },
                templateResult: function (item) {
                    if (item.loading) return item.text;
                    return item.text;
                },
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 4,
                language: { inputTooShort: function () { return 'กรอกข้อมูลอย่างน้อย 4 ตัวอักษร'; } }
             });

        });
        //-------------------------------------//
        function nextTab(elem) {

            $(elem).next().find('a[data-toggle="tab"]').click();
        }
        function prevTab(elem) {

            $(elem).prev().find('a[data-toggle="tab"]').click();
        }

        const DoClearCustomerDetail = () => {
            $('#lblApplicationID').text('');
            $('#lblSchoolName').text('');
            $('#lblCustFullName').text('');
            $('#lblStartCoverDate').text('');
            $('#lblEndCoverDate').text('');
            $('#lblStatus').text('');
            $('#hdfProductCategory').val('');

            $('#lnkDetail').removeAttr("href");
            $('#lnkDetail').removeAttr("target");
        }

        const DoClearInputSaveClaim = () => {
            var date = new Date();
            var today = new Date(date.getFullYear(), date.getMonth(), date.getDate());

            $('.dpk').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                endDate: today + 1
            });

            $('#dtpDateHappen_PA').datepicker('setDate', today);
            $('#dtpNoticeDate_PA').datepicker('setDate', today);

            $('#ddlClaimType_PA').empty().trigger("change.select2");
            $('#ddlClaimType_PA').prop("disabled", true);
            $('#ddlProvinceHospital_PA').select2().val("-1").trigger("change.select2");
            $("#ddlHospitalName_PA").empty().trigger("change.select2");
            $("#txtAccidentDetail").val('');
            $("#txtAmount").val('');
            $("#hdfCustomerDetail").val('');
            $('#hdfSchoolId').val('');
        }

        /*------PA------*/
        const SearchSchoolPA = () => {
            $('#dtSearchSchool').empty();

            let t = $('#dtSearchSchool').DataTable({
                pageLength: 5,
                processing: true,
                serverSide: true,
                responsive: true,
                autoWidth: false,
                searching: false,
                destroy: true,
                ajax: {
                    url: '@Url.Action("GetSchoolSelect", "Claim")',
                    type: 'POST',
                    data: function (d) {
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.indexStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = $('#txtSchoolSearch').val();
                        d.PAYear = $('#ddlYear').val();
                        d.provinceId = $('#ddlProvinceSchool').val();
                    }
                },
                columns: [
                    { title: 'ปีการศึกษา', data: 'Year' },
                    { title: 'ApplicationID', data: 'ApplicationCode' },
                    { title: 'ชื่อสถานศึกษา', data: 'SchoolName' },
                    { title: 'อำเภอ', data: 'District' },
                    { title: 'จังหวัด', data: 'Province' },
                    { title: 'แผน', data: 'Product' },
                    { title: 'สถานะ', data: 'ApplicationStatus' },
                    {
                        title: 'วันเริ่มความคุ้มครอง', data: 'StartCoverDate', className: 'dt-center',
                        mRender: function (data) {
                            moment.locale('th');
                            return moment(data).add(543, 'years').format("DD/MM/YYYY", "LLLL");
                        }
                    },
                    {
                        title: 'วันสิ้นสุดความคุ้มครอง', data: 'EndCoverDate', className: 'dt-center',
                        mRender: function (data) {
                            moment.locale('th');
                            return moment(data).add(543, 'years').format("DD/MM/YYYY", "LLLL");
                        }
                    },
                ],
                bLengthChange: false
            });
            window.onresize = function () {
                t.columns.adjust().responsive.recalc();
            };

            $('#dtSearchSchool tbody').on('click', 'tr', function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');

                    //set value empty
                    objCOLPA.applicationCode = "";

                }
                else {
                    t.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }

                t.rows('.selected').every(function (rowIdx, tableLoop, rowLoop) {
                    var data = this.data();

                    // ... do something with data(), or this.node(), etc
                    objCOLPA.applicationCode = data.ApplicationCode;
                    objCOLPA.schoolName = data.SchoolName;
                    objCOLPA.product = data.Product;
                    objCOLPA.contactName = data.ContactName;

                    objCOLPA.contactBankAccountName = data.ContactBankAccountName;
                    objCOLPA.contactBankAccountNo = data.ContactBankAccountNo;
                    objCOLPA.contactBankName = data.ContactBankName;
                });
                //ถ้ามีการเลือกโรงเรียนใหม่ ล้างข้อมูลโรงเรียนที่เคยเก็บไว้ทิ้งทั้งหมด
                arrCLPA = [];

                //console.log(objCOLPA);
            });
        }

        const GetApplicationPADetail = () => {
            $('#dtMainPA').empty();
            let t = $('#dtMainPA').DataTable({
             pageLength: 5,
             processing: true,
             serverSide: true,
             responsive: true,
             searching: false,
             destroy: true,
             ajax: {
                 url: '@Url.Action("GetPAApplicationDetail", "Claim")',
                    type: 'POST',
                    data: function (d) {
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.indexStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = $('#txtSearchPA').val();
                        d.appCode = objCOLPA.applicationCode;
                    }
              },
                columns: [
                    { title: 'รหัสนักเรียน', data: 'Code' },
                    { title: 'ชื่อ-สกุลผู้เอาประกัน', data: 'CustomerName' },
                    { title: 'ประเภทผู้เอาประกัน', data: 'CustomerType' },
                    { title: 'สถานะ', data: 'ApplicationStatus' },
                    {
                        title: 'วันที่เริ่มความคุ้มครอง', data: 'StartCoverDate', className: 'dt-center',
                        mRender: function (data) {
                            return moment(data).add(543, 'years').format("DD/MM/YYYY");
                        }
                    },
                    {
                        title: 'วันที่สิ้นสุดความคุ้มครอง', data: 'EndCoverDate', className: 'dt-center',
                        mRender: function (data) {

                            return moment(data).add(543, 'years').format("DD/MM/YYYY");
                        }
                    },
                ],
                bLengthChange: false
            });

            $('#dtMainPA tbody').on('click', 'tr', function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');

                    hasClassSelected = false;

                    $('#ddlClaimType_PA').prop('disabled', true);
                    $('#ddlClaimType_PA').empty();
                }
                else {
                    t.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');

                    hasClassSelected = true;
                }

                DoClearCustomerDetail();
                //DoClearInputSaveClaim();

                t.rows('.selected').every(function (rowIdx, tableLoop, rowLoop) {
                    var data = this.data();
                    // ... do something with data(), or this.node(), etc
                    let ddd = data.Code;

                    $('#hdfCustomerDetail').val(ddd);

                    GetCustomerDetail();
                    ClaimHistory(ddd);
                });
            });
        }

        const GetCustomerDetail = () => {
            $.get("@Url.Action("GetPACustomerDetail", "Claim")", { customerDetailCode: $('#hdfCustomerDetail').val() },
                function (data, jqXHR) {
                    if (data != null)
                    {

                        //Check App Status
                        if (data.ApplicationStatusCode == "3010" || data.ApplicationStatusCode == "3020" ||
                            data.ApplicationStatusCode == "3030" || data.ApplicationStatusCode == "3040") {
                            //Check Customer Detail Status ถ้า สถานะผู้เอาประกัน เป็น ยกเลิก กับยกเลิกสวมสิทธิ์ ไม่ให้บันทึกเคลม
                            if (data.CustomerStatusCode != "3202" && data.CustomerStatusCode != "3204") {

                                $('#lblApplicationID').text(data.ApplicationCode);
                                $('#lblCustFullName').text(data.CustomerName);
                                $('#lblSchoolName').text(data.SchoolName);
                                $('#lblStatus').text(data.CustomerStatus);
                                let startCoverDate = toBuddhistYear(moment(data.StartCoverDate), 'DD/MM/YYYY');
                                let endCoverDate = toBuddhistYear(moment(data.EndCoverDate), 'DD/MM/YYYY');
                                $('#lblStartCoverDate').text(startCoverDate);
                                $('#lblEndCoverDate').text(endCoverDate);
                                $('#lblProductDetail').text(data.ProductDetail);
                                $('#lblCoverage').text(`${data.BenefitDetail}:${data.Coverage}`);

                                $('#lnkDetail').attr("href", data.URLOpenlink);
                                $('#lnkDetail').attr("target", "_blank");

                                Coverage = data.Coverage;
                                $('#hdfProductCategory').val(data.ProductCategoryCode)
                                $('#hdfCustomerStatusCode').val(data.CustomerStatusCode)
                                $('#hdfSchoolId').val(data.SchoolId)
                                GetClaimTypeXProductCategory();

                                $('#ddlClaimType_PA').prop('disabled', false);
                            } else
                            {
                                //Alert ไม่ให้บันทึกเคลม
                                swal("แจ้งเตือน !!", `ไม่สามารถบันทึกเคลมได้ เนื่องจากสถานะผู้เอาประกันเป็น ${data.CustomerStatus}`, "error");
                                $('#ddlClaimType_PA').prop('disabled', true);
                                $('#ddlClaimType_PA').empty();
                            }
                        } else
                        {
                             //Alert ไม่ให้บันทึกเคลม
                            swal("แจ้งเตือน !!", `ไม่สามารถบันทึกเคลมได้ เนื่องจากสถานะกรมธรรม์เป็น ${data.ApplicationStatus}`, "error");
                            $('#ddlClaimType_PA').prop('disabled', true);
                            $('#ddlClaimType_PA').empty();
                        }

                    }
                }
            );
        }

        const GetClaimTypeXProductCategory = () => {
            $('#ddlClaimType_PA').empty();
            $.get("@Url.Action("GetClaimTypeXProductCategoryDetail", "Claim")",
                { productCategoryID: $('#hdfProductCategory').val()},
                (data, textStatus, jqXHR) => {
                    $('#ddlClaimType_PA').append(`<option value='-1'>--โปรดระบุ--</option>`);

                    for (var i = 0; i < data.length; i++) {

                        let code = data[i].ClaimType_id;
                        let detail = data[i].ClaimType;

                        $('#ddlClaimType_PA').append(`<option value='${code}'>${detail}</option>`);
                    }
                }
            );
        }

        const GetHospitalNameDetail = () => {
            $("#ddlHospitalName_PA").select2({
                ajax: {
                    url: '@Url.Action("GetHospitalNameForPHDetail", "Claim")',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term, // search term
                            provinceId: $("#ddlProvinceHospital_PA").val(),
                            page: params.page
                        };
                    },
                    processResults: processDataHospitalName,
                    cache: true
                },
                placeholder: 'ค้นหารายการ',
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 3,
                //templateResult: formatRepo,
                templateSelection: formatRepoSelectionHospitalName,
                selectOnClose: true,
                language: {
                    inputTooShort: function () {
                        if ($('#ddlProvinceHospital_PA').val() == "-1") {
                            return 'กรุณาเลือกจังหวัดสถานพยาบาล';
                        } else {
                            return 'กรอกข้อมูลอย่างน้อย 3 ตัวอักษร';
                        }

                    }
                }
            });
        }

       const processDataHospitalName = (data) => {
            var mapdata = $.map(data, function (obj) {
                obj.id = obj.Code;
                obj.text = obj.Detail;
                return obj;
            });
            return { results: mapdata };
        }

       const formatRepoSelectionHospitalName = (repo) => {
            return repo.Detail || repo.text;
        }

        /*------END PA------*/
        //UUID
        const uuidv4 = () => {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        //delete
        const deleteClaim = (uuid) => {
            const index = arrCLPA.findIndex(v => v.uuid === uuid);
            arrCLPA.splice(index, index >= 0 ? 1 : 0);

            ClaimDT(arrCLPA);

            if (arrCLPA.length === 0) {
                $('#btnNextAcc').hide();
                $('#btn_prev2').show();
            }
        }

        //load DT
        const ClaimDT = (data) => {
            $('#dtClaim').empty();
            $('#dtClaim').DataTable({
                data: data,
                responsive: true,
                destroy: true,
                lengthChange: false,
                searching: false,
                info: false,
                paging: false,
                columns: [
                    { title: 'ชื่อผู้เอาประกัน', data: 'custname' },
                    { title: 'ยอดเงิน', data: 'amount', className: 'dt-right' },
                    {
                        title: 'ดำเนินการ',
                        data: null,
                        render: function (data) {
                            return `<a class="btn btn-warning" width="5px" onclick="LoadEditClaim('${data.uuid}')"><i class="fa fa-pencil"></i></a> <a class="btn btn-danger" width="5px" onclick="deleteClaim('${data.uuid}')"><i class="fa fa-trash"></i></a>`;
                        }
                    },
                ],
                footerCallback: function (row, data, start, end, display) {
                    var api = this.api(), data;

                    // Remove the formatting to get integer data for summation
                    var intVal = function (i) {
                        return typeof i === 'string' ?
                            i.replace(/[\$,]/g, '') * 1 :
                            typeof i === 'number' ?
                                i : 0;
                    };

                    // Total over this page
                    total = api
                        .column(2, { page: 'current' })
                        .data()
                        .reduce(function (a, b) {
                            return intVal(a) + intVal(b.amount);
                        }, 0);

                    $('#dtClaim tfoot').empty();
                    $('#dtClaim').append(`<tfoot><tr><th  style="text-align:right">Total:</th><th style="text-align:right">${numberWithCommas(total.toFixed(2))}</th></tr></tfoot>`);
                }
            });
        }

        const GetBankAccount = () => {
            $.get("@Url.Action("GetBankAccount", "Claim")", { productGroupId: 3, appCode: arrCLPA[0].appid},
                (data) => {

                    if (data[0].BankId != null && data[0].BankId != "") {

                        for (var i = 0; i < data.length; i++) {

                            let bankId = data[i].BankId;
                            let bankName = data[i].BankName;
                            let accountNo = data[i].AccountNo;
                            let accountName = data[i].AccountName;
                            currentAccountNo = accountNo;

                            if (arrBankAccount.length > 0) {
                                const index = arrBankAccount.findIndex(v => v.bankaccountno === accountNo);

                                if (!(index >= 0)) {
                                    const objBankAccount = new BankAccount(bankId, bankName, accountNo, accountName);
                                    arrBankAccount.push(objBankAccount);
                                }

                            } else {
                                const objBankAccount = new BankAccount(bankId, bankName, accountNo, accountName);
                                arrBankAccount.push(objBankAccount);
                            }
                            //console.log(arrBankAccount);
                            LoadBankAccount(arrBankAccount);
                        }
                    }
                }
            );
        }

        const LoadBankAccount = (arr) => {
            $('#banklist').empty();
            for (let i = 0; i < arr.length; i++) {
                let bankId = arr[i].bankid;
                let bankName = arr[i].bankname;
                let accountNo = arr[i].bankaccountno;
                let accountName = arr[i].bankaccountname;

                $('#banklist').append(`<li style="position:relative"><label><input style="position: absolute;top: 40%;margin-left: 10px;" type="radio" id="bankaccount${accountNo}" name="bankaccount" value="${accountNo}">
                   <span id="bankdetail${bankId}" style="padding-left: 40px;font-size:1.2em">${bankName}</span>
                   <br /><span id="bankaccountno" style="padding-left: 40px;font-size:1.2em">${accountNo}</span>
                   <br /><span id="bankaccountname" style="padding-left: 40px;font-size:1.2em">${accountName}</span></label></li>`);
            }
        }

       const GetPersonContact = () => {
            $.get("@Url.Action("GetPersonContact", "Claim")", { appCode: arrCLPA[0].appid},
                (data) => {

                    if (data[0].PersonContactTypeId != null && data[0].PersonContactTypeId != "") {

                        for (var i = 0; i < data.length; i++) {

                            let contacttypeid = data[i].PersonContactTypeId;
                            let contacttype = data[i].PersonContactType;
                            let contactname = data[i].PersonContactName;
                            let contactphone = data[i].PersonContactPhoneNo;

                            if (arrContact.length > 0) {
                                const index = arrContact.findIndex(v => v.contactphone === contactphone);

                                if (!(index >= 0)) {
                                    const objContact = new Contact(contacttypeid,contacttype,contactname,contactphone);
                                    arrContact.push(objContact);
                                }

                            } else {
                                const objContact = new Contact(contacttypeid, contacttype, contactname, contactphone);
                                arrContact.push(objContact);
                            }
                            //console.log(arrContact);
                            LoadPersonContact(arrContact);
                        }
                    }
                }
            );
        }

        const LoadPersonContact = (arr) => {
            $('#contactlist').empty();
            for (let i = 0; i < arr.length; i++) {
                let contacttypeid = arr[i].contacttypeid;
                let contacttype = arr[i].contacttype;
                let contactname = arr[i].contactname;
                let contactphone = arr[i].contactphone;
                let contactother = arr[i].contactother;

                if (!contactother) {
                    $('#contactlist').append(`<li style="position:relative"><label><input style="position: absolute;top: 40%;margin-left: 10px;" type="radio"  name="contact" value="${contactphone}">
                   <span style="padding-left: 40px;font-size:1.2em">${contacttype}</span>
                   <br /><span  style="padding-left: 40px;font-size:1.2em">${contactname}</span>
                   <br /><span  style="padding-left: 40px;font-size:1.2em">${contactphone}</span></label></li>`);
                } else {
                    $('#contactlist').append(`<li style="position:relative"><label><input style="position: absolute;top: 40%;margin-left: 10px;" type="radio"  name="contact" value="${contactphone}">
                   <span style="padding-left: 40px;font-size:1.2em">${contacttype}</span>
                   <br /><span  style="padding-left: 40px;font-size:1.2em">${contactname}</span>
                   <br /><span  style="padding-left: 40px;font-size:1.2em">${contactphone}</span>
                   <br /><span  style="padding-left: 40px;font-size:1.2em">${contactother}</span></label></li>`);
                }
            }
        }
        //Document Insert
        const DocumentInsert = (documentTypeId) => {
           $.ajax({
              type: 'POST',
              url: "@Url.Action("DocumentInset", "Claim")",
              data: {
                  documentTypeId: documentTypeId
              },
              dataType: 'json',
              async: false,
                 success: function (data) {
                     arrDocCode = [];
                     if (data.length > 0) {
                         for (var i = 0; i < data.length; i++) {
                             //เก็บCode28ไว้เช็ค
                             if (data[i].DocumentTypeId === 28) objDoc.doc28 = data[i].DocumentCode;
                             //push doccode to array
                             arrDocCode.push(data[i].DocumentCode);
                         }
                         //load doc
                         let str = arrDocCode.join();
                         DocumentSelectByDocCode(str);

                     } else {
                         swal("เกิดข้อผิดพลาด", data.Msg, "error")
                     }
                 }
            });
        }

        //Document Update
        const DocumentUpdate = (documentCode, claimOnLineId) => {
            $.ajax({
              type: 'POST',
              url: "@Url.Action("DocumentUpdate", "Claim")",
              data: {
                  documentCode: documentCode,
                  claimOnLineId: claimOnLineId
              },
              dataType: 'json',
              async: false,
               success: function (data) {
                   console.log(`update document - ${documentCode} : ${data.Result}`);
                 }
            });
        }

        //Document Select
        const DocumentSelectByDocCode = (docCode) => {
             $.get("@Url.Action("DocumentSelectByDocCode", "Claim")", { documentCode: docCode},
                 (data) => {
                     $('#dtDocument tbody').empty();
                     data = data.filter(function (obj) {
                         return obj.DocumentTypeId !== 29;
                     }).sort(function (a, b) { return a.SortOrder - b.SortOrder });
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; i++) {
                            $('#dtDocument tbody').append(`<tr>
                                                <td>${data[i].DocumentDetail}</td>
                                                <td><a href="${data[i].UrlScan}" target="_blank" class="btn btn-block btn-default">แนบเอกสาร</a></td>
                                                <td><a href="${data[i].UrlLinkOpen}" target="_blank" class="btn btn-block btn-default">ดูเอกสาร</a></td></tr>`)
                        }

                        $('#dtDocument').DataTable({
                            responsive: true,
                            lengthChange: false,
                            searching: false,
                            info: false,
                            paging: false,
                            destroy: true
                        });

                    } else {
                        $('#dtDocument').append(`<tbody><tr>
                                                <td>No Document</td>
                                                </tr></tbody>`)
                     }
                }
            );
        }

        //History
        const ClaimHistory = (customerDetailCode) => {
            $.get("@Url.Action("GetClaimPAHistory", "Claim")", { customerDetailCode: customerDetailCode},
                (data) => {
                    if (data.length > 0) {
                        $('#bodyHistory').empty();
                        for (var i = 0; i < data.length; i++) {
                            $('#bodyHistory').append(`<tr>
                                                <td>${data[i].ClaimCode}</td>
                                                <td>${toBuddhistYear(moment(data[i].DateIn), 'DD/MM/YYYY')}</td>
                                                <td>${data[i].HospitalName}</td>
                                                <td>${data[i].AccidentDetail}</td>
                                                <td>${data[i].ChiefComplain}</td>
                                                <td>${toBuddhistYear(moment(data[i].DateNotice), 'DD/MM/YYYY') }</td>
                                                <td>${data[i].ClaimStatus}</td>
                                                <td><a href="@ViewBag.LinkOverview${btoa(data[i].ClaimCode)}" target="_blank" class="btn btn-info"> <i class="fa fa-search"></i> เปิด</a></td></tr>`)
                        }

                        if ($.fn.dataTable.isDataTable('#dtHistory')) {
                            table = $('#dtHistory').DataTable();
                        }
                        else {
                            table = $('#dtHistory').DataTable({
                                responsive: true
                            });
                        }

                    } else {

                        $('#bodyHistory').empty();
                        $('#bodyHistory').append(`<tr><td>
                                                No Data
                                                </td></tr>`)
                    }
                }
            );
        }

        //LOAD DATA TABLES
        const LoadDTClaimList = () => {

            $('#dtClaimList tbody').empty();

            for (let i = 0; i < arrCLPA.length; i++) {
                $('#dtClaimList tbody').append(`<tr>
                                    <td>${arrCLPA[i].custname}</td>
                                    <td>${numberWithCommas(arrCLPA[i].amount)}</td></tr>`)
            }

            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
                return typeof i === 'string' ?
                    i.replace(/[\$,]/g, '') * 1 :
                    typeof i === 'number' ?
                        i : 0;
            };

            let total = arrCLPA.reduce(function (a, b) {
                return intVal(a) + intVal(b.amount);
            }, 0);

            $('#dtClaimList tbody').append(`<tr>
                                    <td style="font-weight: bold;">Total :</td>
                                    <td style="font-weight: bold;">${numberWithCommas(total.toFixed(2))}</td></tr>`)
        }

        const LoadDTBankAccountList = () => {
            const bankaccountno = $("input[name='bankaccount']:checked").val();
            const index = arrBankAccount.findIndex(v => v.bankaccountno === bankaccountno);

            $('#dtBankAccountList tbody').empty();

            $('#dtBankAccountList tbody').append(`<tr><td style="font-weight: bold;">ธนาคาร</td><td>${arrBankAccount[index].bankname}</td></tr>
                                                    <tr><td style="font-weight: bold;">เลขบัญชี</td><td>${arrBankAccount[index].bankaccountno}</td></tr>
                                                    <tr><td style="font-weight: bold;">ชื่อบัญชี</td><td>${arrBankAccount[index].bankaccountname}</td></tr>`)

        }

        const LoadDTContactList = () => {
            const contactphone = $("input[name='contact']:checked").val();
            const index = arrContact.findIndex(v => v.contactphone === contactphone);

            $('#dtContactList tbody').empty();

            $('#dtContactList tbody').append(`<tr><td style="font-weight: bold;">ประเภทผู้ติดต่อ</td><td>${arrContact[index].contacttype}</td></tr>
                                                    <tr><td style="font-weight: bold;">ชื่อผู้ติดต่อ</td><td>${arrContact[index].contactname}</td></tr>
                                                    <tr><td style="font-weight: bold;">เบอร์โทร</td><td>${arrContact[index].contactphone}</td></tr>
                                                    <tr><td style="font-weight: bold;">อื่นๆ ระบุ</td><td>${typeof (arrContact[index].contactother) == 'undefined' ? '-' : arrContact[index].contactother}</td></tr>`)

        }

        const GetCancelCauseClaim = () => {
            $('#ddlCancelCause').empty();
            $.get("@Url.Action("GetCancelCauseClaimDetail", "Claim")",
                (data, textStatus, jqXHR) => {
                    $('#ddlCancelCause').append("<option value='-1'>--โปรดระบุ--</option>");
                    for (var i = 0; i < data.length; i++) {

                        let code = data[i].Code;
                        let detail = data[i].Detail;

                        $('#ddlCancelCause').append("<option value='" + code + "'>" + detail + "</option>");
                    }

                }
            );
        }

        //1
        const SaveClaimOnLine = () => {

            const bankaccountno = $("input[name='bankaccount']:checked").val();
            const index = arrBankAccount.findIndex(v => v.bankaccountno === bankaccountno);

            const contactphone = $("input[name='contact']:checked").val();
            const indexContact = arrContact.findIndex(v => v.contactphone === contactphone);

            $.ajax({
                type: 'POST',
                url: "@Url.Action("ClaimOnLineInsert", "Claim")",
                data: {
                    productTypeId: objCOLPA.claimtypeId,
                    serviceByUserId: objCOLPA.servicenameId,
                    noticeByUserId: objCOLPA.servicenameId,
                    noticeByEmpId: null,
                    zebraCarOwnerByEmpId: objCOLPA.zebraCarOwnerId,
                    detail: objCOLPA.remark,
                    claimCount: arrCLPA.length,
                    payeeTypeId: 4, //ส่ง 4
                    payeeBankId: arrBankAccount[index].bankid,
                    payeeAccountNo: arrBankAccount[index].bankaccountno,
                    payeeAccountName: arrBankAccount[index].bankaccountname,
                    personContactTypeId: arrContact[indexContact].contacttypeid,
                    personContactName: arrContact[indexContact].contactname,
                    personContactPhoneNo: arrContact[indexContact].contactphone,
                    personContactTypeOther: arrContact[indexContact].contactother
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    if (data.IsResult) {
                        let count = 0;
                        let COL_Code = data.Result;
                        let COL_Id = data.ReferenceCode;

                        for (var i = 0; i < arrCLPA.length; i++) {

                            let result = SaveClaimHeaderPA(i, arrBankAccount[index].bankaccountname, arrCLPA[i].customerdetailcode, arrCLPA[i].hospitalid, arrCLPA[i].claimtypeid, "4140", arrCLPA[i].datehappen, arrCLPA[i].noticedate, null, arrCLPA[i].statusclaimid, '@ViewBag.BranchCode', objCOLPA.servicenameId, COL_Code, COL_Id, arrCLPA[i].denycauseid, null, arrCLPA[i].accident);

                            //console.log(`save claim header ${result} app id : ${arrCLPA[i].appid}`);

                            if (result) {
                                count++
                            } else {
                                break
                            };
                        }

                        //hide modal
                        $(".modal").modal("hide");

                        if (count === arrCLPA.length) {
                            //update
                            let r = UpdateIsActive(COL_Id);

                            if (r) {
                                //เก็บประวัติการทำรายการ
                                SaveClaimOnLinePayAuto_Transaction(COL_Id);
                                //เช็คว่าเป็นบัญชีใหม่ -Update Document 28 หน้าบัญชี
                                if (CheckNewBankAccount()) {
                                    let str = arrDocCode.join();
                                    //Update
                                    DocumentUpdate(str, COL_Id);
                                } else {
                                    //ไม่อัพเดต 28
                                    const index = arrDocCode.indexOf(objDoc.doc28);
                                    if (index > -1) {
                                        arrDocCode.splice(index, 1);
                                        let str = arrDocCode.join();

                                        //Update
                                        DocumentUpdate(str, COL_Id);
                                    }
                                }

                                //console.log(r);
                                //alert success
                                swal({
                                    title: "บันทึกข้อมูลเรียบร้อย",
                                    text: `เลขที่ COL : ${COL_Code}`,
                                    type: "success",
                                    showCancelButton: false,
                                    showConfirmButton: true,
                                    allowEscapeKey: false,
                                    allowOutsideClick: false,
                                    html: false
                                }, function (e) {
                                    window.open("@Url.Action("ClaimDetailMonitoring","Claim")", "_self");
                                });
                            } else {
                                swal("เกิดข้อผิดพลาด", `Update IsActive ไม่สำเร็จ`, 'error')
                            }
                        } else {
                            swal("เกิดข้อผิดพลาด", `บันทึก ClaimHeader ไม่สำเร็จ`, 'error')
                        }

                    } else {
                        swal(`เกิดข้อผิดพลาด !`, `ClaimOnLine Insert Fail - ${data.Msg}`, `error`);
                    }
                }
            });
        }

        //2
        const SaveClaimHeaderPA = (index, payerName, customerDetailCode, hospitalId, claimTypeId, claimStypeId, dateIn, dateOut, accidentCauseId, statusId, createdByBranchId, claimPayByCode, claimOnLineCode, claimOnLineId, denyCauseId, chiefComplainId, accidentDetail) => {
            let result = false;
            const Id = claimOnLineId;
            const claimRemark = accidentDetail;
            $.ajax({
                type: 'POST',
                url: "@Url.Action("SaveClaimHeaderForPACancel", "Claim")",
                data: {
                    customerDetailCode: customerDetailCode,
                    hospitalId: hospitalId,
                    claimTypeId: claimTypeId,
                    claimStypeId: claimStypeId,
                    dateIn: dateIn,
                    dateOut: dateOut,
                    accidentCauseId: accidentCauseId,
                    statusId: statusId,
                    createdByBranchId: createdByBranchId,
                    claimPayByCode: claimPayByCode,
                    claimOnLineCode: claimOnLineCode,
                    denyCauseId: denyCauseId,
                    chiefComplainId: chiefComplainId,
                    accidentDetail: accidentDetail,
                    remark: accidentDetail
                },
                dataType: 'json',
                async: false,
                success: function (data) {

                 const CL_Code = data[1];
                    if (data[0] === 'True') {
                        result = SaveClaimOnLineTmpt(Id, CL_Code, arrCLPA[index].appid, arrCLPA[index].schoolname, arrCLPA[index].custname, payerName, arrCLPA[index].startcoverdate, arrCLPA[index].endcoverdate, arrCLPA[index].customerstatus, arrCLPA[index].datehappen, arrCLPA[index].noticedate, arrCLPA[index].claimtype, arrCLPA[index].provincehospital, arrCLPA[index].hospital, arrCLPA[index].statusclaim, arrCLPA[index].amount, claimRemark)
                    } else {
                        swal("เกิดข้อผิดพลาด", `บันทึก ClaimHeader ไม่สำเร็จ - ${data[2]}`, 'error')
                        //console.log(`บันทึก ClaimHeader ไม่สำเร็จ -  ${data[2]}`);
                    }
                }
            });

            return result;
        }

        //3
        const SaveClaimOnLineTmpt = (claimOnLineId, claimCode, appId, schoolName, customerName, payerName, startcoverdate, endcoverdate, appStatus, dateIn, dateOut, claimAdmitType, hospitalProvince, hospitalname, claimStatus, claimAmount, claimRemark) => {
            let result = false;
            $.ajax({
                type: 'POST',
                url: "@Url.Action("ClaimOnLineTmpInsert", "Claim")",
                data: {
                    claimOnLineId: claimOnLineId,
                    claimCode: claimCode,
                    applicationCode: appId,
                    schoolName: schoolName,
                    customerName: customerName,
                    payerName: payerName,
                    startCoverDate: startcoverdate,
                    endCoverDate: endcoverdate,
                    appStatus: appStatus,
                    dateIn: dateIn,
                    dateOut: dateOut,
                    claimAdmitType: claimAdmitType,
                    hospitalProvince: hospitalProvince,
                    hospitalName: hospitalname,
                    claimStatus: claimStatus,
                    claimAmount: claimAmount,
                    claimRemark: claimRemark
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    if (data.IsResult) {
                        result = data.IsResult;
                    } else {
                        swal("เกิดข้อผิดพลาด", `บันทึก ClaimOnLineTmp ไม่สำเร็จ - ${data.Msg}`, 'error')
                    }
                }
            });
            return result;
        }

        //PA Validate
        const ValidatePA = (customerId, hospitalId, accidentCauseId, chiefComplainId, dateHappen, dateNotice) => {
            let result = [IsResult = false ,  Msg = "" ];
            $.ajax({
                type: 'GET',
                url: "@Url.Action("ClaimHeaderForPA_Validate", "Claim")",
                data: {
                    customerId: customerId,
                    hospitalId: hospitalId,
                    accidentCauseId: accidentCauseId,
                    chiefComplainId: chiefComplainId,
                    dateHappen: dateHappen,
                    dateNotice: dateNotice
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                     result.IsResult = data.IsResult;
                     result.Msg = data.Msg;
                }
            });
            return result;
        }

        //Document Validate
        const ValidateDocument = (documentCode) => {

            let result = [IsResult = false ,  Msg = "" ];
            $.ajax({
                type: 'GET',
                url: "@Url.Action("DocumentValidate", "Claim")",
                data: {
                    documentCode: documentCode
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    result.IsResult = data.IsResult;
                    result.Msg = data.Msg;
                }
            });
            return result;
        }

        //Update
        const UpdateIsActive = (claimOnLineId) => {
            let result = false;
            $.ajax({
                type: 'POST',
                url: "@Url.Action("ClaimOnLineIsActiveUpdate", "Claim")",
                data: {
                    claimOnLineId: claimOnLineId
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    result = data.IsResult;
                }
            });
            return result;
        }

        //check date in , out
        const CheckDateInDateOut = () => {

            let result = false;
            let dateIn = $('#dtpDateHappen_PA').datepicker('getDate');
            let dateOut = $('#dtpNoticeDate_PA').datepicker('getDate');
            if (dateIn <= dateOut) {
                result = true;
            }

            return result;
        }

        //clear bank , contact
        const ClearBankAndContactList = () => {
            arrBankAccount = [];
            arrContact = [];
            $('#banklist').empty();
            $('#contactlist').empty();
        }

        //check new bankaccount
        const CheckNewBankAccount = () => {

            result = false;
            const selected_bankaccount = $("input[name='bankaccount']:checked").val();

            if (selected_bankaccount !== currentAccountNo) {
                result = true;
            }
            return result;
        }

        //validate amount
        const ValidateAmount = () => {
            let result = { IsResult : false, Msg : "" };

            const amount = $('#txtAmount').val().replace(',', '');

            if (parseFloat(amount) <= parseFloat(Coverage)) {
                result.IsResult = true;
                result.Msg = "ok";
            } else {
                result.IsResult = false;
                result.Msg = "กรุณาตรวจสอบยอดเงิน";
            }

            return result;
        }

       //CHECK Duplicate ClaimOnLine
        const DuplicateClaimOnLine = (appId, date) => {
            $.get('@Url.Action("DuplicateClaimOnLine","ClaimOnline")', { productGroup: "PA", appId: appId, date: date},
                function (response) {
                    if (response.IsResult === true) {
                        if (response.Count >0) {
                            //Count Claim
                            swal_info("แจ้งเตือน! วันที่รักษาซ้ำ", "โปรดตรวจสอบว่าเป็นเคลมเดียวกันหรือไม่", "รับทราบ")
                        }
                    } else {
                        swal("เกิดข้อผิดพลาด!", response.Msg, 'error');
                    }
                })
        }

        const PACustomerBenefit = (customerCode) => {
           $.ajax({
               type: 'GET',
               url: "@Url.Action("PACustomerBenefit", "Claim")",
               data: {
                   customerCode: customerCode
               },
               dataType: 'json',
               success: function (data) {
                   //debuger
                   if (data != null) {
                       $('#dtBenefit tbody').empty();
                       for (var i = 0; i < data.length; i++) {
                           $('#dtBenefit tbody').append(`<tr><td style="text-align:left">${data[i].BenefitDetail}</td><td style="text-align:right">${data[i].Coverage}</td></tr>`);
                       }
                   }
               }
           });
        }

        //-----------for edit-----------//
        //Load Edit
        const LoadEditClaim = (uuid) => {

            const index = arrCLPA.findIndex(v => v.uuid === uuid);

            let customerdetailcode = arrCLPA[index].customerdetailcode;
            let arrDateHappen = arrCLPA[index].datehappen.split('/');
            let dateHappen = new Date(parseInt(arrDateHappen[2]) - 543, parseInt(arrDateHappen[1]) - 1, parseInt(arrDateHappen[0]));
            let arrDateNotice = arrCLPA[index].noticedate.split('/');
            let dateNotice = new Date(parseInt(arrDateNotice[2]) - 543, parseInt(arrDateNotice[1]) - 1, parseInt(arrDateNotice[0]));

            GetCustomerDetailForEdit(customerdetailcode);

            $('#hdfuuId_Edit').val(uuid);
            $('#hdfCustomerDetail_Edit').val(customerdetailcode);
            $('#dtpDateHappen_PA_Edit').datepicker("setDate", dateHappen).datepicker('update').trigger('change');
            $('#dtpNoticeDate_PA_Edit').datepicker("setDate", dateNotice).datepicker('update').trigger('change');

            $('#ddlClaimType_PA_Edit').val(arrCLPA[index].claimtypeid).trigger('change');
            $('#ddlProvinceHospital_PA_Edit').val(arrCLPA[index].provincehospitalid).trigger('change');

            //load autocomplete select2
            $('#ddlHospitalName_PA_Edit').empty().append('<option value="' + arrCLPA[index].hospitalid + '">' + arrCLPA[index].hospital + '</option>')
                .val(arrCLPA[index].hospitalid).trigger('change');

            $('#txtAmount_Edit').val(arrCLPA[index].amount);
            $('#txtAccidentDetail_Edit').val(arrCLPA[index].accident);

            $('#myModalEdit').modal('show');

        }

        const SaveEdit = () => {
            let uuid = $('#hdfuuId_Edit').val();
            const index = arrCLPA.findIndex(v => v.uuid === uuid);

            arrCLPA[index].datehappen = $('#dtpDateHappen_PA_Edit').val();
            arrCLPA[index].noticedate = $('#dtpNoticeDate_PA_Edit').val();
            arrCLPA[index].claimtype = $('#ddlClaimType_PA_Edit option:selected').text();
            arrCLPA[index].claimtypeid = $('#ddlClaimType_PA_Edit').val();
            arrCLPA[index].provincehospital = $('#ddlProvinceHospital_PA_Edit option:selected').text();
            arrCLPA[index].provincehospitalid = $('#ddlProvinceHospital_PA_Edit').val();
            arrCLPA[index].hospital = $('#ddlHospitalName_PA_Edit option:selected').text();
            arrCLPA[index].hospitalid = $('#ddlHospitalName_PA_Edit').val();
            arrCLPA[index].amount = $('#txtAmount_Edit').val().trim();
            arrCLPA[index].accident = $('#txtAccidentDetail_Edit').val().trim();

            swal_success(function (e) {
                //hide modal
                $('#myModalEdit').modal('hide');
                //load datatables
                ClaimDT(arrCLPA);
            });
        }

        function toBuddhistYear(moment, format) {
            var christianYear = moment.format('YYYY')
            var buddhishYear = (parseInt(christianYear) + 543).toString()
            return moment
                .format(format.replace('YYYY', buddhishYear).replace('YY', buddhishYear.substring(2, 4)))
                .replace(christianYear, buddhishYear)
        }

        const GetCustomerDetailForEdit = (customerCode) => {
            $.ajax({
                type: 'GET',
                url: "@Url.Action("GetPACustomerDetail", "Claim")",
                data: {
                    customerDetailCode: customerCode
                },
                dataType: 'json',
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if (data != null) {
                        //Check App Status
                        if (data.ApplicationStatusCode == "3010" || data.ApplicationStatusCode == "3020" ||
                            data.ApplicationStatusCode == "3030" || data.ApplicationStatusCode == "3040") {
                            //Check Customer Detail Status ถ้า สถานะผู้เอาประกัน เป็น ยกเลิก กับยกเลิกสวมสิทธิ์ ไม่ให้บันทึกเคลม
                            if (data.CustomerStatusCode != "3202" && data.CustomerStatusCode != "3204") {

                                $('#lblApplicationID_Edit').text(data.ApplicationCode);
                                $('#lblCustFullName_Edit').text(data.CustomerName);
                                $('#lblSchoolName_Edit').text(data.SchoolName);
                                $('#lblStatus_Edit').text(data.CustomerStatus);
                                let startCoverDate = toBuddhistYear(moment(data.StartCoverDate), 'DD/MM/YYYY');
                                let endCoverDate = toBuddhistYear(moment(data.EndCoverDate), 'DD/MM/YYYY');
                                $('#lblStartCoverDate_Edit').text(startCoverDate);
                                $('#lblEndCoverDate_Edit').text(endCoverDate);
                                $('#lblProductDetail_Edit').text(data.ProductDetail);
                                $('#lblCoverage_Edit').text(`${data.BenefitDetail}:${data.Coverage}`);

                                CoverageForEdit = data.Coverage;
                                $('#hdfProductCategory_Edit').val(data.ProductCategoryCode)
                                $('#hdfCustomerStatusCode_Edit').val(data.CustomerStatusCode)
                                $('#hdfSchoolId_Edit').val(data.SchoolId)
                                GetClaimTypeXProductCategoryForEdit();

                                $('#ddlClaimType_PA_Edit').prop('disabled', false);
                            } else {
                                //Alert ไม่ให้บันทึกเคลม
                                swal("แจ้งเตือน !!", `ไม่สามารถบันทึกเคลมได้ เนื่องจากสถานะผู้เอาประกันเป็น ${data.CustomerStatus}`, "error");
                                $('#ddlClaimType_PA_Edit').prop('disabled', true);
                                $('#ddlClaimType_PA_Edit').empty();
                            }
                        } else {
                            //Alert ไม่ให้บันทึกเคลม
                            swal("แจ้งเตือน !!", `ไม่สามารถบันทึกเคลมได้ เนื่องจากสถานะกรมธรรม์เป็น ${data.ApplicationStatus}`, "error");
                            $('#ddlClaimType_PA_Edit').prop('disabled', true);
                            $('#ddlClaimType_PA_Edit').empty();
                        }
                    }
                }
            });

        }

       const GetClaimTypeXProductCategoryForEdit = () => {
           $('#ddlClaimType_PA_Edit').empty();

           $.ajax({
               type: 'POST',
               url: "@Url.Action("GetClaimTypeXProductCategoryDetail", "Claim")",
               data: {
                   productCategoryID: $('#hdfProductCategory_Edit').val()
               },
               dataType: 'json',
               async: false,
               success: function (data) {
                   $('#ddlClaimType_PA_Edit').append(`<option value='-1'>--โปรดระบุ--</option>`);

                   for (var i = 0; i < data.length; i++) {

                       let code = data[i].ClaimType_id;
                       let detail = data[i].ClaimType;

                       $('#ddlClaimType_PA_Edit').append(`<option value='${code}'>${detail}</option>`);
                   }
                   $('#ddlClaimType_PA_Edit').select2({ dropdownParent: $("#myModalEdit") });
               }
           });
       }

        //validate amount for edit
        const ValidateAmountForEdit = () => {

            let result = { IsResult: false, Msg: "" };

            const amount = $('#txtAmount_Edit').val().replace(',', '');

            if (parseFloat(amount) <= parseFloat(CoverageForEdit)) {
                result.IsResult = true;
                result.Msg = "ok";
            } else {
                result.IsResult = false;
                result.Msg = "กรุณาตรวจสอบยอดเงิน";
            }

            return result;
        }

        //check date in , out for Edit
        const CheckDateInDateOutForEdit = () => {

            let result = false;
            let dateIn = $('#dtpDateHappen_PA_Edit').datepicker('getDate');
            let dateOut = $('#dtpNoticeDate_PA_Edit').datepicker('getDate');
            if (dateIn <= dateOut) {
                result = true;
            }

            return result;
        }

        const GetHospitalNameDetailForEdit = () => {
            $("#ddlHospitalName_PA_Edit").select2({
                dropdownParent: $("#myModalEdit"),
                ajax: {
                    url: '@Url.Action("GetHospitalNameForPHDetail", "Claim")',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term, // search term
                            provinceId: $("#ddlProvinceHospital_PA_Edit").val(),
                            page: params.page
                        };
                    },
                    processResults: processDataHospitalName,
                    cache: true
                },
                placeholder: 'ค้นหารายการ',
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 3,
                //templateResult: formatRepo,
                templateSelection: formatRepoSelectionHospitalName,
                selectOnClose: true,
                language: {
                    inputTooShort: function () {
                        if ($('#ddlProvinceHospital_PA_Edit').val() == "-1") {
                            return 'กรุณาเลือกจังหวัดสถานพยาบาล';
                        } else {
                            return 'กรอกข้อมูลอย่างน้อย 3 ตัวอักษร';
                        }

                    }
                }
            });
        }

        const SaveClaimOnLinePayAuto_Transaction = (COL_Id) => {
            let result = false;
            $.ajax({
                type: 'POST',
                url: "@Url.Action("SaveClaimOnLinePayAuto_Transaction", "PayAuto")",
                data: {
                    _type: 1, //บันทึกลง table หลัก
                    payAutoTypeId: 1, //ขออนุมัติ
                    claimOnlineId: COL_Id
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    if (data.IsSuccess) {
                        result = true;
                    }
                }
            });
            return result;
        }
    </script>
}