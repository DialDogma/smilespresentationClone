@{
    ViewBag.Title = "รายละเอียด PAชุมชน รออนุมัติ";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<h2>PANewAppApprove</h2>*@

@*<style>
        a {
            cursor: pointer;
        }
    </style>*@

<form class="form-horizontal">

    <div class="row">
        <div class="col-xs-12">
            @{ if (ViewBag.RoundStatusId == 2 || ViewBag.RoundStatusId == 4 || ViewBag.RoundStatusId == 5 || ViewBag.RoundStatusId == 7 || ViewBag.RoundStatusId == 8)
                {
                    <div class="callout callout-warning">
                        <h4>Warning !! </h4>

                        <p>รบกวนตรวจสอบสถานะของรอบ</p>
                    </div>
                }}
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12">

            @* ApplicationID *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-aqua bs-glyphicons"><i class="fa fa-fw fa-heartbeat"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">Application ID</span>
                        <span class="info-box-number"><label id="lblApplicationID"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>

            @* เลขที่กรมธรรม์ *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-yellow"><span class="glyphicon glyphicon-tasks"></span></span>

                    <div class="info-box-content">
                        <span class="info-box-text">เลขที่กรมธรรม์</span>
                        <span class="info-box-number"><label id="lblPolicyNo"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>

            @* สถานะกรรมธรรม์ *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-green"><span class="glyphicon glyphicon-lock"></span></span>

                    <div class="info-box-content">
                        <span class="info-box-text">สถานะกรมธรรม์</span>
                        <span class="info-box-number"><label id="lblApplicationStatus"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
        </div>
    </div>

    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs" id="tabDetail">
            <li class="active"><a href="#tab_ApplicationDetail" data-toggle="tab" aria-expanded="true">ข้อมูลชุมชน</a></li>
            <li class=""><a href="#tab_CustomerDetail" data-toggle="tab" aria-expanded="false">ข้อมูลผู้เอาประกัน</a></li>
            <li class=""><a href="#tab_CustomerBenefit" data-toggle="tab" aria-expanded="false">ความคุ้มครอง</a></li>
            @*<li class="pull-right"><a href="#" class="text-muted"><i class="fa fa-gear"></i></a></li>*@
        </ul>
        <div class="tab-content">

            <div class="tab-pane active" id="tab_ApplicationDetail">
                <div class="row">
                    <div class="col-xs-12">
                        @* Application Detail *@
                        <div class="box box-primary">
                            <div class="box-header with-border " style="background-color:#3987b4; color:white">
                                <h3 class="box-title">รายละเอียด กรมธรรม์</h3>

                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">

                                <div id="divAppDetail">

                                    <div class="row">
                                        <div class="col-xs-3">
                                            <label>กลุ่มหน่วยงาน</label>
                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlOrganizeGroup">
                                                <option value="-1">--โปรดระบุ--</option>
                                                @{
                                                    foreach (var item in ViewBag.OrganizeGroups)
                                                    {
                                                        <option value="@item.OrganizeGroup_ID">@item.OrganizeGroupDetail</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                        <div class="col-xs-4">
                                            <label>ประเภทหน่วยงาน</label>
                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlOrganizeType"></select>
                                        </div>
                                        <div class="col-xs-2">
                                            <label>จังหวัด</label>
                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlProvince">
                                                @{ foreach (var item in ViewBag.Provinces)
                                                    {
                                                        <option value="@item.ProvinceId">@item.Province</option>
                                                    }
                                                }
                                            </select>
                                        </div>

                                        <div class="col-xs-3">
                                            <label>สาขา</label>
                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlBranch">
                                                @{
                                                    foreach (var item in ViewBag.Branchs)
                                                    {
                                                        <option value="@item.BranchID">@item.Branch</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-8" style="padding-top:6px;">
                                            @* หน่วยงาน *@
                                            <label>หน่วยงาน / โรงเรียน</label>
                                            @*<select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlOrganize">
                                                </select>*@
                                            <input class="form-control" type="text" id="ddlOrganizeName" />
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-8" style="padding-top:6px;">
                                            @* Policy Name *@
                                            <label>ชื่อกรมธรรม์</label>
                                            <input type="text" class="form-control" id="txtPolicyName" />
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-8" style="padding-top:6px;">
                                            @* Address *@
                                            <label>ที่อยู่</label>
                                            <input type="text" class="form-control" id="txtAddress1" />
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-8" style="padding-top:6px;">
                                            @* Address *@
                                            <input type="text" class="form-control" id="txtAddress2" />
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>จังหวัด</label>
                                            <input type="text" class="form-control" id="txtProvince" />
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>อำเภอ</label>
                                            <input type="text" class="form-control" id="txtDistrict" />
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>ตำบล</label>
                                            <input type="text" class="form-control" id="txtSubDistrict" />
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>รหัสไปรษณีย์</label>
                                            <input type="text" class="form-control" id="txtZipCode" />
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>วันเริ่มสัญญา</label>

                                            <div class="input-group date">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                                <input type="text" class="form-control pull-right" id="dtpStartCoverDate">
                                            </div>
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>วันสิ้นสุดสัญญา</label>
                                            <div class="input-group date">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </div>
                                                <input type="text" class="form-control pull-right" id="dtpEndCoverDate">
                                            </div>
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>แผน</label>
                                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlProduct">
                                                @{
                                                    foreach (var item in ViewBag.Products)
                                                    {
                                                        <option value="@item.ProductId">@item.Product</option>
                                                    }
                                                }
                                            </select>
                                        </div>

                                        <div class="col-xs-3" style="padding-top:6px;">
                                            <label>เบี้ย</label>
                                            <input type="text" class="form-control" id="txtPremium" />
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12" style="padding-top:7px;">
                                        <div class="col-xs-3" style="padding-top:6px">
                                            <label>ตัวเลือกข้อมูลผู้ประสานงานชุมชน :</label>
                                        </div>
                                        <div class="col-xs-9" style="padding:8px; background-color:#F88017; color:white;">
                                            <span id="spanContactCommunity" style="font-size: 18px;">ไม่มีผู้ประสานงานชุมชน</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" id="divContactCommunity">
                                    <div class="col-xs-12" style="padding-top:7px;">

                                        @* ContractPACommunity *@
                                        <div class="box box-primary">
                                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                                <h3 class="box-title">ผู้ประสานงานชุมชน</h3>

                                                @*<div class="box-tools pull-right">
                                                          <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                                              <i class="fa fa-minus"></i>
                                                          </button>
                                                    </div>*@
                                                <!-- /.box-tools -->
                                            </div>
                                            <!-- /.box-header -->
                                            <div class="box-body">
                                                <div class="row">
                                                    <div class="col-xs-3">
                                                        <label>คำนำหน้า</label>
                                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true" id="ddlTitle">
                                                            @{
                                                                foreach (var item in ViewBag.Titles)
                                                                {
                                                                    <option value="@item.TitleId">@item.Title</option>
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>ชื่อ</label>
                                                        <input type="text" id="txtFirstName" class="form-control" />
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>นามสกุล</label>
                                                        <input type="text" id="txtLastName" class="form-control" />
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-3" style="padding-top:6px">
                                                        <label>เบอร์โทรศัพท์</label>
                                                        <input type="text" id="txtMobileNumber" class="form-control" data-inputmask="'mask': '999-9999999'" />
                                                    </div>
                                                    <div class="col-xs-4" style="padding-top:6px">
                                                        <div class="col-xs-1" style="padding-left:3px;padding-top: 32px">
                                                            <input type="radio" name="r2" class="minimal" checked style="position: absolute; opacity: 0;" id="rdoZCardId" value="1">
                                                        </div>
                                                        <div class="col-xs-11 input-group" id="divZcardId">
                                                            <label class="control-label" for="">หมายเลขบัตรประชาชน</label>
                                                            <input type="text" class="form-control" id="txtZCardId" name="txtZCardId" data-inputmask="'mask': '9-9999-99999-99-9'" />
                                                            <span class="input-group-btn" style="padding-top: 27px">
                                                                <button type="button" id="btnChkIdcard" class="btn btn-primary">ตรวจสอบ</button>
                                                            </span>
                                                        </div>
                                                    </div>

                                                    <div class="col-xs-4" style="padding-top:6px">

                                                        <div class="col-xs-1" style="padding-left:3px;padding-top: 32px">
                                                            <input type="radio" name="r2" class="minimal" style="position: absolute; opacity: 0;" id="rdoPassport" value="0">
                                                        </div>
                                                        <div class="col-xs-11 input-group" id="divPassport">
                                                            <label class="control-label" for="lblPassportNo">หมายเลขพาสปอร์ต</label>
                                                            <input type="text" class="form-control" id="txtPassportNo" placeholder="หมายเลขพาสปอร์ต">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row" style="padding-top:6px">

                                                    <div class="col-xs-3">
                                                        <label>ธนาคาร :</label>
                                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlBank" name="ddlBank">
                                                            <option value="-1">--โปรดระบุ--</option>

                                                            @{foreach (var item in ViewBag.OrganizeBank)
                                                                {
                                                                    <option value="@item.Organize_ID">@item.OrganizeDetail</option>
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>ชื่อบัญชี :</label>
                                                        <input type="text" class="form-control " id="txtAccountName" name="txtAccountName" />
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>เลขที่บัญชี :</label>
                                                        <input type="text" class="form-control " id="txtAccountNo" name="txtAccountNo" />
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /.box-body -->
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-4 col-xs-offset-4" style="text-align:center">
                                        <button type="button" id="btnEditApplicationDetail" class="btn btn-success" style="width:50%"> บันทึกการแก้ไข </button>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>

                        @* ContractAgent *@
                        <div class="box box-primary">
                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                <h3 class="box-title">ข้อมูลผู้ประสานงานโครงการ</h3>

                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <table id="dtContractAgent" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                                    </div>
                                </div>
                                <div class="row">
                                    @*<div class="col-xs-3">
                                            <button type="button" class="btn btn-primary" id="btnAddContactAgent" style="width:100%">เพิ่มผู้ประสานงาน</button>
                                        </div>*@
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>

                        @* Consent *@
                        <div class="box box-primary">
                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                <h3 class="box-title">การให้ความยินยอมการเก็บ รวบรวม ใช้เปิดเผยข้อมูลส่วนบุคคล</h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="box-body">
                                <div class="box-group">
                                    <div class="col-xs-6">
                                        <button type="button" class="btn btn-primary" id="btnAddConsent" style="background-color:goldenrod; color:black">ข้อมูล PDPA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="box box-primary">
                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                <h3 class="box-title">รายการรับข้อมูลผู้เอาประกัน</h3>

                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <table id="dtApplicationRound" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                                    </div>
                                </div>
                                @*<div class="row">
                                        <div class="col-xs-3">
                                            <button type="button" class="btn btn-primary" id="btnEditApplicationRound" style="width:100%">แก้ไขจำนวนคน</button>
                                        </div>
                                    </div>*@
                            </div>
                            <!-- /.box-body -->
                        </div>

                        @* Payment Data *@
                        <div class="box box-primary">
                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                <h3 class="box-title">ข้อมูลเบี้ยประกัน</h3>

                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-xs-5">

                                        <div class="box box-warning">
                                            <div class="box-header with-border" style="background-color:#f39c12; color:white;text-align:center">
                                                <h3 class="box-title">สรุปเบี้ยประกัน</h3>
                                                <!-- /.box-tools -->
                                            </div>

                                            <div class="box-body">
                                                <div class="row">
                                                    <div class="col-xs-12">
                                                        <table id="dtApplicationRoundSum" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-7">

                                        <div class="box box-warning">
                                            <div class="box-header with-border" style="background-color:#f39c12; color:white;text-align:center">
                                                <h3 class="box-title">ยอดชำระเงินใน Cash Receive</h3>
                                                <!-- /.box-tools -->
                                            </div>

                                            <div class="box-body">
                                                <div class="row">
                                                    <div class="col-xs-12">
                                                        <span class="btn btn-warning btn-sm" style="float:right" id="btnCheckPayment"><i class="glyphicon glyphicon-bitcoin"></i> เช็คการชำระเงิน</span>
                                                    </div>
                                                    <div class="col-xs-12">
                                                        <table id="dtPremiumFromCashReceive" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.tab-pane -->
            <div class="tab-pane" id="tab_CustomerDetail">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box box-info">
                            <div class="box-header with-border" style="background-color:#00c0ef; color:white">
                                <h3 class="box-title">สรุปข้อมูลผู้เอาประกัน</h3>

                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.box-tools -->
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">

                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>รอบ</label>
                                        <select id="ddlRound" class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="9" tabindex="-1" aria-hidden="true">
                                            @{ foreach (var item in ViewBag.Round)
                                                {
                                                    <option value="@item.ApplicationRoundId">@item.Round</option>
                                                }}
                                        </select>
                                    </div>
                                    <div class="col-xs-3">
                                        <label>Appliction ID</label>
                                        <input class="form-control" id="txtApplicationCodeInRound" />
                                    </div>
                                    <div class="col-xs-6">
                                        <label>ชื่อกรมกรรม์</label>
                                        <input class="form-control" id="txtPolicyInRound" />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12" style="padding-top:6px">
                                        <table id="dtCustomerDetail" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.tab-pane -->
            <!--.tab-pane-->
            <div class="tab-pane" id="tab_CustomerBenefit">
                <div class="row">
                    <div class="col-xs-12">
                        @Html.Partial("~/Views/PartialView/_PACommunityBenefit.cshtml")
                    </div>
                </div>
            </div>
            <!-- /.tab-pane -->
            <!--/.tab-pane-->
        </div>
        <!-- /.tab-content -->
    </div>

    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-body" style="text-align:center">
                    <button type="button" id="btnApprovePolicy" class="btn btn-success" style="width:20%"> อนุมัติออกกรมธรรม์ </button>
                    <button type="button" id="btnUnApprovePolicy" class="btn btn-danger" style="width:20%"> ไม่อนุมัติออกกรมธรรม์ </button>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hdfApplicationID" value="@ViewBag.ApplicationID" />
    <input type="hidden" id="hdfapplicationStatusId" />
    <input type="hidden" id="hdfBranchID" />
    <input type="hidden" id="hdfOrganizeID" />
    <input type="hidden" id="hdfApplicationRoundID" />
    <input type="hidden" id="hdfApplicationRoundStatusId" />

    @* Modal *@

    @* Edit ApplicationRound *@
    <div class="modal fade in" id="modal-EditRound" style="display: none; padding-right: 17px;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">แก้ไขจำนวนคนนำเข้า</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>รหัสรอบ :</label>
                            <input type="text" class="form-control input-sm" disabled id="txtEditRoundID" />
                        </div>
                        <div class="col-xs-5">
                            <label>วันที่มีผลบังคับ :</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control input-sm" id="dtpEditEffectiveDate" disabled>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <table id="dtApplicationSubRound" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>จำนวนคนชำระเบี้ย :</label>
                            <input type="text" class="form-control input-sm" id="txtEditAddCustomerBuy" />
                        </div>
                        <div class="col-xs-5">
                            <label>สิทธิ์ฟรี :</label>
                            <input type="text" class="form-control input-sm" id="txtEditAddCustomerFree">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>เบี้ยรวม :</label>
                            <input class="form-control" id="txtEditPremiumSum" disabled />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnUpdateApplicationRound">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @* Add ContractAgent *@
    <div class="modal fade in" id="modal-AddContract" style="display: none; padding-right: 17px;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">ข้อมูลผู้ประสานงานโครงการ</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>ประเภทผู้ประสานงานโครงการ :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlContractProjectType" name="ddlContractProjectType">
                                <option value="-1">--โปรดระบุ--</option>
                                @{foreach (var item in ViewBag.ContractAgentType)
                                    {
                                        <option value="@item.ApplicationAgentTypeId">@item.ApplicationAgentType</option>
                                    }

                                }
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>ผู้ประสานงานโครงการ :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlContractProjectAdd" name="ddlContractProjectAdd"></select>
                        </div>
                    </div>

                    @*<div class="row" style="padding-top:6px">
                            <div class="col-xs-10 col-xs-offset-1">
                                <label>เปอร์เซนต์ผู้ประสานงาน</label>
                                <div class="input-group">
                                    <input type="text" class="form-control input-sm " style="text-align:right" id="txtPerSentAdd" name="txtPerSentAdd" />
                                    <div class="input-group-addon">%</div>
                                </div>
                            </div>
                        </div>*@
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnAddContractPersent" name="btnAddContractPersent">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @* Cancel UnApprove *@
    <div class="modal fade in" id="modal-CancelCauseApprove" style="display: none; padding-right: 17px;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">ไม่อนุมัติออกกรมธรรม์</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>สาเหตุการไม่อนุมัติ</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlCancelCause" name="ddlCancelCause">
                                <option value="-1">--โปรดระบุ--</option>
                                @{ foreach (var item in ViewBag.CancelCauses)
                                    {
                                        <option value="@item.UnApproveCauseId">@item.UnApproveCause</option>
                                    }}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>หมายเหตุ</label>
                            <textarea class="form-control" rows="10" placeholder="Enter ..." id="txtRemarkCancel"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnSaveCancelApprove">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <input type="hidden" id="hdfLinkCashReceiveCheckPayment" value="@ViewBag.LinkCashReceive" hidden />
</form>

@section ViewSpecificJavascript
{
    <script>

        $(function () {
            var chat = $.connection.myHub;

            //Start Connection
            $.connection.hub.start().done(function () {

                chat.server.joinGroup(@ViewBag.userID);
                $('#btnApprovePolicy').click(function (e) {
                    e.preventDefault();

                    swal({
                        title: "",
                        text: "ยืนยันการอนุมัติหรือไม่ ?",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "ตกลง",
                        cancelButtonText: "ยกเลิก",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    },
                        function (isConfirm) {
                            if (isConfirm) {
                                //swal("Deleted!", "Your imaginary file has been deleted.", "success");
                                chat.server.sendNotice("", "");
                                DoApprovePolicy();

                            } else {
                                swal("ยกเลิกทำรายการ", "", "error");

                            }
                        }
                    );

                });

                $('#btnCheckPayment').click(function (e) {
                    e.preventDefault();
                    let linkCashReceive = $('#hdfLinkCashReceiveCheckPayment').val();
                    let applicationCode = $('#lblApplicationID').text();
                    bob = window.open('', '_blank');
                    bob.location = linkCashReceive + "app=" + applicationCode;
                });

                $('#btnSaveCancelApprove').click(function (e) {
                    e.preventDefault();

                    let v_validateForUnApprove = IsValidateForUnApprovePolicy();

                    if (v_validateForUnApprove != "") {

                        swal("ตรวจสอบข้อมูล", v_validateForUnApprove, "warning");
                        $('#modal-CancelCauseApprove').addClass("modal_itemcenter");
                        $('#modal-CancelCauseApprove').modal('show');
                    } else {
                        chat.server.sendNotice("", "");
                        DoUnApprovePolicy();

                    }
                });

            });
        });

        $('#btnAddConsent').click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: '@Url.Action("ValidatePDPAPost", "PACommunity")',
                data: {
                    AppID: $('#hdfApplicationID').val()
                },
                async: false,
                dataType: "json",
                success: function (response) {
                    if (response.status == true) {
                        window.open("@Url.Action("PDPAPost", "PACommunity")?AppID=" + $('#hdfApplicationID').val() + "&Mode=" + "upsert");
                    }
                }
            });
         });

        $(function () {
            $('.select2').select2();
            $('#dtpStartCoverDate').datepicker({
                format: "dd/mm/yyyy", autoclose: true, language: 'th-th',
                beforeShowDay: function (date) {
                    switch (date.getDate()) {
                        case 1:
                            return true;
                        case 16:

                            return true;
                        default:
                            return false;
                    }
                },
            });
            $('#dtpEndCoverDate').datepicker({ format: "dd/mm/yyyy", autoclose: true, language: 'th-th' });

            //$('#dtApplicationRound').DataTable();

            $('#rdoZCardId').on('ifChecked', function (event) {
                $("#divZcardId").find('input, button').prop('disabled', false);
                $("#divPassport").find('input').prop('disabled', true);
                $("#txtPassportNo").val("");
            });

            $('#rdoPassport').on('ifChecked', function (event) {
                $("#divZcardId").find('input, button').prop('disabled', true);
                $("#divPassport").find('input').prop('disabled', false);
                $("#txtZCardId").val("");
            });

            debugger;

            if ($("#hdfApplicationID").val() != "") {
                GetApplicationDetail1();
                GetOrganizeDetail();
                GetContactCommunity();
                GetApplicationRound();
                GetContactAgent();
                GetApplicationRoundSumPremium();
                GetPaymentFromCashReceive();
                debugger;

                if ($('#txtFirstName').val() != "") {
                    $('#divContactCommunity').show();
                    $('#btnEditApplicationDetail').show();
                } else {
                    $('#divContactCommunity').hide();
                    $('#btnEditApplicationDetail').hide();
                }

                EnabledInputForm();
            }

            debugger;
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                var target = $(e.target).attr("href");
                switch (target) {
                    case "#tab_ApplicationDetail":
                        //alert("1234");
                        break;
                    case "#tab_CustomerDetail":
                        GetCustomerDetailByRoundID();

                        break;

                }

            });

            $('#btnEditApplicationRound').click(function (e) {
                e.preventDefault();

                $("#txtEditAddCustomerBuy").inputmask('decimal', {
                    rightAlign: true
                });

                $("#txtEditAddCustomerFree").inputmask('decimal', {
                    rightAlign: true
                });

                GetApplicationRoundByRoundId();
                GetApplicationSubRound();
                $('#modal-EditRound').addClass("modal_itemcenter");
                $('#modal-EditRound').modal('show');
            });

            $('#btnAddContactAgent').click(function (e) {
                e.preventDefault();

                $("#txtPerSentAdd").inputmask('decimal', {
                    rightAlign: true
                });
                GetContractAgentSelect();
                $('#modal-AddContract').addClass("modal_itemcenter");
                $('#modal-AddContract').modal('show');
            });

            $('#btnUnApprovePolicy').click(function (e) {
                e.preventDefault();

                $('#modal-CancelCauseApprove').addClass("modal_itemcenter");
                $('#modal-CancelCauseApprove').modal('show');
            });

            $('#btnEditApplicationDetail').click(function (e) {
                e.preventDefault();

                //ValidateForEditApplicationDetail
                let v_validateForEditApplicationDetail = IsValidateForEditApplicationDetail();

                if (v_validateForEditApplicationDetail != "") {

                    swal("ตรวจสอบข้อมูล", v_validateForEditApplicationDetail, "warning");

                } else {
                    //DoEditApplicationDetail
                    DoEditApplicationDetail();
                }
            });

            $('#btnUpdateApplicationRound').click(function (e) {
                e.preventDefault();

                let v_validateForEditApplicationRound = IsValidateForEditApplicationRound();

                if (v_validateForEditApplicationRound != "") {
                    swal("ตรวจสอบข้อมูล", v_validateForEditApplicationRound, "warning");

                } else {
                    //swal("", "123456789", "success");
                    DoEditApplicationRound();
                }

            });

            //ช่อง กรอกแก้ไขจำวนผู้ชำระเบี้ย หากมีการกรอก ให้เอาจำนวนคน * เบี้ยของแผน
            $('#txtEditAddCustomerBuy').keyup(function (e) {
                debugger;
                if ($('#txtEditAddCustomerBuy').val() == "") {
                    $('#txtEditPremiumSum').val(0);
                } else {
                    let s = $('#txtEditAddCustomerBuy').val() * $('#txtPremium').val();
                    $('#txtEditPremiumSum').val(s);
                }
            });

            $('#btnAddContractPersent').click(function (e) {
                e.preventDefault();

                //IsValidateForAddContactAgent
                let v_ContactAgent = IsvalidateForAddContactAgent();
                if (v_ContactAgent != "") {
                    swal("ตรวจสอบข้อมูล", v_ContactAgent, "warning");
                } else {
                    //DoAddContactAgent
                    DoSaveContractAgent();
                }

            });

        });

         const CheckApplicationByPass = (appId) => {
            let rs;
            $.ajax({
                type: "GET",
                url: "@Url.Action("CheckApplicationBypass", "PACommunity")",
                data: { appId: appId},
                dataType: "json",
                async: false,
                success: function (d) {
                    debugger;
                    rs = d.IsResult;

                }
            });

            return rs;
        }

        const IsvalidateForCheckDCR = (startCoverDate) => {
            //let checkDCR = CheckStartCoverDate(new Date());

            //debugger;
            //if (startCoverDate < checkDCR) {
            //    return false;
            //}

            //return true;

            //let checkDCR = CheckStartCoverDate(new Date());
            //Get range DCR
            let MinDCR;
            let MaxDCR;
            //Get Next DCR ปัจจุบัน
            let lastDCR;
            //วันปัจจุบัน
            let CurrDate = new Date();
            let CurDT = CurrDate.getDate();
            debugger;
            if (CurDT >= 1 && CurDT <= 10)//ไม่เกินวันที่ 10
            {//เป็นรอบตรวจ DCR 1
                //คิดDCRปัจจุบันหรือDCR-1
                //ตั้งDCR ที่ต้องเปิดแก้ไข ต้องไม่น้อยกว่า MinDCR และไม่เกิน
                MinDCR = new Date(CurrDate.getFullYear(), CurrDate.getMonth(), 1);
                MaxDCR = new Date(CurrDate.getFullYear(), CurrDate.getMonth(), 16);
            }
            else if (CurDT >= 11 && CurDT <= 25) {//เป็นรอบตรวจ DCR 16
                //คิดDCRปัจจุบันหรือDCR-1
                //ตั้งDCR ที่ต้องเปิดแก้ไข ต้องไม่น้อยกว่า MinDCR และไม่เกิน
                let setDate1 = new Date();
                let NextDCR1 = new Date(setDate1.setMonth(CurrDate.getMonth() + 1));
                MinDCR = new Date(CurrDate.getFullYear(), CurrDate.getMonth(), 16);
                MaxDCR = new Date(NextDCR1.getFullYear(), NextDCR1.getMonth(), 1);
            }
            else if (CurDT >= 26) {//เป็นรอบตรวจ DCR 1
                //คิดDCRปัจจุบันหรือDCR+1
                let setDate2 = new Date();
                let NextDCR2 = new Date(setDate2.setMonth(CurrDate.getMonth() + 1));
                MinDCR = new Date(NextDCR2.getFullYear(), NextDCR2.getMonth(), 1);
                MaxDCR = new Date(NextDCR2.getFullYear(), NextDCR2.getMonth(), 16);
            }

            debugger;

            if (startCoverDate < MinDCR) {
                return false;
            }
            //else if (startCoverDate > MaxDCR) {
            //    return false;
            //}

            return true;
        }

        function GetData()  {

            debugger;
             GetApplicationDetail1();
             GetOrganizeDetail();
             GetContactCommunity();
             GetApplicationRound();
             GetContactAgent();
            GetApplicationRoundSumPremium();
            GetPaymentFromCashReceive();

        }

        const EnabledButton = (v) => {
            $('#btnApprovePolicy').prop('disabled', v);
            $('#btnUnApprovePolicy').prop('disabled', v);
            $('#btnAddContactAgent').prop('disabled', v);
            $('#btnEditApplicationRound').prop('disabled', v);
            $('#btnEditApplicationDetail').prop('disabled', v);
        }

        const EnabledInputForm = () => {
            //divAppDetail
            $('#divAppDetail').find('input, textarea, select').attr('disabled', 'disabled');
            $('#txtApplicationCodeInRound').prop('disabled', true);
            $('#txtPolicyInRound').prop('disabled', true);
        }

        //ช่องกรอก รหัสผู้ประสานงานโครงการ โดยกรอกได้ทั้ง รหัสพนักงาน ชือ นามสกุล ชื่อเล่น
         const GetContractAgentSelect = () => {
             $("#ddlContractProjectAdd").select2({

               ajax: {
                   url: '@Url.Action("GetEmployeeDetail", "PACommunity")',
                   dataType: 'json',
                   contentType: 'application/json',

                   delay: 250,
                   async: false,

                   data: function (params) {
                       return {
                           q: params.term, // search term
                           page: params.page
                       };
                   },
                   processResults: (data) => {
                       var mapdata = $.map(data, function (obj) {
                           obj.id = obj.EmployeeID;
                           obj.text = obj.EmployeeCode + ' ' + obj.FullName + ' ('+ obj.NickName + ')';
                           return obj;
                       });
                       return { results: mapdata };
                   },
                   cache: true
               },
               placeholder: 'ค้นหารายการ',
               escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
               minimumInputLength: 4,

              // templateSelection: formatRepoSelection,
               selectOnClose: true,
               language: { inputTooShort: function () { return 'กรอกข้อมูลอย่างน้อย 4 ตัวอักษร'; } }
           });
         }

        const GetApplicationRoundByRoundId = () => {
             $.ajax({
                    type: "GET",
                    url: '@Url.Action("GetApplicationRoundByID", "PACommunity")',
                    data: {
                        applicationRoundID: $('#hdfApplicationRoundID').val()
                    },
                    dataType: "json",
                    success: function (response) {

                        debugger;
                        let effectiveDate = moment(response.EffectiveDate).add(543, 'years').format("DD/MM/YYYY") ;

                        $('#txtEditRoundID').val(response.ApplicationRoundCode);
                        $('#dtpEditEffectiveDate').val(effectiveDate);

                    }
            });
        }

        const GetApplicationSubRound = () => {
            $('#dtApplicationSubRound').empty();

             var table = $('#dtApplicationSubRound').DataTable({
                   pageLength: 2,
                   processing: true,
                   serverSide: true,
                   responsive: true,
                   destroy: true,
                   searching: false,
                   ajax: {
                       url: '@Url.Action("GetApplicationSubRoundDetail", "PACommunity")',
                       type: 'POST',
                       data: function (d) {
                           d.draw = d.draw;
                           d.pageSize = d.length;
                           d.pageStart = d.start;
                           d.sortField = d.columns[d.order[0].column].data;
                           d.orderType = d.order[0].dir;
                           d.search = d.search.value;
                           d.applicationRoundID = $('#hdfApplicationRoundID').val();
                       }
                   },
                   columns: [

                       //{ title: 'รหัสรายการ', data: 'ApplicationRoundCode' },
                       {
                           title: 'วันที่ทำรายการ', data: 'CreatedDate',
                           className: 'h-dt-center d-dt-center',
                           mRender: function (data) {
                               moment.locale('th');
                               return moment(data).add(543, 'years').format("DD/MM/YYYY hh:mm","LLLL");
                           }
                       },
                       { title: 'คนชำระเบี้ย', data: 'CustomerBuy', className: 'h-dt-center d-dt-center', },
                       { title: 'สิทธิ์ฟรี', data: 'CustomerFree', className: 'h-dt-center d-dt-center',},
                   ],
                   bLengthChange: false,
                   createdRow: function (row, data, index) {
                   },

            });
        }

        const GetOrganizeType = () => {

            $('#ddlOrganizeType').empty();
         $.ajax({
             type: "GET",
             url: "@Url.Action("GetOrganizeType", "PACommunity")",
             data: {
                 organizeGroupId: $('#ddlOrganizeGroup').val()
             },
             async: false,
             dataType: "json",
             success: function (response) {

                 for (var i = 0; i < response.length; i++) {
                     $('#ddlOrganizeType').append('<option value=' + response[i].OrganizeTypeId + '>' + response[i].OrganizeType +'</option>')
                 }
             }
         });
     }

       const GetApplicationDetail1 = () => {
           $.ajax({
             type: "GET",
             url: '@Url.Action("GetApplicationDetail", "PACommunity")',
             data: { applicationID: $('#hdfApplicationID').val()},
             dataType: "json",
             contentType: 'application/json',
             async: false,
             success: function (data) {
                 debugger;
                 if (data == null) {

                 } else {
                     $('#lblApplicationID').text(data.ApplicationCode);
                     $('#lblPolicyNo').text('-');
                     $('#lblApplicationStatus').text(data.ApplicationStatus);
                     $('#txtPolicyName').val(data.ApplicationName);
                     $('#ddlProduct').select2().val(data.ProductId).trigger('change.select2');
                     $('#txtPremium').val(data.PremiumPerYear);
                     $('#hdfapplicationStatusId').val(data.ApplicationStatusId);
                     $('#hdfBranchID').val(data.BranchId);
                     $('#txtApplicationCodeInRound').val(data.ApplicationCode);
                     $('#txtPolicyInRound').val(data.ApplicationName);
                     $('#hdfOrganizeID').val(data.OrganizeId);
                     $('#ddlBranch').select2().val(data.BranchId).trigger('change.select2');

                     let StartDate = moment(data.StartCoverDate)._d;
                     let EndDate = moment(data.EndCoverDate)._d;

                     $('#dtpStartCoverDate').datepicker({ format: "dd/mm/yyyy" }).datepicker('setDate', new Date(StartDate));
                     $('#dtpEndCoverDate').datepicker({ format: "dd/mm/yyyy" }).datepicker('setDate', new Date(EndDate));

                     debugger;
                      if (@ViewBag.RoundStatusId == 3 || @ViewBag.RoundStatusId == 6 ) {
                          //Enable Button
                          //$('button *').prop('disabled', true);
                          if (IsvalidateForCheckDCR(moment(data.StartCoverDate)._d)) {
                              EnabledButton(false);
                          } else {
                              let rs = CheckApplicationByPass(data.ApplicationId);

                              if (rs == true) {
                                  EnabledButton(false);
                              } else {
                                  EnabledButton(true);
                              }
                          }

                      } else {

                          EnabledButton(true);

                      }

                     //Load benefit table
                     //GetBenefitDe(null, data.Product);
                     GetBenefitDe($('#hdfApplicationID').val(), null);
                 }
             }
         });

       }

        const GetOrganizeDetail = () => {
            debugger;

            $.ajax({
             type: "GET",
             url: '@Url.Action("GetOrganizeById", "PACommunity")',
             data: { organizeID: $('#hdfOrganizeID').val()},
                dataType: "json",
             async: false,
             success: function (data) {

                 debugger;
                 $('#ddlOrganizeGroup').select2().val(data.OrganizeGroupId).trigger('change.select2');
                 GetOrganizeType();
                 $('#ddlOrganizeType').select2().val(data.OrganizeTypeId).trigger('change.select2');
                 $('#ddlProvince').select2().val(data.CurrentProvinceId).trigger('change.select2');
                 $('#ddlOrganizeName').val(data.Organize);

                 let address1 = "เลขที่: " + data.CurrentNo + " ชื่อหน่วยงาน: " + data.CurrentBuildingName;
                 let address2 = "หมู่ที่: " + data.CurrentMoo + " ถนน: " + data.CurrentRoad;

                 $('#txtAddress1').val(address1);
                 $('#txtAddress2').val(address2);
                 $('#txtProvince').val(data.CurrentProvince);
                 $('#txtDistrict').val(data.CurrentDistrict);
                 $('#txtSubDistrict').val(data.CurrentSubDistrict);
                 $('#txtZipCode').val(data.CurrentZipCode);
             }
         });

        }

        const GetContactCommunity = () => {
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetContractCommunity", "PACommunity")',
                data: {
                    applicationID: $('#hdfApplicationID').val()
                },
                async: false,
                dataType: "json",
                success: function (response) {
                    debugger;
                    $('#ddlTitle').select2().val(response.TitleId).trigger('change.select2');
                    $('#txtFirstName').val(response.FirstName);
                    $('#txtLastName').val(response.LastName);
                    $('#txtMobileNumber').val(response.MobileNumber).inputmask();
                    $('#ddlBank').select2().val(response.BankId).trigger('change.select2');
                    $('#txtAccountName').val(response.AccountName);
                    $('#txtAccountNo').val(response.AccountNo);

                    debugger;
                    if (response.IdCardNumber !== "") {
                        $('#rdoZCardId').iCheck('check');
                        $('#txtZCardId').val(response.IdCardNumber);

                        //close passport
                        $("#divZcardId").find('input, button').prop('disabled', false);
                        $("#divPassport").find('input').prop('disabled', true);
                    }

                    if (response.PassPortNumber !== "") {
                        $('#rdoPassport').iCheck('check');
                        $('#txtPassportNo').val(response.PassPortNumber);

                        //close idcard
                        $("#divZcardId").find('input, button').prop('disabled', true);
                        $("#divPassport").find('input').prop('disabled', false);
                    }

                    $('#spanContactCommunity').text('มีผู้ประสานงานชุมชน');

                }
            });
        }

        const IsValidateForEditApplicationDetail = () => {

            let rs = "";

            //Title
            if ($("#ddlTitle").val() == "-1") {
                rs = "กรุณาเลือก คำนำหน้า";
                return rs;
            }

            //FirstName
            if ($("#txtFirstName").val() == "") {
                rs = "กรุณากรอก ชื่อผู้ประสานงานชุมชน";
                return rs;
            }

            //LastName
            if ($("#txtLastName").val() == "") {
                rs = "กรุณากรอก นามสกุลผู้ประสานงานชุมชน";
                return rs;
            }

            //Tel
            if ($('#txtMobileNumber').val() == "") {
                rs = "กรุณากรอก เบอร์โทร ผู้ประสานงานชุมชน";
                return rs;
            } else {
                //ต้องครบ 10 หลัก
                let t = $('#txtMobileNumber').val();
                let t1 = t.replace("-", "");
                t1 = t1.replace("_", "");
                if (t1.length != 10) {
                    rs = "เบอร์โทร ผู้ประสานงานชุมชน ต้องครบ 10 หลัก ";
                    return rs;
                }
            }

            //Check Zcard Passport
            let rdoZcard = $('#rdoZCardId').iCheck('update')[0].checked;
            let rdoPassport = $('#rdoPassport').iCheck('update')[0].checked;

            if (rdoZcard == true) {
                //Check null ZcardId
                if ($('#txtZCardId').val() == "") {
                    result = "กรุณากรอก เลขบัตรประชาชน";
                    return result;
                }
            }

            if (rdoPassport == true) {
                //Check null passport
                if ($('#txtPassportNo').val() == "") {
                    result = "กรุณากรอก เลขบัตรPassport";
                    return result;
                }
                debugger;
                let c_passportNo = $('#txtPassportNo').val();
                //Check length passport
                if (c_passportNo.length < 6) {
                    result = "กรุณาตรวจสอบ เลขบัตรPassport เนื่องจากต้องมี 6 หลักขึ้นไป";
                    return result;
                }

            }

            if ($('#ddlBank').val() == '-1') {
                result = "กรุณาเลือก ธนาคาร";
                return result;
            }

            if ($('#txtAccountName').val() == "") {
                result = "กรุณากรอก ชื่อบัญชี";
                return result;
            }

            if ($('#txtAccountNo').val() == "") {
                result = "กรุณากรอก เลขที่บัญชี";
                return result;
            } else {

                let accountNo = $('#txtAccountNo').val();

                var regex = new RegExp("^[0-9]+$");

                if (!regex.test(accountNo)) {
                    result = "กรุณาตรวจสอบ เลขที่บัญชี เนื่องจากต้องเป็นตัวเลขเท่านั้น(0-9)";
                    return result;
                }
            }

            return rs;
        }

        const DoEditApplicationDetail = () => {
            let isContact = true;
            let idCard = $('#txtZCardId').val();
            let passport = $('#txtPassportNo').val();

            //if ($('#rdoContact').iCheck('update')[0].checked == true) {
            //    isContact = true;
            //}

            $.ajax({
                type: "POST",
                url: '@Url.Action("DoEditApplicationDetail","PACommunity")',
                data: {
                    applicationId: $('#hdfApplicationID').val(),
                    companyId: $('#hdfOrganizeID').val(),
                    applicationName: $('#txtPolicyName').val(),
                    applicationStatusID: $('#hdfapplicationStatusId').val(),
                    startCoverDate: $('#dtpStartCoverDate').val(),
                    endCoverDate: $('#dtpEndCoverDate').val(),
                    titleId: $('#ddlTitle').val(),
                    firstName: $('#txtFirstName').val(),
                    lastName: $('#txtLastName').val(),
                    mobileNumber: $('#txtMobileNumber').val(),
                    branchId: $('#hdfBranchID').val(),
                    productId: $('#ddlProduct').val(),
                    bankId: $('#ddlBank').val(),
                    accountName: $('#txtAccountName').val(),
                    accountNo: $('#txtAccountNo').val(),
                    isContact: isContact,
                    idCard: $('#txtZCardId').val(),
                    passport: $('#txtPassportNo').val()
                },
                dataType: "json",
                success: function (response) {
                    //ถ้าทำสำเร็จ ให้ alert ข้อความ และ โหลดข้อมูลใหม่
                    if (response[0] == "True") {

                        swal("", response[2], "success");

                        GetData();
                        //Close Modal
                    } else {
                        swal("", response[2], "error");
                    }
                }
            });
        }

         const GetProgramConfig_CustomerByMinimum = () => {

                let result;

                $.ajax({
                    type: "GET",
                    url: '@Url.Action("GetProgramConfig", "PACommunity")',
                    data: {
                        parameterName: $('#hdfCustomerBuyMinimum').val()
                    },
                    dataType: "json",
                    async: false,
                    success: function (response) {
                        if (response.ValueBoolean == true) {
                            result = response.ValueNumber;
                        } else {
                            result = null;
                        }
                    }
                });

                return result;

         }

        const IsValidateForEditApplicationRound = () => {
            let rs = "";

            debugger;

            if ($("#txtEditAddCustomerBuy").val() == "") {

                //$('#txtEditAddCustomerBuy').removeClass('form-control');
                //$('#txtEditAddCustomerBuy').addClass('form-control.has-error');
                debugger;
                rs = "กรุณากรอกคนชำระเบี้ย";
                return rs;
            }

            if ($("#txtEditAddCustomerFree").val() == "") {
                rs = "กรุณากรอกสิทธิ์ฟรี";
                return rs;
            }

            let customerBuy_minimum = GetProgramConfig_CustomerByMinimum();

            //Check CustomerBuy มากกว่าหรือเท่ากับ
            if ($("#txtEditAddCustomerBuy").val() < customerBuy_minimum) {
                rs = "กรุณาตรวจสอบคนชำระเบี้ย เนื่องจากจำนวนยังไม่ถึง " + customerBuy_minimum;
                return rs;
            }

            let s_CustomerFree = $("#txtEditAddCustomerBuy").val() / customerBuy_minimum;

            let l_CustomerFree = Math.floor(s_CustomerFree);

            //Check CustomerFree ไม่เกิน 1 คน
            if ($("#txtEditAddCustomerFree").val() > l_CustomerFree) {
                rs = "กรุณาตรวจสอบสิทธิ์ฟรี เนื่องจากจำนวนต้องไม่เกิน" + l_CustomerFree + "คนเท่านั้น";
                return rs;
            }

            return rs;
        }

        const DoEditApplicationRound = () => {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DoUpdateApplicationRound", "PACommunity")',
                data: {
                    applicationRoundID: $('#hdfApplicationRoundID').val(),
                    customerBuy: $('#txtEditAddCustomerBuy').val(),
                    customerFree: $('#txtEditAddCustomerFree').val(),
                    effectiveDate: $('#dtpEditEffectiveDate').val(),
                    //effectiveDate: '01/08/2562',
                    premiumSum: $('#txtEditPremiumSum').val(),

                },
                dataType: "json",
                success: function (response) {

                    if (response[0] == "True") {
                        swal("", response[2], "success");
                        GetApplicationRound();
                        //Close modal
                    } else {
                        swal("", response[2], "error");
                    }
                }
            });
        }

        const IsvalidateForAddContactAgent = () => {
            let rs = "";

            if ($('#ddlContractProjectType').val() == "-1") {
                rs = "กรุณาเลือกประเภทผู้ประสานงานโครงการ";
                return rs;
            }

            if ($('#ddlContractProjectAdd').val() == null) {
                rs = "กรุณาเลือกผู้ประสานงานโครงการ";
                return rs;
            }

            //if ($('#txtPerSentAdd').val() == "") {
            //    rs = "กรุณากรอก %";
            //    return rs;
            //}

            return rs;
        }

            //ส่งข้อมูลไปบันทึก ผู้ประสานงานโครงการ โดยส่ง applicationID ,ContractProjectType,employee,percent หากสำเร็จ ให้ แจ้ง บันทึกสำเร็จ พร้อมโหลดข้อมูล
        const DoSaveContractAgent = () => {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DoSaveContractAgent", "PACommunity")',
                data: {
                    applicationID: $('#hdfApplicationID').val(),
                    ContractProjectTypeID: $('#ddlContractProjectType').val(),
                    employeeID: $('#ddlContractProjectAdd').val(),
                    //percent: $('#txtPerSentAdd').val()
                    percent: 0
                },
                dataType: "json",
                success: function (response) {

                    if (response[0] == "True") {

                        //DoloadContactAgent
                        GetContactAgent();
                        swal("", response[2], "success");
                        //DoclearContactAgent

                        $('#modal-AddContract').modal('hide');

                    } else {
                        swal("", response[2], "error");
                    }
                }
            });
        }

        const DoDeleteContactAgent = (applicationAgentId) => {
            swal({
                title: "",
                text: "ต้องการลบผู้ประสานงานโครงการหรือไม่ ?",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "ตกลง",
                cancelButtonText: "ยกเลิก",
                closeOnConfirm: false,
                closeOnCancel: false
                },
                function(isConfirm) {
                  if (isConfirm) {
                    //swal("Deleted!", "Your imaginary file has been deleted.", "success");

                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("DoDeleteContractAgent", "PACommunity")',
                        data: {
                            applicationAgentId: applicationAgentId
                        },
                        dataType: "json",
                        success: function (response) {

                            if (response[0] == "True") {
                                swal("", response[2], "success");
                                //DoloadContactAgent
                                GetContactAgent();

                            } else {
                                swal("", response[2], "error");
                            }

                        }
                    });

                  } else {
                    swal("ยกเลิกทำรายการ", "", "error");
                  }
                }
            );
        }

        const DoApprovePolicy = () => {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DoUpdateStatusRoundPolicy", "Approve")',
                data: {
                    applicationRoundId: $('#hdfApplicationRoundID').val(),
                    applicationRoundStatusId : 4,
                    applicationRoundUnApproveCauseId : 1,
                    applicationRoundUnApproveRemark : ""

                },
                dataType: "json",
                success: function (response) {
                    if (response[0] == "True") {
                        debugger;
                        window.swal({
                            title: 'รายการ',
                            type: 'success',
                            text: response[2],
                            showCancelButton: false,
                            confirmButtonColor: '#26A65B',
                            confirmButtonText: 'ตกลง',
                            closeOnEsc: false,
                            className: "text"
                        }, function () {

                            //isRs = true;
                            window.close();

                        });

                        //sinalR To ApproveMonitor

                    } else {
                        swal("", response[2], "error");
                    }
                }
            });
        }

        const IsValidateForUnApprovePolicy = () => {

            let rs = "";

            if ($('#ddlCancelCause').val() == "-1") {
                rs = "กรุณาเลือก สาเหตุที่ไม่อนุมัติ";
                return rs;
            }

            if ($('#txtRemarkCancel').val() == "") {
                rs = "กรุณากรอก หมายเหตุ";
                return rs;
            }

            return rs;
        }

        const DoUnApprovePolicy = () => {

            let str = $('#txtRemarkCancel').val();

            str = str.replaceAll(/(?:\r\n|\r|\n)/g, '.');

            $.ajax({
                type: "POST",
                url: '@Url.Action("DoUpdateStatusRoundPolicy", "Approve")',
                data: {

                    applicationRoundId: $('#hdfApplicationRoundID').val(),
                    applicationRoundStatusId : 5,
                    applicationRoundUnApproveCauseId: $('#ddlCancelCause').val(),
                    applicationRoundUnApproveRemark: str

                },
                dataType: "json",
                success: function (response) {
                    if (response[0] == "True") {
                        //let isRs;
                        //debugger;
                        window.swal({
                            title: 'รายการ',
                            type: 'success',
                            text: response[2],
                            showCancelButton: false,
                            confirmButtonColor: '#26A65B',
                            confirmButtonText: 'ตกลง',
                            closeOnEsc: false,
                            className: "text"
                        }, function () {

                            //isRs = true;
                            window.close();

                        });
                        debugger;

                        //sinalR To ApproveMonitor

                    } else {
                        swal("", response[2], "error");
                    }
                }

            });
        }

        const GetApplicationRound = () => {
            debugger;
            $('#dtApplicationRound').empty();
            var table = $('#dtApplicationRound').DataTable({
                     pageLength: 10,
                     processing: true,
                     serverSide: true,
                     responsive: true,
                     destroy: true,
                     ajax: {
                         url: '@Url.Action("GetApplicationRoundDetail", "Approve")',
                         type: 'POST',
                         data: function (d) {
                             d.draw = d.draw;
                             d.pageSize = d.length;
                             d.pageStart = d.start;
                             d.sortField = d.columns[d.order[0].column].data;
                             d.orderType = d.order[0].dir;
                             d.search = d.search.value;
                             d.applicationID = $('#hdfApplicationID').val();
                             //d.applicationID = 2;
                         }
                     },
                     columns: [
                         { title: 'รอบที่', data: 'Round', className: 'h-dt-center d-dt-center',},
                         { title: 'รหัสรอบ', data: 'ApplicationRoundCode', className: 'h-dt-center d-dt-center', },
                         {
                             title: 'วันที่มีผลบังคับ', data: 'EffectiveDate',
                             className: 'h-dt-center d-dt-center',
                             mRender: function (data) {
                                 moment.locale('th');
                                 return moment(data).add(543, 'years').format("DD/MM/YYYY","LLLL");
                             }
                         },
                         { title: 'คนชำระเบี้ย', data: 'CustomerBuy', className: 'h-dt-center d-dt-center', },
                         { title: 'รับสิทธิ์ฟรี', data: 'CustomerFree', className: 'h-dt-center d-dt-center', },
                         { title: 'สถานะรอบ', data: 'ApplicationRoundStatus', className: 'h-dt-center d-dt-center', },
                         { title: 'สถานะการชำระเงิน', data: 'ApplicationRoundPaymentStatus', className: 'h-dt-center d-dt-center', },

                         {
                             title: '',
                             data: null,
                             width: '25%',
                             className: 'h-dt-center d-dt-center',
                             mRender: (data) => {

                                 if (data.CustomerBuy == data.CustomerBuyImport && data.CustomerFree == data.CustomerFreeImport) {
                                     return '<button type="button" class="btn btn-default btn-sm" disabled><i class="fa fa-fw fa-plus"></i> นำเข้า</button> '
                                         + '<a href="' + data.UrlLinkOpen + '" target = "_blank" class="btn btn-info btn-sm" > <i class="fa fa-fw fa-file"></i> เอกสาร</a > ';
                                 } else {
                                     return '<button type="button" class="btn btn-default btn-sm" onclick="OpenTabImportApplicationRound(\'' + data.ApplicationRoundId + '\'); "><i class="fa fa-fw fa-plus"></i> นำเข้า</button> '
                                         + '<a href="' + data.UrlLinkOpen + '" target = "_blank" class="btn btn-info btn-sm" > <i class="fa fa-fw fa-file"></i> เอกสาร</a >';

                                 }

                             }

                         }
                         //{ title: 'ทีม', data: 'ClaimCount', className: 'dt-center', },
                     ],
                     bLengthChange: false,
                     createdRow: function (row, data, index) {
                         //if (row.count() == 0) {
                         //    $('#btnAddRound').prop("disabled", false);
                         //} else {
                         //    $('#btnAddRound').prop("disabled", true);
                         //}

                         $('#hdfApplicationRoundID').val(data.ApplicationRoundId);
                         $('#hdfApplicationRoundStatusId').val(data.ApplicationRoundStatusId);
                     },

              });

        }

        const GetContactAgent = () => {
            $('#dtContractAgent').empty();
            var table = $('#dtContractAgent').DataTable({
                     pageLength: 10,
                     processing: true,
                     serverSide: true,
                     responsive: true,
                     destroy: true,
                     ajax: {
                         url: '@Url.Action("GetContractProject", "PACommunity")',
                         type: 'POST',
                         data: function (d) {
                             d.draw = d.draw;
                             d.pageSize = d.length;
                             d.pageStart = d.start;
                             d.sortField = d.columns[d.order[0].column].data;
                             d.orderType = d.order[0].dir;
                             d.search = d.search.value;
                             d.applicationID = $('#hdfApplicationID').val();
                             //d.applicationID = 2;
                         }
                     },
                     columns: [
                         { title: 'รหัสพนักงาน', data: 'EmployeeCode', className: 'h-dt-center d-dt-center', },
                         { title: 'ชื่อ - นามสกุล', data: 'EmployeeName', className: 'h-dt-center d-dt-center', },
                         { title: 'สาขา', data: 'Branch', className: 'h-dt-center d-dt-center', },
                         { title: 'ทีม', data: 'Team', className: 'h-dt-center d-dt-center', },
                         //{
                         //    title: '',
                         //    data: null,
                         //    className: 'h-dt-center d-dt-center',
                         //    mRender: (data) => {
                         //        return '<a  onclick="DoDeleteContactAgent(\'' + data.ApplicationAgentId + '\')" ;return false;" class="btn btn-danger btn-sm"><i class="fa fa-fw fa-eraser"></i> ลบ</a>'
                         //    }
                         //}
                     ],
                     bLengthChange: false,
                     createdRow: function (row, data, index) {

                     },

              });
        }

        const GetApplicationRoundSumPremium = () => {
            $('#dtApplicationRoundSum').empty();
            var table = $('#dtApplicationRoundSum').DataTable({
                     pageLength: 10,
                     processing: true,
                     serverSide: true,
                     responsive: true,
                     destroy: true,
                     searching: false,
                     //paging: false,
                     info: false,
                     ajax: {
                         url: '@Url.Action("GetApplicationRoundDetail", "Approve")',
                         type: 'POST',
                         data: function (d) {
                             d.draw = d.draw;
                             d.pageSize = d.length;
                             d.pageStart = d.start;
                             d.sortField = d.columns[d.order[0].column].data;
                             d.orderType = d.order[0].dir;
                             d.search = d.search.value;
                             d.applicationID = $('#hdfApplicationID').val();
                             //d.applicationID = 2;
                         }
                     },
                     columns: [
                         { title: 'รหัสรอบ', data: 'ApplicationRoundCode', className: 'h-dt-center d-dt-center', },
                         { title: 'เบี้ยประกัน', data: 'PremiumAmount', className: 'h-dt-center d-dt-center', },

                     ],
                     bLengthChange: false,
                     createdRow: function (row, data, index) {

                     },
              });
        }

        const GetPaymentFromCashReceive = () => {
            $('#dtPremiumFromCashReceive').empty();
            var table = $('#dtPremiumFromCashReceive').DataTable({
                     pageLength: 10,
                     processing: true,
                     serverSide: true,
                     responsive: true,
                     destroy: true,
                     searching: false,
                     //paging: false,
                     info: false,
                     ajax: {
                         url: '@Url.Action("GetPremiumDetail", "Approve")',
                         type: 'GET',
                         data: function (d) {
                             d.draw = d.draw;
                             d.pageSize = d.length;
                             d.pageStart = d.start;
                             d.sortField = d.columns[d.order[0].column].data;
                             d.orderType = d.order[0].dir;
                             d.search = d.search.value;
                             d.applicationID = $('#hdfApplicationID').val();
                             //d.applicationID = 2;
                         }
                     },
                     columns: [
                         { title: 'CashReceiveID', data: 'ReceiveDetailCode', className: 'h-dt-center d-dt-center', },
                         { title: 'ยอดรับ', data: 'PremiumAmount', className: 'h-dt-center d-dt-center', },
                         { title: 'สถานะ', data: 'PremiumStatus', className: 'h-dt-center d-dt-center', }

                     ],
                     bLengthChange: false,
                     createdRow: function (row, data, index) {

                     },
              });
        }

        const GetCustomerDetailByRoundID = () => {
            var t = $('#dtCustomerDetail').DataTable({

                pageLength: 10,
                processing: true,
                serverSide: true,
                serverSide: true,
                responsive: true,
                destroy: true,
                ajax: {
                    url: '@Url.Action("GetCustomerDetail", "PACommunity")',
                    type: 'POST',
                    data: function (d) {
                        d.CustomerDetailId = null;
                        d.applicatonRoundId = $('#ddlRound').val();
                        d.applicatonId = $('#hdfApplicationID').val();
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.pageStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = d.search.value;

                    }
                },

                columns: [

                    { title: 'Memder ID', data: 'CustomerDetailCode', width: '10%', className: 'h-dt-center d-dt-center',},
                    { title: 'ชื่อ-นามสกุล', data: 'CustomerName', width: '20%', className: 'h-dt-center d-dt-center', },
                    { title: 'บัตรประชาชน', data: 'IdCardNumber', className: 'h-dt-center d-dt-center', width: '10%'} ,
                    { title: 'Passport', data: 'PassPortNumber', width: '10%', className: 'h-dt-center d-dt-center',},

                    {
                        title: 'วันเกิด', data: 'BirthDate', className: 'h-dt-center d-dt-center'
                        , mRender: function (data) {
                            moment.locale('th');
                            //return moment(data).add(543, 'years').format("DD/MM/YYYY", "LLLL");
                            var d = moment(data);
                            return `${d.format("DD/MM")}/${d.year() + 543}`;
                        }, width: '10%'
                    },
                    { title: 'อายุ', data: 'AgeAtRegister_Y', className: 'h-dt-center d-dt-center', width: '5%'},
                    { title: 'อาชีพ', data: 'Occupation', width: '10%', className: 'h-dt-center d-dt-center', },
                    { title: 'เบอร์โทร', data: 'MobileNumber', width: '10%', className: 'h-dt-center d-dt-center', },
                    { title: 'ฟรี', data: 'CustomerDetailType', className: 'h-dt-center d-dt-center', },

                    { title: 'สถานะ', data: 'CustomerDetailStatus', className: 'h-dt-center d-dt-center', },

                    //{ data: null, mRender: (data, type, full) => { return '<a  type="button" class="btn-danger btn-sm" onclick="DeleteCustomerDetail(\'' + data.CustomerDetailId  + '\');" ; >ลบ</a >'; }, width: '5%' },

                    {
                        title: 'วันที่มีผล', data: 'CustomerDetailStartCoverDate', className: 'h-dt-center d-dt-center'
                        , mRender: function (data) {
                            moment.locale('th');
                            //return moment(data).add(543, 'years').format("DD/MM/YYYY", "LLLL");
                            var d = moment(data);
                            return `${d.format("DD/MM")}/${d.year() + 543}`;
                        }, width: '10%'
                    },
                    {
                        data: null,
                        className: 'h-dt-center d-dt-center',
                        mRender: (data, type, full) => {
                            return '<a title="แก้ไข"  type="button" class="btn-warning btn-sm" onclick="OpenTabEditCustomerDetail(\'' + $('#hdfApplicationRoundID').val() + '\' ,\'' + data.CustomerDetailId + '\' );" ; ><i class="fa fa-fw fa-edit"></i></a >';
                        }, width: '10%'
                    },
                ],

                //createdRow: function (row, data, index) {
                //    if (data.ClaimOnLineStatusId == 3) {
                //        $('td', row).addClass('selected');
                //    }
                //},
            });
        }

        const OpenTabEditCustomerDetail = (applicationRoundID, customerDetailID) => {

            let en_applicationRoundID = window.btoa(applicationRoundID);
            let en_custDetailID = window.btoa(customerDetailID);

             bob = window.open('', '_blank');
            bob.location = "@Url.Action("AddCustomerDetail", "PACommunity")?ApplicationRoundId=" + en_applicationRoundID + "&CustomerDetailId=" + en_custDetailID +"";
        }

        const OpenTabImportApplicationRound = (applicationRoundID) => {
            let en_applicationRoundId = window.btoa(applicationRoundID);
            bob = window.open('', '_blank');
            bob.location = "@Url.Action("ControlCustomerDetail", "PACommunity")?applicationRoundId=" + en_applicationRoundId + "";
        }
    </script>

}