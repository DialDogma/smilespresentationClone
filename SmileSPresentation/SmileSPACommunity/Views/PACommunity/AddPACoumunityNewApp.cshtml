@{
    ViewBag.Title = "บันทึก PAชุมชน";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<h2>AddPACoumunityNewApp</h2>*@

<form class="form-horizontal">

    <input type="hidden" value="@ViewBag.AppID" id="hdfAppID" />
    <input type="hidden" value="@ViewBag.BranchID" id="hdfBranchID" />

    <div class="row">
        <div class="col-xs-12">
            <div id="divNotification" hidden>
                <div class="alert alert-warning alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <h4><i class="icon fa fa-warning"></i> Alert!</h4>
                    <div id="msg"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12">

            @* ApplicationID *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-aqua bs-glyphicons"><i class="fa fa-fw fa-heartbeat"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">Application ID</span>
                        <span class="info-box-number"><label id="txtApplicationID"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>

            @* เลขที่กรมธรรม์ *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-yellow"><span class="glyphicon glyphicon-tasks"></span></span>

                    <div class="info-box-content">
                        <span class="info-box-text">เลขที่กรมธรรม์</span>
                        <span class="info-box-number"><label id="txtPolicyNo"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>

            @* สถานะกรรมธรรม์ *@
            <div class="col-md-4 col-sm-8 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-green"><span class="glyphicon glyphicon-lock"></span></span>

                    <div class="info-box-content">
                        <span class="info-box-text">สถานะกรมธรรม์</span>
                        <span class="info-box-number"><label id="txtPolicyStatus"></label></span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12">

            @* PACommunity Data *@
            <div class="box box-primary">
                <div class="box-header with-border" style="background-color:#3987b4; color:white">
                    <h3 class="box-title">ข้อมูลชุมชน</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>

                @*<div class="box-body">
                        <div class="box-group">
                            <div class="col-xs-4">
                                <label>Application ID :</label>
                                <input class="form-control" type="text" placeholder="" id="txtApplicationID" name="txtApplicationID" disabled>
                            </div>
                            <div class="col-xs-4">
                                <label>Policy No :</label>
                                <input class="form-control" type="text" placeholder="" id="txtPolicyNo" name="txtPolicyNo" disabled>
                            </div>
                            <div class="col-xs-4">
                                <label>Policy Status :</label>
                                <input class="form-control" type="text" placeholder="" id="txtPolicyStatus" name="txtPolicyStatus" disabled>
                            </div>
                        </div>
                    </div>*@

                <div class="box-body" style="">
                    <div class="box-group">
                        <div class="col-xs-3">
                            <label>กลุ่มหน่วยงาน :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlPolicyGroup" name="ddlPolicyGroup">
                                <option value="-1">--โปรดระบุ--</option>
                                @{
                                    foreach (var item in ViewBag.OrganizeGroup)
                                    {
                                        <option value="@item.OrganizeGroup_ID">@item.OrganizeGroupDetail</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-xs-4">
                            <label>ประเภทหน่วยงาน :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlPolicyType" name="ddlPolicyType"></select>
                        </div>
                        <div class="col-xs-2">
                            <label>จังหวัด :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlProvince" name="ddlProvince">

                                <option value="-1">--โปรดระบุ--</option>

                                @{foreach (var item in ViewBag.Province)
                                    {
                                        <option value="@item.ProvinceId">@item.Province</option>
                                    }

                                }
                            </select>
                        </div>

                        <div class="col-xs-3">
                            <label>สาขา :</label>
                            <input class="form-control" type="text" id="txtBranch" name="txtBranch" disabled value="@ViewBag.Branch" />
                        </div>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-8" style="padding-top:6px">
                            <label>ชื่อหน่วยงาน / โรงเรียน :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlCommunityName" name="ddlCommunityName"></select>
                        </div>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-8" style="padding-top:6px">
                            <label>ชื่อกรมธรรม์ :</label>
                            <input class="form-control" id="txtPolicyname" name="txtPolicyname" disabled />
                        </div>
                        @*<div class="col-xs-2" style="padding-top:6px">
                                <label>Test :</label>
                                <input class="form-control" id="txtNumber" name="txtNumber" />
                            </div>
                            <div class="col-xs-2" style="padding-top:6px">
                                <button class="btn btn-default" id="btnTest">Test</button>
                            </div>*@
                    </div>

                    <div class="box-group">
                        <div class="col-xs-8" style="padding-top:6px">
                            <label>ที่อยู่ :</label>
                            <input class="form-control" type="text" placeholder="" id="txtAddress1" name="txtAddress1" disabled>
                        </div>
                    </div>

                    <div class="box-group clearfix">
                        <div class="col-xs-8 " style="padding-top:6px">
                            <input class="form-control" type="text" placeholder="" id="txtAddress2" name="txtAddress2" disabled>
                        </div>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>ตำบล :</label>
                            <input type="text" class="form-control" id="txtSubDristirct" name="txtSubDristirct" disabled />
                        </div>
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>อำเภอ :</label>
                            <input type="text" class="form-control" id="txtDristirct" name="txtDristirct" disabled />
                        </div>
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>จังหวัด :</label>
                            <input type="text" class="form-control" id="txtProvince" name="txtProvince" disabled />
                        </div>
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>รหัสไปรษณีย์ :</label>
                            <input type="text" class="form-control" id="txtZipcode" name="txtZipcode" disabled />
                        </div>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>วันเริ่มสัญญา :</label>
                            @*<div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control pull-right" id="datepicker"  data-provide="datepicker" data-date-language="th-th" placeholder="dd/mm/yyyy" data-format="dd/MM/yyyy">*@

                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control pull-right" id="dtpStartCoverDate" data-provide="datepicker" data-date-language="th-th" placeholder="dd/mm/yyyy" data-format="dd/MM/yyyy" readonly="readonly" style="background-color:white">
                            </div>
                        </div>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>วันสิ้นสุดสัญญา :</label>

                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control pull-right" id="dtpEndCoverDeate" data-provide="datepicker" data-date-language="th-th" placeholder="dd/mm/yyyy" data-format="dd/MM/yyyy" disabled>
                            </div>
                        </div>
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>แผนประกัน :</label>

                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlProduct">
                                <option value="-1">--โปรดระบุ--</option>

                                @{foreach (var item in ViewBag.Products)
                                    {
                                        <option value="@item.ProductId">@item.Product</option>
                                    }

                                }
                            </select>
                        </div>

                        <div class="col-xs-3" style="padding-top:6px">
                            <label>เบี้ย :</label>
                            <input type="text" id="txtPremium" disabled value="" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group">
                        <div class="col-xs-3" style="padding-top:6px">
                            <label>ตัวเลือกข้อมูลผู้ประสานงานชุมชน :</label>
                        </div>
                        <div class="col-xs-9" style="background-color:#F88017; color:white; padding:8px;">
                            <div class="col-xs-3" style="padding-top:6px">
                                <input type="radio" name="r1" class="minimal" checked="" style="position: absolute; opacity: 0;" id="rdoNoContact" value="0"> ไม่มีผู้ประสานงานชุมชน
                            </div>

                            <div class="col-xs-3" style="padding-top:6px">
                                <input type="radio" name="r1" class="minimal" style="position: absolute; opacity: 0;" id="rdoContact" value="1"> มีผู้ประสานงานชุมชน
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group">

                        @* Contract PACommunity *@
                        <div class="box box-primary" id="divContactCommunity" style="display:none">
                            <div class="box-header with-border" style="background-color:#3987b4; color:white">
                                <h3 class="box-title">ข้อมูลผู้ประสานงานชุมชน</h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="box-body">
                                <div class="box-group">
                                    <div class="col-xs-3" style="padding-top:6px">
                                        <label>คำนำหน้า :</label>
                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlTitle" name="ddlTitle">
                                            <option value="-1">--โปรดระบุ--</option>

                                            @{foreach (var item in ViewBag.Titles)
                                                {
                                                    <option value="@item.TitleId">@item.Title</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-xs-4" style="padding-top:6px">
                                        <label>ชื่อ :</label>
                                        <input type="text" class="form-control " id="txtContractFirstName" name="txtContractFirstName" />
                                    </div>
                                    <div class="col-xs-4" style="padding-top:6px">
                                        <label>นามสกุล :</label>
                                        <input type="text" class="form-control " id="txtContractLastName" name="txtContractLastName" />
                                    </div>
                                </div>

                                <div class="box-group clearfix">
                                    <div class="col-xs-3" style="padding-top:6px">
                                        <label>เบอร์โทรศัพท์ :</label>
                                        <input type="text" class="form-control " id="txtContractTel" name="txtContractTel" data-inputmask="'mask': '999-9999999'" />
                                    </div>
                                    <div class="col-xs-4" style="padding-top:6px">
                                        <div class="col-xs-1" style="padding-left:3px;padding-top: 32px">
                                            <input type="radio" name="r2" class="minimal" checked style="position: absolute; opacity: 0;" id="rdoZCardId" value="1">
                                        </div>
                                        <div class="col-xs-11 input-group" id="divZcardId">
                                            <label class="control-label" for="">หมายเลขบัตรประชาชน</label>
                                            <input type="text" class="form-control" id="txtZCardId" name="txtZCardId" data-inputmask="'mask': '9-9999-99999-99-9'" />
                                            <span class="input-group-btn" style="padding-top: 27px">
                                                <button type="button" id="btnChkIdcard" class="btn btn-primary">ตรวจสอบ</button>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="col-xs-4" style="padding-top:6px">

                                        <div class="col-xs-1" style="padding-left:3px;padding-top: 32px">
                                            <input type="radio" name="r2" class="minimal" style="position: absolute; opacity: 0;" id="rdoPassport" value="0">
                                        </div>
                                        <div class="col-xs-11 input-group" id="divPassport">
                                            <label class="control-label" for="lblPassportNo">หมายเลขพาสปอร์ต</label>
                                            <input type="text" class="form-control" id="txtPassportNo" name="txtPassportNo" placeholder="หมายเลขพาสปอร์ต">
                                        </div>
                                    </div>
                                </div>

                                <div class="box-group">
                                    <div class="col-xs-3" style="padding-top:6px">
                                        <label>ธนาคาร :</label>
                                        <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlBank" name="ddlBank">
                                            <option value="-1">--โปรดระบุ--</option>

                                            @{foreach (var item in ViewBag.OrganizeBank)
                                                {
                                                    <option value="@item.Organize_ID">@item.OrganizeDetail</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-xs-4" style="padding-top:6px">
                                        <label>ชื่อบัญชี :</label>
                                        <input type="text" class="form-control " id="txtAccountName" name="txtAccountName" />
                                    </div>
                                    <div class="col-xs-4" style="padding-top:6px">
                                        <label>เลขที่บัญชี :</label>
                                        <input type="text" class="form-control " id="txtAccountNo" name="txtAccountNo" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group" style="text-align:center">
                        <button class="btn btn-success" id="btnSavePACommunity" name="btnSavePACommunity" type="button">บันทึกข้อมูลชุมชน</button>
                        <button class="btn btn-info" id="btnEditPACommunity" name="btnEditPACommunity" type="button">แก้ไขข้อมูลชุมชน</button>
                    </div>
                </div>
            </div>

            @*<div class="box">

                    <div class="box-body">
                        <div class="box-group" style="text-align:center">
                            <button class="btn btn-success" id="btnSavePACommunity" name="btnSavePACommunity" type="button">บันทึกข้อมูลชุมชน</button>
                            <button class="btn btn-info" id="btnEditPACommunity" name="btnEditPACommunity" type="button">แก้ไขข้อมูลชุมชน</button>
                        </div>
                    </div>
                </div>*@

            @* Contract  NewApp Project*@
            <div class="box box-primary" id="boxContractPersent">
                <div class="box-header with-border" style="background-color:#3987b4; color:white">
                    <h3 class="box-title">ข้อมูลผู้ประสานงานโครงการ</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group">
                        <table id="dtContractPersent" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-6">
                            <button class="btn btn-primary" type="button" id="btnAddContractModal">เพิ่มผู้ประสานงาน</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="box box-primary" id="boxImportDetail">
                <div class="box-header with-border" style="background-color:#3987b4; color:white">
                    <h3 class="box-title">รายการรับข้อมูลผู้เอาประกัน</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group">
                        <table id="dtApplicationRound" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                    </div>

                    <div class="box-group">
                        <div class="col-xs-6">
                            <button type="button" class="btn btn-primary" id="btnAddRound">เพิ่มรอบ</button>
                        </div>
                    </div>
                </div>
            </div>

            @* Consent *@
            <div class="box box-primary" id="boxConsent">
                <div class="box-header with-border" style="background-color:#3987b4; color:white">
                    <h3 class="box-title">การให้ความยินยอมการเก็บ รวบรวม ใช้เปิดเผยข้อมูลส่วนบุคคล</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div>

                <div class="box-body">
                    <div class="box-group">
                        <div class="col-xs-6">
                            <button type="button" class="btn btn-primary" id="btnAddConsent" style="background-color:goldenrod; color:black">ข้อมูล PDPA</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="box" id="boxBtnPolicy">

                <div class="box-body">
                    <div class="box-group" style="text-align:center">
                        <button class="btn btn-success" id="btnSendPolicy" type="button">ขอออกกรมธรรม์</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hdfOrganizeID" hidden />
    <input type="hidden" id="hdfapplicationRoundId" hidden />
    <input type="hidden" id="hdfapplicationStatusId" hidden />
    <input type="hidden" id="hdfStartCoverDate" hidden />
    <input type="hidden" id="hdfPremissionDate" hidden value="Allow_PermissionDate" />
    <input type="hidden" id="hdfApplicationRoundStatusId" hidden />
    <input type="hidden" id="hdfCustomerBuyMinimum" value="CustomerBuyMinimum" hidden />

    @* Modal *@

    <div class="modal fade in" id="modal-AddContract" style="display: none; ">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">ข้อมูลผู้ประสานงานโครงการ</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>ประเภทผู้ประสานงานโครงการ :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlContractProjectType" name="ddlContractProjectType">
                                <option value="-1">--โปรดระบุ--</option>
                                @{foreach (var item in ViewBag.ContractAgentType)
                                    {
                                        <option value="@item.ApplicationAgentTypeId">@item.ApplicationAgentType</option>
                                    }

                                }
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <label>ผู้ประสานงานโครงการ :</label>
                            <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" id="ddlContractProjectAdd" name="ddlContractProjectAdd"></select>
                        </div>
                    </div>

                    @*<div class="row" style="padding-top:6px">
                            <div class="col-xs-10 col-xs-offset-1">
                                <label>เปอร์เซนต์ผู้ประสานงาน</label>
                                <div class="input-group">
                                    <input type="text" class="form-control input-sm " style="text-align:right" id="txtPerSentAdd" name="txtPerSentAdd" />
                                    <div class="input-group-addon">%</div>
                                </div>
                            </div>
                        </div>*@
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnAddContractPersent" name="btnAddContractPersent">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @* Add ApplicationRound *@
    <div class="modal fade in" id="modal-AddRound" style="display: none; ">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">เพิ่มรอบการนำเข้า</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>รหัสรอบ :</label>
                            <input type="text" class="form-control input-sm" disabled id="txtRoundID" />
                        </div>
                        <div class="col-xs-5">
                            <label>วันที่มีผลบังคับ :</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control input-sm" id="dtpEffectiveDate" disabled>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>จำนวนคนชำระเบี้ย :</label>
                            <input type="text" class="form-control input-sm" id="txtAddCustomerBuy" />
                        </div>
                        <div class="col-xs-5">
                            <label>สิทธิ์ฟรี :</label>
                            <input type="text" class="form-control input-sm" id="txtAddCustomerFree" disabled value="0">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>เบี้ยรวม :</label>
                            <input class="form-control" id="txtPremiumSum" disabled />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnSaveAddApplicationRound">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @* Choose Importing Data  *@
    <div class="modal fade in" id="modal-ChooseImporting" style="display: none; ">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">เลือกวิธีการนำเข้า</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-6 col-xs-offset-3">
                            <button type="button" id="btnImportBrowseFile" style="width:100%" class="btn btn-primary">นำเข้าโดยอัพโหลด</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-6 col-xs-offset-3" style="padding-top:6px">
                            <button type="button" id="btnImportKeyData" style="width:100%" class="btn btn-warning">นำเข้าโดยการคีย์</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    @* Edit ApplicationRound *@
    <div class="modal fade in" id="modal-EditRound" style="display: none; ">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">แก้ไขจำนวนคนนำเข้า</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>รหัสรอบ :</label>
                            <input type="text" class="form-control input-sm" disabled id="txtEditRoundID" />
                        </div>
                        <div class="col-xs-5">
                            <label>วันที่มีผลบังคับ :</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input type="text" class="form-control input-sm" id="dtpEditEffectiveDate" disabled>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <table id="dtApplicationSubRound" class="table table-bordered table-hover dataTable" style="width:100%"></table>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>จำนวนคนชำระเบี้ย :</label>
                            <input type="text" class="form-control input-sm" id="txtEditAddCustomerBuy" />
                        </div>
                        <div class="col-xs-5">
                            <label>สิทธิ์ฟรี :</label>
                            <input type="text" class="form-control input-sm" id="txtEditAddCustomerFree" disabled value="0">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5 col-xs-offset-1">
                            <label>เบี้ยรวม :</label>
                            <input class="form-control" id="txtEditPremiumSum" disabled />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnEditCustomerDetail">บันทึก</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</form>

@section ViewSpecificJavascript
{
    <script>

      $(document).ready(function () {
        var chat = $.connection.myHub;

        //Start Connection
        $.connection.hub.start().done(function () {

            chat.server.joinGroup(@ViewBag.userID);

            //ปุ่ม ขอออกกรมธรรม์
            $('#btnSendPolicy').click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("PDPAExistByApplicationID", "PACommunity")",
                    data: {
                        ApplicationID: $('#txtApplicationID').text()
                    },
                    dataType: "json",
                    async: false,
                    success: function (response) {
                        if (response.Result == true) {
                            //ยืนยันการทำรายการ
                            window.swal({
                                title: 'ยืนยันการขออนุมัติออกกรมธรรม์?',
                                type: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#277020',
                                confirmButtonText: 'ตกลง',
                                cancelButtonText: 'ยกเลิก',
                                closeOnConfirm: false,
                                closeOnEsc: false,
                                closeOnCancel: true
                            }, function () {
                                //IsValidateForSendPolicy
                                if (IsValidateForSendPolicy() == "") {
                                    chat.server.sendNotice("", "");
                                    //DoSendPolicy
                                    DoSendPolicy();
                                } else {
                                    window.swal({
                                        title: 'ทำรายการไม่สำเร็จ',
                                        type: 'error',
                                        text: IsValidateForSendPolicy(),
                                        showCancelButton: false,
                                        confirmButtonColor: '#26A65B',
                                        confirmButtonText: 'ตกลง',
                                        closeOnEsc: false,
                                        className: "text"
                                    }, function () {});
                                }
                            });
                        } else {
                            window.swal({
                                title: 'ทำรายการไม่สำเร็จ',
                                type: 'error',
                                text: response.Msg,
                                showCancelButton: false,
                                confirmButtonColor: '#26A65B',
                                confirmButtonText: 'ตกลง',
                                closeOnEsc: false,
                                className: "text"
                            }, function () { });
                        }
                    }
                });
            });
        });
    });

     $(document).ready(function () {
         var chat = $.connection.myHub;
         //Start Connection
         $.connection.hub.start().done(function () {
             //join group
             chat.server.joinGroup(@ViewBag.userID);
             //Show addNewNotice to client
             chat.client.sendNoticeResult = function (Str1, Str2) {

                 $('#modal-ChooseImporting').modal('hide');
                 GetDTApplicationRound();
                 //window.location.reload();

             };

         });
     });

     $(document).ready(function () {

         $('#divNotification').hide();

         $('#txtContractTel').inputmask();

         $('.select2').select2();

         //alert(CheckStartCoverDate(new Date()));

         $('#dtpStartCoverDate').datepicker({
             format: "dd/mm/yyyy",
             autoclose: true,
             todayHighlight: true,

             startDate: CheckStartCoverDate(new Date()),
             gotoCurrent: true,
             beforeShowDay: function (date) {
                 switch (date.getDate()) {
                     case 1:
                         return true;
                     case 16:

                         return true;
                     default:
                         return false;
                 }
             },

         });

         $('#rdoContact').on('ifChecked', function (event) {
             $("#divContactCommunity").show();
         });

         $('#rdoNoContact').on('ifChecked', function (event) {
             $("#divContactCommunity").hide();
         });

         $('#rdoZCardId').on('ifChecked', function (event) {
             $("#divZcardId").find('input, button').prop('disabled', false);
             $("#divPassport").find('input').prop('disabled', true);
             $("#txtPassportNo").val("");
         });

         $('#rdoPassport').on('ifChecked', function (event) {
             $("#divZcardId").find('input, button').prop('disabled', true);
             $("#divPassport").find('input').prop('disabled', false);
             $("#txtZCardId").val("");
         });
         $("#divPassport").find('input').prop('disabled', true);

        //$('#dtpEffectiveDate').datepicker({ format: "dd/mm/yyyy", autoclose: true });

        $("#txtPerSentAdd").inputmask('decimal', {
            rightAlign: true
        });

        //ถ้าเป็น บันทึก NewApp จะแสดง ปุ่ม บันทึกข้อมูลชุมชน ปิด Tab รายการรับข้อมูลผู้เอาประกัน
        if ($('#hdfAppID').val() == "") {

            //Enabled Save PACommunity
            $('#btnSavePACommunity').show();
            $('#btnEditPACommunity').hide();
            SetCoverDate();

            $('#hdfStartCoverDate').val($('#dtpStartCoverDate').val());

            //Enables Tab Import CustomerDetail
            $('#boxContractPersent').hide();
            $('#boxImportDetail').hide();
            $('#boxConsent').hide();
            $('#boxBtnPolicy').hide();
        }
        else {  //ถ้าเป็น กรณี แก้ไขข้อมูล ในการ ปฏิเสธกรมธรรม์ หรือทำไม่เสร็จ ให้แสดงข้อมูล ที่ทำล่าสุด

            //close Save PACommunity
            $('#btnSavePACommunity').hide();
            //open Edit PACommunity
            $('#btnEditPACommunity').show();

            GetApplicationDetail();
            GetOrganizeByID();
            GetContractCommunity();
            GetDTContractProject();
            GetDTApplicationRound();

            //SetButton

            ////Disabled PACommunityDetail
            $('#ddlPolicyGroup').prop('disabled', true);
            $('#ddlPolicyType').prop('disabled', true);
            $('#ddlProvince').prop('disabled', true);
            $('#ddlCommunityName').prop('disabled', true);
            $('#dtpStartCoverDate').prop('disabled', true);
            $("#dtpStartCoverDate").css({ 'background-color': '', 'opacity': '' });
            $('#ddlProduct').prop('disabled', true);

            if ($('#txtContractFirstName').val() == "") {
                $("#rdoNoContact").iCheck('check');
                $('#divContactCommunity').hide();
            }

            if ($('#hdfApplicationRoundStatusId').val() !== "2" && $('#hdfApplicationRoundStatusId').val() !== "") {
                $("#rdoNoContact").iCheck('disable');
                $('#rdoContact').iCheck('disable');
            }

            //let c_nowDate = ChecknowDateByStartCoverDate();

            //if (c_nowDate == "") {
            //    NoticeStatusApplicationandEnabledButton();
            //} else {

            //    if (CheckStatusAppAndRound() == false) {
            //        $('#divNotification').show();
            //        $('#msg').text(ChecknowDateByStartCoverDate());
            //        SetButton(true);
            //    } else {
            //        NoticeStatusApplicationandEnabledButton();
            //    }

            //}

         }

           //ปุ่มบันทึกข้อมูลชุมชน
        $('#btnSavePACommunity').click(function (e) {
            e.preventDefault();

            //ValidateForSavePolicy
            let v_forsave = "";

            v_forsave = IsvalidateforSavePolicy();

            if (v_forsave != "") {

                swal("คำเตือน", v_forsave, "warning");
            } else {
                //alert("Success");

                //DoSaveApplicationDetail()
                DoSaveApplicationDetail();
            }

        });

        //ปุ่มบันทึก ผู้ประสานงานโครงการ
       $('#btnAddContractPersent').click(e => {
           e.preventDefault();

           let v_validateContractAgent = IsvalidateForContractAgent();

           if (v_validateContractAgent == "") {
               //AddContractProject();
               DoSaveContractAgent();
           } else {

               swal("คำเตือน", v_validateContractAgent, "warning");
           }
        });

        //คลิกเลือก หน่วยงาน / โรงเรียน เมื่อคลิกเลือก ให้แสดงข้อมูลหน่วยงาน / โรงเรียน ลง ช่องที่กำหนดไว้
       $('#ddlCommunityName').change(function (e) {
           e.preventDefault();
           //GetOrganizeDetail()
           GetOrganizeDetail();
       });

        //เลือกวันเริ่มคุ้มครอง ถ้าเลือกวันเริ่มคุ้มครอง ให้ Set วันสิ้นสุดความคุ้มครอง ปี + 1
       $('#dtpStartCoverDate').change(e => {
           e.preventDefault();

           SetEndCoverDate();
       });

       GetContractAgentSelect();

         //ปุ่มเพิ่มรอบ
        $('#btnAddRound').click(function (e) {
           e.preventDefault();

           let v_validateAddRound = IsvalidateForBtnAddRound();

           if (v_validateAddRound == "") {

               //Set EffectiveDate
               $('#dtpEffectiveDate').val($('#dtpStartCoverDate').val());
               $("#txtAddCustomerBuy").inputmask('decimal', {
                   rightAlign: true
               });

               $("#txtAddCustomerFree").inputmask('decimal', {
                   rightAlign: true
               });

               //Show Modal
               $('#modal-AddRound').addClass("modal_itemcenter");
               $('#modal-AddRound').modal('show');
           } else {

               swal("คำเตือน", v_validateAddRound, "warning");
           }

        });

         //dtContractPersent    ข้อมูลผู้ประสานงานโครงการ
         //dtApplicationRound   รายการรับข้อมูลผู้เอาประกัน
         $('#btnAddConsent').click(function (e) {
             e.preventDefault();

             let dt_C = $('#dtContractPersent').DataTable().page.info().recordsTotal;
             let c_message = "ข้อมูลผู้ประสานงานโครงการ"
             let dt_A = $('#dtApplicationRound').DataTable().page.info().recordsTotal;
             let a_message = "รายการรับข้อมูลผู้เอาประกัน"

             if (dt_A == 0 && dt_C == 0) {
                 swal("คำเตือน", 'กรุณากรอก\n' + c_message + ' และ ' + a_message, "warning");
             } else if (dt_A == 0 && dt_C > 0) {
                 swal("คำเตือน", 'กรุณากรอก' + a_message, "warning");
             } else if (dt_A > 0 && dt_C == 0) {
                 swal("คำเตือน", 'กรุณากรอก' + c_message, "warning");
             } else if (dt_A > 0 && dt_C > 0) {
                $.ajax({
                     type: "GET",
                     url: '@Url.Action("ValidatePDPAPost", "PACommunity")',
                     data: {
                         AppID: $('#hdfAppID').val()
                     },
                     async: false,
                     dataType: "json",
                    success: function (response) {
                        if (response.status == true) {
                            window.open("@Url.Action("PDPAPost", "PACommunity")?AppID=" + $('#hdfAppID').val() + "&Mode=" + "upsert");
                        } else {
                            window.swal({
                                title: 'แจ้งเตือน',
                                type: 'warning',
                                text: 'กรุณานำเข้าข้อมูลผู้เอาประกัน',
                                showCancelButton: false,
                                confirmButtonColor: '#26A65B',
                                confirmButtonText: 'OK',
                                closeOnEsc: false,
                                className: "text"
                            });
                        }
                     }
                 });
             }
         });

        //ปุ่มเพิ่มผู้ประสานงาน
       $('#btnAddContractModal').click(function (e) {
           e.preventDefault();

           $('#modal-AddContract').addClass("modal_itemcenter");
           $('#modal-AddContract').modal('show');
       });

         //ปุ่มบันทึกรอบ
       $('#btnSaveAddApplicationRound').click(function (e) {
           e.preventDefault();
           //validateForAddApplicationRound
           let m_v = validateForAddApplicationRound();
           if (m_v == "") {

               DaSaveApplicationRound();

           } else {

               swal("คำเตือน !!!", m_v, "warning");
               $('#modal-AddRound').addClass("modal_itemcenter");
               $('#modal-AddRound').modal('show');
           }
       });

         //ช่อง กรอกจำนวนผู้ชำระเบี้ย หากมีการคีย์จำนวนคน ให้ เอาจำนวนคน * เบี้ยของแผน
       $('#txtAddCustomerBuy').keyup(function (e) {
           //e.preventDefault();

           if ($('#txtAddCustomerBuy').val() == "") {
               $('#txtPremiumSum').val(0);
           } else {
               let s = $('#txtAddCustomerBuy').val() * $('#txtPremium').val();
               $('#txtPremiumSum').val(s);
           }
       });

       //ช่อง กรอกแก้ไขจำวนผู้ชำระเบี้ย หากมีการกรอก ให้เอาจำนวนคน * เบี้ยของแผน
       $('#txtEditAddCustomerBuy').keyup(function (e) {

           if ($('#txtEditAddCustomerBuy').val() == "") {
               $('#txtEditPremiumSum').val(0);
           } else {
               let s = $('#txtEditAddCustomerBuy').val() * $('#txtPremium').val();
               $('#txtEditPremiumSum').val(s);
           }
       });

         //ปุ่ม นำเข้า ด้วย Excel ให้ เปิดหน้า นำเข้าแบบ Excel เป็น NewTab
       $('#btnImportBrowseFile').click(function (e) {
           e.preventDefault();
           let en_applicationRoundId = window.btoa($('#hdfapplicationRoundId').val());
           bob = window.open('', '_blank');
           bob.location = "@Url.Action("ImportCustomerDetail", "PACommunity")?applicationRoundId=" + en_applicationRoundId + "";

       });

         //ปุ่ม นำเข้า ด้วย การกรอกข้อมูล
       $('#btnImportKeyData').click(function (e) {
           e.preventDefault();

           let en_applicationRoundId = window.btoa($('#hdfapplicationRoundId').val());

            bob = window.open('', '_blank');
            bob.location = "@Url.Action("ControlCustomerDetail", "PACommunity")?applicationRoundId=" + en_applicationRoundId + "";

       });

         //ช่องเลือกแผน ถ้ามีการเลือกแผน ให้ แสดงเบี้ยต่อแผน ตรงช่อง เบี้ย
       $('#ddlProduct').change(function (e) {
           e.preventDefault();
           //GetPremiumByProductID
           if ($('#ddlProduct').val() == "-1") {
               $('#txtPremium').val(0);
           } else {
               GetPremiumByProductID();
           }

       });

         //ปุ่ม แก้ไขข้อมูล
       $('#btnEditPACommunity').click(function (e) {
           e.preventDefault();

           let m_validateEdit = "";

           m_validateEdit = ValidateForEditApplicationDetail();

           if (m_validateEdit != "") {

               swal("คำเตือน", m_validateEdit, "warning");

           } else {

               //DoEditAppoicationDetail()
               DoEditAppicatonDetail();
           }
       });

         //ปุ่ม แก้ไข จำนวนคน ตอนบันทึก
       $('#btnEditCustomerDetail').click(function (e) {
           e.preventDefault();

           let v_validateEditRound = IsValidateForEditApplicationRound();

           if (v_validateEditRound == "") {
               DoEditApplicationRound();
           } else {

               swal("คำเตือน", v_validateEditRound, "warning");
           }

       });

       //});

         //ช่องกรอก หน่วยงาน / โรงเรียน โดยกรอก ชื่อของหน่วยงานหรือโรงเรียน โดยอ้างอิงจาก ประเภทและจังหวัด หากมีข้อมูล ให้แสดงข้อมูลที่ตัวเองเลือก
       $("#ddlCommunityName").select2({

           ajax: {
               url: '@Url.Action("GetOrganize","PACommunity")',
               dataType: 'json',
               delay: 250,

               data: function (params) {
                   return {
                       q: params.term, // search term
                       organizeTypeId: $("#ddlPolicyType").val(),
                       provinceId: $("#ddlProvince").val(),
                       organizeGroupId: $('#ddlPolicyGroup').val(),
                       page: params.page
                   };
               },
               processResults: processData,
               cache: true
           },
           placeholder: 'ค้นหารายการ',
           escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
           minimumInputLength: 4,
           //templateResult: formatRepo,
           templateSelection: formatRepoSelection,
           selectOnClose: true,
           language: { inputTooShort: function () { return 'กรอกข้อมูลอย่างน้อย 4 ตัวอักษร'; } }
       });

       $('#ddlPolicyGroup').change(function (e) {
           e.preventDefault();
           GetOrganizeType();
       });

         $('#btnChkIdcard').click(function (e) {
             e.preventDefault();
             if (checkID($('#txtZCardId').val()) == true) {
                 swal("ตรวจสอบข้อมูล", "รหัสบัตรประชาชนถูกต้อง", "success")
             }
         });

     });

/////////////////// function //////////////////

        const checkID = (id) => {

            id = id.replace(/-/gi, '')
            if (id.length != 13) {

                swal("ตรวจสอบข้อมูล", "รหัสบัตรประชาชนต้องมี 13 หลัก", "warning")
                $('#txtZCardId').val('')
                return false
            } else {

                for (i = 0, sum = 0; i < 12; i++)
                    sum += parseFloat(id.charAt(i)) * (13 - i);

                if ((11 - sum % 11) % 10 != parseFloat(id.charAt(12))) {
                    $('#txtZCardId').val()
                    swal("ตรวจสอบข้อมูล", "รหัสบัตรประชาชนไม่ถูกต้องกรุณาตรวจสอบ", "warning")
                    $('#txtZCardId').val('')
                    return false
                } else {

                    return true

                }

            }

        }

     const NoticeStatusApplicationandEnabledButton = () => {

         if ($('#hdfapplicationStatusId').val() == '4' || $('#hdfapplicationStatusId').val() == '5') {
             $('#divNotification').show();

             $('#msg').text('เนื่องจากสถานะของ Application เป็น ปกติ หรือ ยกเลิก');

             $('#dtContractPersent').find('button').attr('disabled', false);
             $('#dtApplicationRound').find('button').attr('disabled', true);
             $('#dtContractPersent').find('button').attr('disabled', true);
             //$('#dtContractPersent').find('a').prop('disabled', true);

             SetButton(true);
         } else {

             if ($('#hdfApplicationRoundStatusId').val() == '3' || $('#hdfApplicationRoundStatusId').val() == '6') {
                 $('#divNotification').show();

                 $('#msg').text('เนื่องจากสถานะรอบ เป็น ขอออกกรมธรรม์ หรือ ขอออกกรมธรรม์ (แก้ไข)');

                 //$('#dtContractPersent').find('button').attr('disabled', false);
                 $('#dtApplicationRound').find('button').attr('disabled', true);
                 $('#dtContractPersent').find('table tbody tr td button').attr('disabled', true);

                 SetButton(true);
             } else {
                 $('#divNotification').hide();
                 SetButton(false);
             }

         }

     }

     const CheckStatusAppAndRound = () => {

         let s_applicationStatusId = $('#hdfapplicationStatusId').val();
         let s_applicationRoundId = $('#hdfApplicationRoundStatusId').val();

         let isrs = true;

         switch (s_applicationStatusId) {

             case '2':  //สถานะแอพเป็น บันทึกลูกค้าใหม่
                 isrs = false;
                 break;
             case '3': //สถานะแอดเป็น รอดำเนินการ

                 switch (s_applicationRoundId) {

                     case '2':  // สถานะรอบเป็น รอดำเนินการ
                         isrs = false;
                         break;
                     case '3': // สถานะรอบเป็น ขอออกกรมธรรม์
                         isrs = true;
                         break;

                     case '5':  // สถานะรอบเป็น ไม่อนุมัติกรมธรรม์
                         isrs = true;
                         break;
                     case '6': // สถานะรอบเป็น ขอออกกรมธรรม (แก้ไข)
                         isrs = true;
                         break;
                 }

                 break;
             case '4':  //สถานะแอดเป็น ปกติ
                 isrs = true;
                 break;
             case '5': //สถานะแอดเป็น ยกเลิก
                 isrs = true;
                 break;

         }

         return isrs;
     }

     const GetAboutCustomerDetailImported = () => {

         let isResult;

         $.ajax({
             type: "GET",
             url: "@Url.Action("GetApplicationRoundByID", "PACommunity")",
             data: {
                 applicationRoundID: $('#hdfapplicationRoundId').val()
             },
             dataType: "json",
             async: false,
             success: function (data) {

                 if (data.CustomerBuyBalance == 0 && data.CustomerFreeBalance == 0) {
                     isResult = true
                 } else {
                     isResult = false
                 }

             }
         });

         return isResult;

        }

     //Validate ตอนบันทึกส่งขอออกกรมธรรม์
     const IsValidateForSendPolicy = () => {
         let rs = "";

         //let v_checkNowDate = ChecknowDateByStartCoverDate();

         //if (v_checkNowDate != "") {

         //    if (CheckStatusAppAndRound() == false) {
         //        rs = v_checkNowDate;
         //        return rs;
         //    }

         //}

         //Check CustomerAgent
         let t = $('#dtContractPersent').DataTable();

         if (t.page.info().recordsTotal == 0) {
             rs = "ยังไม่ได้ระบุผู้ประสานงานโครงการ";
             return rs;
         }

         //Check Import CustomerDetail
         if ($('#hdfapplicationRoundId').val() == "") {
             rs = "กรุณาตรวจสอบรอบการรับข้อมูลผู้เอาประกัน";
             return rs;
         }

         if (GetAboutCustomerDetailImported() == false) {
             rs = "กรุณาตรวจสอบการนำเข้ารายการ เนื่องจากนำเข้าไม่ครบ";
             return rs;
         }

         return rs;
     }

     //Validate ผู้ประสานงานโครงการ
     const IsvalidateForContractAgent = () => {
         let rs = "";

         //let v_checkNowDate = ChecknowDateByStartCoverDate();

         //if (v_checkNowDate != "") {
         //    if (CheckStatusAppAndRound() == false) {
         //        rs = v_checkNowDate;
         //        return rs;
         //    }
         //}

         //Check Status Application ID ถ้าไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ ให้ แจ้งเตือน
         if ($('#hdfapplicationStatusId').val() != '2' && $('#hdfapplicationStatusId').val() != '3') {
             rs = "ไม่สามารถเพิ่มผู้ประสานงานโครงการได้ เนื่องจากสถานะไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ";
             return rs;
         }

         if ($('#ddlContractProjectType').val() == "-1") {
             rs = "กรุณาเลือกประเภทผู้ประสานงานโครงการ";
             return rs;
         }

         if ($('#ddlContractProjectAdd').val() == null) {
             rs = "กรุณาเลือกผู้ประสานงานโครงการ";
             return rs;
         }

         //if ($('#txtPerSentAdd').val() == "")    {
         //    rs = "กรุณากรอก %";
         //    return rs;
         //}

         return rs;
     }

     //Validate ตอนกด ลบ ผู้ประสานงานโครงการ
     const IsvalidateForDeleteContractAgent = () => {
         let rs = "";

         //let v_checkNowDate = ChecknowDateByStartCoverDate();

         //if (v_checkNowDate != "") {
         //    if (CheckStatusAppAndRound() == false) {
         //        rs = v_checkNowDate;
         //        return rs;
         //    }
         //}

         //Check Status Application ID ถ้าไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ ให้ แจ้งเตือน
         if ($('#hdfapplicationStatusId').val() != '2' && $('#hdfapplicationStatusId').val() != '3') {
             rs = "ไม่สามารถเพิ่มผู้ประสานงานโครงการได้ เนื่องจากสถานะไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ";
             return rs;
         }

         return rs;
     }

     //Validate ตอนกด เพิ่มรอบ หากไม่เข้าเงื่อนไข ให้ รีเทริน ข้อความ เพื่อนำไปแสดง
     const IsvalidateForBtnAddRound = () => {
         let rs = "";

            //Check now Date if now Day >= 10 of StartDate return Text
         //let v_checkNowDate = ChecknowDateByStartCoverDate();

         //if (v_checkNowDate != "") {
         //    if (CheckStatusAppAndRound() == false) {
         //        rs = v_checkNowDate;
         //        return rs;
         //    }
         //}

         return rs;
     }

     const ChecknowDateByStartCoverDate = () => {

         let d_premissionDate = GetProgramConfig_PermissionDate();
         let startCoverDate = $('#dtpStartCoverDate').datepicker('getDate');
         let n_d = new Date();

         let rs = "";

         //let check_nowDate = moment(new Date(), "DD/MM/YYYY","L");
         let check_nowDate = moment(DisplayJsonDateBE(new Date()),"DD/MM/YYYY")._d;
         let checkDate = moment(ConvertCheckDateByStartCoverDate(), "DD/MM/YYYY")._d;

         if (check_nowDate > checkDate) {
             rs = "ไม่สามารถทำรายการได้ เนื่องจากหมดเวลาขอความคุ้มครอง";
             return rs;
         }

         return rs;

     }

     const ConvertCheckDateByStartCoverDate = () => {
         let startCoverDate = $('#dtpStartCoverDate').datepicker('getDate');
         let d_premissionDate = GetProgramConfig_PermissionDate();

         let check = moment(startCoverDate, 'DD/MM/YYYY').add(543,'years');
         let month = check.format('MM');
         let year = check.format('YYYY');

         let date_check = d_premissionDate + '/' + month + '/' + year;

         return date_check;
     }

     //เมื่อมีการบันทึกรอบ เสร็จสิ้น ให้ เคลียร์ค่า ในช่อง ใน Modal-AddRound
     const DoClearApplicationRound = () => {

        $('#txtAddCustomerBuy').val('');
        $('#txtAddCustomerFree').val('');
        $('#txtPremiumSum').val('');
     }

     //เมื่อมีการบันทึกผู้ประสานงานโครงการ เสร็จสิ้น ให้เคลียร์ค่า ในช่อง ใน Modal-ContractAgent
     const DoClearContractAgent = () => {

        $('#txtPerSentAdd').val('');
        $('#ddlContractProjectType').select2().val("-1").trigger('change.select2');
        $('#ddlContractProjectAdd').empty().trigger('change');

     }

     // เมื่อกรอกข้อความ ลงช่อง หน่วยงาน / โรงเรียน ให้รีเทิร์น ข้อมูล โดย id = OrganizeID และ text = OrganizeFullDetail โดยข้อมูลนี้จะถูกแสดงก่อนที่จะคลิกเลือก
     function processData(data) {
         var mapdata = $.map(data, function (obj) {
             obj.id = obj.OrganizeId;
             obj.text = obj.OrganizeFullDetail;
             return obj;
         });
         return { results: mapdata };
     }

     //เมื่อคลิกเลือกข้อมูล ให้ตั้งค่า ให้กับ text ใหม่ ให้แสดงเป็น Organize
     function formatRepoSelection(repo) {
         return repo.Organize || repo.text;
     }

     //ตั้งค่า ปิด/เปิด ปุ่ม แก้ไข / เพิ่มรอบ / เพิ่มผู้ประสานงาน / ขอออกกรมธรรม์
     const SetButton = (e) => {
         $('#btnEditPACommunity').prop('disabled', e);
         $('#btnAddContractModal').prop('disabled', e);
         //$('#btnAddRound').prop('disabled', e);
         $('#btnEditPACommunity').prop('disabled', e);
         $('#btnSendPolicy').prop('disabled', e);
     }

     // ส่งข้อมูลไปแก้ไข
        const DoEditAppicatonDetail = () => {
            let isContact = false;
            let idCard = $('#txtZCardId').val();
            let passport = $('#txtPassportNo').val();

            if ($('#rdoContact').iCheck('update')[0].checked == true) {
                isContact = true;
            }

         $.ajax({
             type: "POST",
             url: '@Url.Action("DoEditApplicationDetail")',
             data: {
                 applicationId: $('#hdfAppID').val(),
                 companyId: $('#ddlCommunityName').val(),
                 applicationName: $('#txtPolicyname').val(),
                 applicationStatusID: $('#hdfapplicationStatusId').val(),
                 startCoverDate: $('#dtpStartCoverDate').val(),
                 endCoverDate: $('#dtpEndCoverDeate').val(),
                 titleId: $('#ddlTitle').val(),
                 firstName: $('#txtContractFirstName').val(),
                 lastName: $('#txtContractLastName').val(),
                 mobileNumber: $('#txtContractTel').val(),
                 branchId: $('#hdfBranchID').val(),
                 productId: $('#ddlProduct').val(),
                 bankId: $('#ddlBank').val(),
                 accountName: $('#txtAccountName').val(),
                 accountNo: $('#txtAccountNo').val(),
                 isContact: isContact,
                 idCard: $('#txtZCardId').val(),
                 passport: $('#txtPassportNo').val()
             },
             dataType: "json",
             success: function (response) {
                 //ถ้าทำสำเร็จ ให้ alert ข้อความ และ โหลดข้อมูลใหม่
                 if (response[0] == "True") {
                     swal(response[2],"","success");

                     GetApplicationDetail();
                     GetOrganizeByID();
                     GetContractCommunity();
                     GetDTContractProject();
                     GetDTApplicationRound();

                 } else { //ถ้าไม่สำเร็จ ให้แสดงข้อความ และไม่โหลดข้อมูล
                     //alert(response[2]);

                     swal(response[2],"","error");
                 }
             }
         });
     }

     // เซ็ตค่า ของเบี้ยแผน โดยอ้างอิงจาก แผน
     const GetPremiumByProductID = () => {
         $.ajax({
             type: "GET",
             url: '@Url.Action("GetProductByID", "PACommunity")',
             data: {
                 productId: $('#ddlProduct').val()
             },
             dataType: "json",
             success: function (response) {
                 $('#txtPremium').val(response.PremiumPerYear);
             }
         });
     }

     //ส่งข้อมูล ไปบันทึกส่งขอออกกรมธรรม์
     const DoSendPolicy = () => {
         $.ajax({
             type: "POST",
             url: '@Url.Action("DoSendPolicy", "PACommunity")',
             data: {
                 applicationRoundId: $('#hdfapplicationRoundId').val()
             },
             dataType: "json",
             success: function (response) {
                 if (response[0] == "True") {

                     window.swal({
                         title: 'รายการ',
                         type: 'success',
                         text: 'ทำรายการสำเร็จ',
                         showCancelButton: false,
                         confirmButtonColor: '#26A65B',
                         confirmButtonText: 'ตกลง',
                         closeOnEsc: false,
                         className: "text"
                     }, function () {

                         //Close Page
                         window.close();

                     });

                 } else {
                     window.swal({
                         title: 'ทำรายการไม่สำเร็จ',
                         type: 'error',
                         text: response[2],
                         showCancelButton: false,
                         confirmButtonColor: '#26A65B',
                         confirmButtonText: 'ตกลง',
                         closeOnEsc: false,
                         className: "text"
                     }, function () {

                     });
                 }
             }
         });
     }

     //ส่งข้อมูล ไปบันทึกรอบ โดยส่ง AppID,CustBuy,CustFree,EffectiveDate,PremiumSum ไปบันทึก
     const DaSaveApplicationRound = () => {
         $.ajax({
             type: "POST",
             url: '@Url.Action("DoSaveApplicationRound", "PACommunity")',
             data: {
                 applicationID: $('#hdfAppID').val(),
                 customerBuy: $('#txtAddCustomerBuy').val(),
                 customerFree: $('#txtAddCustomerFree').val(),
                 effectiveDate: $('#dtpEffectiveDate').val(),
                 premiumSum: $('#txtPremiumSum').val()
             },
             dataType: "json",
             success: function (response) {

                 if (response[0] == "True") {

                     //alert msg
                     swal(response[2],"","success");
                     // Load ApplicationRound Data
                     GetDTApplicationRound();
                     GetApplicationDetail();
                     GetOrganizeByID();
                     GetContractCommunity();
                     GetDTContractProject();

                     //DoClearApplicationRound
                       DoClearApplicationRound();

                     // hide modal
                     $('#modal-AddRound').modal('hide');
                 } else {

                     // alert msg
                     swal(response[2],"","error");

                     // show modal
                     $('#modal-AddRound').addClass("modal_itemcenter");
                     $('#modal-AddRound').modal('show');

                 }
             }
         });
     }

     //ส่งข้อมูล แก้ไขจำนวนคน ของ ApplicationRound
     const DoEditApplicationRound = () => {
         $.ajax({
             type: "POST",
             url: '@Url.Action("DoUpdateApplicationRound", "PACommunity")',
             data: {
                 applicationRoundID: $('#hdfapplicationRoundId').val(),
                 customerBuy: $('#txtEditAddCustomerBuy').val(),
                 customerFree: $('#txtEditAddCustomerFree').val(),
                 effectiveDate: $('#dtpEditEffectiveDate').val(),
                 //effectiveDate: '01/08/2562',
                 premiumSum: $('#txtEditPremiumSum').val(),

             },
             dataType: "json",
             async: false,
             success: function (response) {
                 if (response[0] == "True") {

                     //alert msg
                     swal(response[2],"","success");
                     // Load ApplicationRound Data
                     GetDTApplicationRound();

                     //DoClearEditApplicationRound
                     DoClearEditApplicationRound();

                     // hide modal
                     $('#modal-EditRound').modal('hide');
                 } else {

                     // alert msg
                     swal(response[2],"","error");

                     // show modal
                     $('#modal-EditRound').addClass("modal_itemcenter");
                     $('#modal-EditRound').modal('show');

                 }
             }
         });
     }

     const DoClearEditApplicationRound = () => {
         $('#txtEditAddCustomerBuy').val('');
         $('#txtEditAddCustomerFree').val('');
         $('#txtEditPremiumSum').val('');

     }

     //Validate ตอนกดแก้ไข รอบ
     const IsValidateForEditApplicationRound = () => {
         let rs = "";

         let statusId = $('#hdfapplicationStatusId').val();
         //Check Status App
         //Check Status Application ID ถ้าไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ ให้ แจ้งเตือน
         if (statusId != '2' && statusId != '3') {
             rs = "ไม่สามารถเพิ่มผู้ประสานงานโครงการได้ เนื่องจากสถานะไม่ใช่ บันทึกลูกค้าใหม่ หรือ รอดำเนินการ";
             return rs;
         }

         if ($("#txtEditAddCustomerBuy").val() == "") {
             rs = "กรุณากรอกคนชำระเบี้ย";
             return rs;
         }

         //if ($("#txtEditAddCustomerFree").val() == "") {
         //    rs = "กรุณากรอกสิทธิ์ฟรี";
         //    return rs;
         //}

         let customerBuy_minimum = GetProgramConfig_CustomerByMinimum();

         //Check CustomerBuy มากกว่าหรือเท่ากับ
         if ($("#txtEditAddCustomerBuy").val() < customerBuy_minimum) {
             rs = "กรุณาตรวจสอบคนชำระเบี้ย เนื่องจากจำนวนยังไม่ถึง " + customerBuy_minimum;
             return rs;
         }

         //let s_CustomerFree = $("#txtEditAddCustomerBuy").val() / customerBuy_minimum;

         //let l_CustomerFree = Math.floor(s_CustomerFree);

         ////Check CustomerFree ไม่เกิน 1 คน
         //if ($("#txtEditAddCustomerFree").val() > l_CustomerFree) {
         //    rs = "กรุณาตรวจสอบสิทธิ์ฟรี เนื่องจากจำนวนต้องไม่เกิน" + l_CustomerFree + "คนเท่านั้น";
         //    return rs;
         //}

         return rs;
     }

     //Validate ตอนกดบันทึก เพิ่มรอบ
     const validateForAddApplicationRound = () => {
         let rs = "";

         if ($("#txtAddCustomerBuy").val() == "") {
             rs = "กรุณากรอกคนชำระเบี้ย";
             return rs;
         }

         //if ($("#txtAddCustomerFree").val() == "") {
         //    rs = "กรุณากรอกสิทธิ์ฟรี";
         //    return rs;
         //}

         let customerBuy_minimum = GetProgramConfig_CustomerByMinimum();

         //Check CustomerBuy มากกว่าหรือเท่ากับ 20
         if ($("#txtAddCustomerBuy").val() < customerBuy_minimum) {
             rs = "กรุณาตรวจสอบคนชำระเบี้ย เนื่องจากจำนวนยังไม่ถึง " + customerBuy_minimum;
             return rs;
         }

         //let s_CustomerFree = $("#txtAddCustomerBuy").val() / customerBuy_minimum;

         //let l_CustomerFree = Math.floor(s_CustomerFree);

         ////Check CustomerFree ไม่เกิน 1 คน
         //if ($("#txtAddCustomerFree").val() > l_CustomerFree) {
         //    rs = "กรุณาตรวจสอบสิทธิ์ฟรี เนื่องจากจำนวนต้องไม่เกิน " + l_CustomerFree + " คนเท่านั้น";
         //    return rs;
         //}

         return rs;
     }

     //ช่องกรอก รหัสผู้ประสานงานโครงการ โดยกรอกได้ทั้ง รหัสพนักงาน ชือ นามสกุล ชื่อเล่น
     const GetContractAgentSelect = () => {
         $("#ddlContractProjectAdd").select2({

           ajax: {
               url: '@Url.Action("GetEmployeeDetail", "PACommunity")',
               dataType: 'json',
               delay: 250,

               data: function (params) {
                   return {
                       q: params.term, // search term
                       page: params.page
                   };
               },
               processResults: (data) => {
                   var mapdata = $.map(data, function (obj) {
                       obj.id = obj.EmployeeID;
                       obj.text = obj.EmployeeCode + ' ' + obj.FullName + ' ('+ obj.NickName + ')';
                       return obj;
                   });
                   return { results: mapdata };
               },
               cache: true
           },
           placeholder: 'ค้นหารายการ',
           escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
           minimumInputLength: 4,

          // templateSelection: formatRepoSelection,
           selectOnClose: true,
           language: { inputTooShort: function () { return 'กรอกข้อมูลอย่างน้อย 4 ตัวอักษร'; } }
       });
     }

     //ส่งข้อมูลไปบันทึก ผู้ประสานงานโครงการ โดยส่ง applicationID ,ContractProjectType,employee,percent หากสำเร็จ ให้ แจ้ง บันทึกสำเร็จ พร้อมโหลดข้อมูล
     const DoSaveContractAgent = () => {
         $.ajax({
             type: "POST",
             url: '@Url.Action("DoSaveContractAgent", "PACommunity")',
             data: {
                 applicationID: $('#hdfAppID').val(),
                 ContractProjectTypeID: $('#ddlContractProjectType').val(),
                 employeeID: $('#ddlContractProjectAdd').val(),
                 //percent: $('#txtPerSentAdd').val()
                 percent: 0
             },
             dataType: "json",
             success: function (response) {

                 //ถ้าสำเร็จ ให้แจ้ง สำเร็จ และโหลดข้อมูลผู้ประสานงานโครงการ

                 if (response[0] == "True") {

                     //โหลด ข้อมูลผู้ประสานงานโครงการ

                     swal(response[2],"","success");
                     GetDTContractProject();

                     //DoClearContractAgent
                      DoClearContractAgent();

                     $('#modal-AddContract').modal('hide');
                 } else {
                     swal(response[2],"","error");
                 }
             }
         });
     }

     //บันทึกข้อมูล NewApp
        const DoSaveApplicationDetail = () => {

            let isContact = false;
            let idCard = $('#txtZCardId').val();
            let passport = $('#txtPassportNo').val();

            if ($('#rdoContact').iCheck('update')[0].checked == true) {
                isContact = true;
            }

         $.ajax({
             type: "POST",
             url: '@Url.Action("DoSaveApplicationDetail", "PACommunity")',
             data: {
                 companyId: $('#ddlCommunityName').val(),
                 applicationName: $('#txtPolicyname').val(),
                 startCoverDate: $('#dtpStartCoverDate').val(),
                 endCoverDate: $('#dtpEndCoverDeate').val(),
                 titleId: $('#ddlTitle').val(),
                 firstName: $('#txtContractFirstName').val(),
                 lastName: $('#txtContractLastName').val(),
                 mobileNumber: $('#txtContractTel').val(),
                 branchId: $('#hdfBranchID').val(),
                 productId: $('#ddlProduct').val(),
                 bankId: $('#ddlBank').val(),
                 accountName: $('#txtAccountName').val(),
                 accountNo: $('#txtAccountNo').val(),
                 isContact: isContact,
                 idCard: $('#txtZCardId').val(),
                 passport: $('#txtPassportNo').val()

             },
             async: false,
             dataType: "json",
             success: function (response) {

                 if (response[0] == "True") {
                     //GetApplicationDetail
                    //GetContractCommunity
                     swal(response[2],"","success");
                     $('#hdfAppID').val(response[1]);
                     GetApplicationDetail();
                     GetOrganizeByID();
                     GetContractCommunity();
                     GetDTContractProject();
                     GetDTApplicationRound();

                     $('#btnSavePACommunity').prop('disabled', true);

                     // disabled Data
                     $('#ddlPolicyGroup').prop('disabled', true);
                     $('#ddlPolicyType').prop('disabled', true);
                     $('#ddlProvince').prop('disabled', true);
                     $('#ddlCommunityName').prop('disabled', true);
                     $('#dtpStartCoverDate').prop('disabled', true);
                     $('#ddlTitle').prop('disabled', true);
                     $('#txtContractFirstName').prop('disabled', true);
                     $('#txtContractLastName').prop('disabled', true);
                     $('#txtContractTel').prop('disabled', true);
                     $('#ddlProduct').prop('disabled', true);

                     $('#ddlBank').prop('disabled', true);
                     $('#txtAccountName').prop('disabled', true);
                     $('#txtAccountNo').prop('disabled', true);

                     $('#divContactCommunity').find('input ,button, select').prop('disabled', true);

                     $("#rdoNoContact").iCheck('disable');
                     $('#rdoContact').iCheck('disable');

                     $('#rdoZCardId').iCheck('disable');
                     $('#rdoPassport').iCheck('disable');

                     $('#boxContractPersent').show();
                     $('#boxImportDetail').show();
                     $('#boxConsent').show();
                     $('#boxBtnPolicy').show();

                 } else {
                     swal(response[2],"","error");
                 }

             },
             Error: function (d) {

             }
         });
     }

     //เซ๊ตข้อมูล ลง input โดยอ้างอิงจาก AppID
     const GetApplicationDetail = () => {
         $.ajax({
             type: "GET",
             url: '@Url.Action("GetApplicationDetail", "PACommunity")',
             data: { applicationID: $('#hdfAppID').val()},
             dataType: "json",
             async: false,
             success: function (response) {
                 if (response == null) {

                 } else {
                     $('#txtApplicationID').text(response.ApplicationCode);
                     $('#txtPolicyNo').text();
                     $('#txtPolicyStatus').text(response.ApplicationStatus);
                     $('#txtPolicyname').val(response.ApplicationName);
                     $('#txtBranch').val(response.Branch);
                     $('#hdfBranchID').val(response.BranchId);
                     $('#ddlProduct').select2().val(response.ProductId).trigger('change.select2');
                     $('#txtPremium').val(response.PremiumPerYear);
                     $('#hdfapplicationStatusId').val(response.ApplicationStatusId);

                     let StartDate = moment(response.StartCoverDate)._d;
                     let EndDate = moment(response.EndCoverDate)._d;

                     $('#dtpStartCoverDate').datepicker({ format: "dd/mm/yyyy" }).datepicker('setDate', new Date(StartDate));
                     $('#dtpEndCoverDeate').datepicker({ format: "dd/mm/yyyy" }).datepicker('setDate', new Date(EndDate));

                     $('#hdfOrganizeID').val(response.OrganizeId);

                 }
             }
         });
     }

     //โหลดข้อมูล ผู้ประสานงานชุมชน
     const GetContractCommunity = () => {
         $.ajax({
             type: "GET",
             url: '@Url.Action("GetContractCommunity", "PACommunity")',
             data: { applicationID: $('#hdfAppID').val()},
             dataType: "json",
            async: false,
            success: function (response) {
                if (response == null) {
                    $('#rdoNoContact').iCheck('check');
                    $('#divContactCommunity').hide();
                } else {
                    $('#ddlTitle').select2().val(response.TitleId).trigger('change.select2');
                    $('#txtContractFirstName').val(response.FirstName);
                    $('#txtContractLastName').val(response.LastName);
                    $('#txtContractTel').val(response.MobileNumber).inputmask();
                    $('#ddlBank').select2().val(response.BankId).trigger('change.select2');
                    $('#txtAccountName').val(response.AccountName);
                    $('#txtAccountNo').val(response.AccountNo);

                    if (response.IdCardNumber !== "") {
                        $('#rdoZCardId').iCheck('check');
                        $('#txtZCardId').val(response.IdCardNumber);

                        //close passport
                        $('#txtPassportNo').prop('disalbed', true);
                    }

                    if (response.PassPortNumber !== "") {
                        $('#rdoPassport').iCheck('check');
                        $('#txtPassportNo').val(response.PassPortNumber);

                        //close idcard
                        $('#txtZCardId').prop('disalbed', true);
                    }
                    $('#rdoContact').iCheck('check');
                    $('#divContactCommunity').show();

                }

             }
         });
     }

     //โหลดข้อมูล หน่วยงาน / โรงเรียน ตอนโหลดโชว์
     const GetOrganizeByID = () => {
         let s = $('#ddlCommunityName');

         $.ajax({
             type: "GET",
             url: '@Url.Action("GetOrganizeById", "PACommunity")',
             data: { organizeID: $('#hdfOrganizeID').val()},
             dataType: "json",
             async: false,
             success: function (response) {
                 let address1 = "เลขที่: " + response.CurrentNo + " ชื่อหน่วยงาน: " + response.CurrentBuildingName;
                 let address2 = "หมู่ที่: " + response.CurrentMoo + " ถนน: " + response.CurrentRoad;
                 let subDristirct = response.CurrentSubDistrict;
                 let dristirct = response.CurrentDistrict;
                 let province = response.CurrentProvince;
                 let zipcode = response.CurrentZipCode;

                 var option = new Option(response.Organize, response.OrganizeId, true, true);
                 s.append(option).trigger('change.select2');

                 $('#ddlPolicyGroup').select2().val(response.OrganizeGroupId).trigger('change.select2');
                 GetOrganizeType();
                 $('#ddlPolicyType').select2().val(response.OrganizeTypeId).trigger('change.select2');
                 $('#ddlProvince').select2().val(response.CurrentProvinceId).trigger('change.select2');
                 $('#txtAddress1').val(address1);
                 $('#txtAddress2').val(address2);
                 $('#txtSubDristirct').val(subDristirct);
                 $('#txtDristirct').val(dristirct);
                 $('#txtProvince').val(province);
                 $('#txtZipcode').val(zipcode);
             }
         });
     }

     const GetOrganizeType = () => {

         $('#ddlPolicyType').empty();
         $.ajax({
             type: "GET",
             url: "@Url.Action("GetOrganizeType", "PACommunity")",
             data: {
                 organizeGroupId: $('#ddlPolicyGroup').val()
             },
             async: false,
             dataType: "json",
             success: function (response) {

                 $('#ddlPolicyType').append('<option value="-1">--ท้งหมด--</option>');

                 for (var i = 0; i < response.length; i++) {
                     $('#ddlPolicyType').append('<option value=' + response[i].OrganizeTypeId + '>' + response[i].OrganizeType +'</option>')
                 }
             }
         });
     }

     //Get Data in ProgramConfig เช็ค วันที่ หมดเวลาการขอความคุ้มครอง
     const GetProgramConfig_PermissionDate = () => {
         let result;

         $.ajax({
             type: "GET",
             url: '@Url.Action("GetProgramConfig", "PACommunity")',
             data: {
                 parameterName: $('#hdfPremissionDate').val()
             },
             dataType: "json",
             async: false,
             success: function (response) {
                 if (response.ValueBoolean == true) {
                     result = response.ValueString;
                 } else {
                     result = null;
                 }
             }
         });

         return result;
     }

     const GetProgramConfig_CustomerByMinimum = () => {
         let result;

         $.ajax({
             type: "GET",
             url: '@Url.Action("GetProgramConfig", "PACommunity")',
             data: {
                 parameterName: $('#hdfCustomerBuyMinimum').val()
             },
             dataType: "json",
             async: false,
             success: function (response) {
                 if (response.ValueBoolean == true) {
                     result = response.ValueNumber;
                 } else {
                     result = null;
                 }
             }
         });

         return result;

     }

     // validate ตอนบันทึกข้อมูลชุมชน
     const IsvalidateforSavePolicy = () => {
         let result = "";

         //if ($('#ddlPolicyType').val() == null) {
         //    result = "กรุณาเลือกประเภท";
         //    return result;
         //}

         if ($('#ddlProvince').val() == "-1") {
             result = "กรุณาเลือกจังหวัด";
             return result;
         }

         if ($('#ddlCommunityName').val() == null) {
             result = "กรุณาเลือก หน่วยงาน หรือ โรงเรียน";
             return result;
         }

         //StartCoverDate
         let jsDate = $('#dtpStartCoverDate').datepicker('getDate');
         if (jsDate == "") {
             result = "กรุณาเลือก วันเริ่มคุ้มครอง";
             return result;
         } else {

             //if (ChecknowDateByStartCoverDate() != "") {
             //    result = ChecknowDateByStartCoverDate();
             //    return result;
             //}

         }

         //Product

         if ($('#ddlProduct').val() == "-1") {
             result = "กรุณาเลือก แผนประกัน";
             return result;
         }

         let isContact = false;

         isContact = $('#rdoContact').iCheck('update')[0].checked;
         if (isContact == true) {

             //Title
             if ($('#ddlTitle').val() == "-1") {
                 result = "กรุณาเลือก คำนำหน้า";
                 return result;
             }

             //Contract FirstName
             if ($('#txtContractFirstName').val() == "") {
                 result = "กรุณากรอก ชื่อ ผู้ประสานงานชุมชน";
                 return result;
             }

             //Contract LasName
             if ($('#txtContractLastName').val() == "") {
                 result = "กรุณากรอก นามสกุล ผู้ประสานงานชุมชน";
                 return result;
             }

             //Contract Tel
             if ($('#txtContractTel').val() == "") {
                 result = "กรุณากรอก เบอร์โทร ผู้ประสานงานชุมชน";
                 return result;
             } else {
                 //ต้องครบ 10 หลัก
                 let t = $('#txtContractTel').val();
                 let t1 = t.replace("-", "");
                 t1 = t1.replace("_", "");
                 if (t1.length != 10) {
                     result = "เบอร์โทร ผู้ประสานงานชุมชน ต้องครบ 10 หลัก ";
                     return result;
                 }
             }

             //Check Zcard Passport
             let rdoZcard = $('#rdoZCardId').iCheck('update')[0].checked;
             let rdoPassport = $('#rdoPassport').iCheck('update')[0].checked;

             if (rdoZcard == true) {
                 //Check null ZcardId
                 if ($('#txtZCardId').val() == "") {
                     result = "กรุณากรอก เลขบัตรประชาชน";
                     return result;
                 }
             }

             if (rdoPassport == true) {
                 //Check null passport
                 if ($('#txtPassportNo').val() == "") {
                     result = "กรุณากรอก เลขบัตรPassport";
                     return result;
                 }
                 let c_passportNo = $('#txtPassportNo').val();
                 //Check length passport
                 if (c_passportNo.length < 6) {
                     result = "กรุณาตรวจสอบ เลขบัตรPassport เนื่องจากต้องมี 6 หลักขึ้นไป";
                     return result;
                 }

             }

             if ($('#ddlBank').val() == '-1') {
                 result = "กรุณาเลือก ธนาคาร";
                 return result;
             }

             if ($('#txtAccountName').val() == "") {
                 result = "กรุณากรอก ชื่อบัญชี";
                 return result;
             }

             if ($('#txtAccountNo').val() == "") {
                 result = "กรุณากรอก เลขที่บัญชี";
                 return result;
             } else {

                 let accountNo = $('#txtAccountNo').val();

                 var regex = new RegExp("^[0-9]+$");

                 if (!regex.test(accountNo)) {
                     result = "กรุณาตรวจสอบ เลขที่บัญชี เนื่องจากต้องเป็นตัวเลขเท่านั้น(0-9)";
                     return result;
                 }
             }

         }

         return result;
     }

     // Validate ตอนแก้ไขข้อมูลชุมชน
     const ValidateForEditApplicationDetail = () => {
         let result = "";

         //if ($('#ddlPolicyType').val() == null) {
         //    result = "กรุณาเลือกประเภท";
         //    return result;
         //}

         if ($('#ddlProvince').val() == "-1") {
             result = "กรุณาเลือกจังหวัด";
             return result;
         }

         if ($('#ddlCommunityName').val() == null) {
             result = "กรุณาเลือก หน่วยงาน หรือ โรงเรียน";
             return result;
         }

         //StartCoverDate
         let jsDate = $('#dtpStartCoverDate').datepicker('getDate');
         if (jsDate == "") {
             result = "กรุณาเลือก วันเริ่มคุ้มครอง";
             return result;
         } else {

                 //if (ChecknowDateByStartCoverDate() != "") {
                 //    if (CheckStatusAppAndRound() == false) {
                 //        result = ChecknowDateByStartCoverDate();
                 //        return rs;
                 //    }
                 //}
         }

         //Product

         if ($('#ddlProduct').val() == "-1") {
             result = "กรุณาเลือก แผนประกัน";
             return result;
         }

         // เช๊ค สถานะ แอพ ถ้าสถานะแอพ เป็น ปกติ หรือ ยกเลิกไม่สามารถแก้ไขข้อมูลได้
         if ($('#hdfapplicationStatusId').val() == "4" && $('#hdfapplicationStatusId').val() == "5" ) {
             result = "ไม่สามารถแก้ไขได้ เนื่องจากสถานะของแอพ เป็น ปกติ หรือ ยกเลิก";
             return result;
         }

         let isContact = false;

         isContact = $('#rdoContact').iCheck('update')[0].checked;

         if (isContact == true) {

             //Title
             if ($('#ddlTitle').val() == "-1") {
                 result = "กรุณาเลือก คำนำหน้า";
                 return result;
             }

             //Contract FirstName
             if ($('#txtContractFirstName').val() == "") {
                 result = "กรุณากรอก ชื่อ ผู้ประสานงานชุมชน";
                 return result;
             }

             //Contract LasName
             if ($('#txtContractLastName').val() == "") {
                 result = "กรุณากรอก นามสกุล ผู้ประสานงานชุมชน";
                 return result;
             }

             //Contract Tel
             if ($('#txtContractTel').val() == "") {
                 result = "กรุณากรอก เบอร์โทร ผู้ประสานงานชุมชน";
                 return result;
             } else {
                 //ต้องครบ 10 หลัก
                 let t = $('#txtContractTel').val();
                 let t1 = t.replace("-", "");
                 t1 = t1.replace("_", "");
                 if (t1.length != 10) {
                     result = "เบอร์โทร ผู้ประสานงานชุมชน ต้องครบ 10 หลัก ";
                     return result;
                 }
             }

             let rdoZcard = $('#rdoZCardId').iCheck('update')[0].checked;
             let rdoPassport = $('#rdoPassport').iCheck('update')[0].checked;

             if (rdoZcard == true) {
                 //Check null ZcardId
                 if ($('#txtZCardId').val() == "") {
                     result = "กรุณากรอก เลขบัตรประชาชน";
                     return result;
                 }
             }

             if (rdoPassport == true) {
                 //Check null passport
                 if ($('#txtPassportNo').val() == "") {
                     result = "กรุณากรอก เลขบัตรPassport";
                     return result;
                 }

                 //Check length passport
                 let c_passportNo = $('#txtPassportNo').val();
                 //Check length passport
                 if (c_passportNo.length < 6) {
                     result = "กรุณาตรวจสอบ เลขบัตรPassport เนื่องจากต้องมี 6 หลักขึ้นไป";
                     return result;
                 }

             }

             if ($('#ddlBank').val() == '-1') {
                 result = "กรุณาเลือก ธนาคาร";
                 return result;
             }

             if ($('#txtAccountName').val() == "") {
                 result = "กรุณากรอก ชื่อบัญชี";
                 return result;
             }

             if ($('#txtAccountNo').val() == "") {
                 result = "กรุณากรอก เลขที่บัญชี";
                 return result;
             } else {

                 let accountNo = $('#txtAccountNo').val();

                 var regex = new RegExp("^[0-9]+$");

                 if (!regex.test(accountNo)) {
                     result = "กรุณาตรวจสอบ เลขที่บัญชี เนื่องจากต้องเป็นตัวเลขเท่านั้น(0-9)";
                     return result;
                 }
             }

         }

         return result;
     }

     //แปลงค่า string to date
     function stringToDate(_date, _format, _delimiter) {
         var formatLowerCase = _format.toLowerCase();
         var formatItems = formatLowerCase.split(_delimiter);
         var dateItems = _date.split(_delimiter);
         var monthIndex = formatItems.indexOf("mm");
         var dayIndex = formatItems.indexOf("dd");
         var yearIndex = formatItems.indexOf("yyyy");
         var month = parseInt(dateItems[monthIndex]);
         month -= 1;
         var formatedDate = new Date(dateItems[yearIndex]-543, month, dateItems[dayIndex]);
         return formatedDate;
     }

     //โหลดข้อมูล หน่วยงาน / โรงเรียน ตอนคลิกเลือกรายการ หน่วยงาน ให้ Set ข้อมูล ลง Input
     const GetOrganizeDetail = () => {
         $.ajax({
             type: "GET",
             url: '@Url.Action("GetOrganizeById", "PACommunity")',
             data: { organizeID: $('#ddlCommunityName').val()},
             dataType: "json",
             success: function (response) {

                 let policyName = response.Organize;
                 let address1 = "เลขที่: " + response.CurrentNo + " ชื่อหน่วยงาน: " + response.CurrentBuildingName;
                 let address2 = "หมู่ที่: " + response.CurrentMoo + " ถนน: " + response.CurrentRoad;
                 let subDristirct = response.CurrentSubDistrict;
                 let dristirct = response.CurrentDistrict;
                 let province = response.CurrentProvince;
                 let zipcode = response.CurrentZipCode;

                 $('#txtPolicyname').val(policyName);
                 $('#txtAddress1').val(address1);
                 $('#txtAddress2').val(address2);
                 $('#txtSubDristirct').val(subDristirct);
                 $('#txtDristirct').val(dristirct);
                 $('#txtProvince').val(province);
                 $('#txtZipcode').val(zipcode);

             }
         });
     }

     //โหลด ตาราง รอบ
     const GetDTApplicationRound = () => {
         $('#dtApplicationRound').empty();
         var table = $('#dtApplicationRound').DataTable({
                pageLength: 10,
                processing: true,
                serverSide: true,
                responsive: true,
                destroy: true,
                ajax: {
                    url: '@Url.Action("GetApplicationRoundDetail", "PACommunity")',
                    type: 'POST',
                    async: false,
                    data: function (d) {
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.pageStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = d.search.value;
                        d.applicationID = $('#hdfAppID').val();
                        //d.applicationID = 2;
                    }
                },
                columns: [
                    { title: 'รอบที่', data: 'Round', width: '8%', className: 'h-dt-center d-dt-center' },
                    { title: 'รหัสรอบ', data: 'ApplicationRoundCode', className: 'h-dt-center d-dt-center' },
                    {
                        title: 'วันที่มีผลบังคับ', data: 'EffectiveDate',
                        className: 'h-dt-center d-dt-center',
                        mRender: function (data) {
                            moment.locale('th');
                            return moment(data).add(543, 'years').format("DD/MM/YYYY","LLLL");
                        }
                    },
                    { title: 'คนชำระเบี้ย', data: 'CustomerBuy', className: 'h-dt-center d-dt-center', width: '12%'},
                    { title: 'รับสิทธิ์ฟรี', data: 'CustomerFree', className: 'h-dt-center d-dt-center', width: '11%'},
                    {
                        title: 'แก้ไขจำนวนคน',
                        data: null,
                        width: '10%',
                        className: 'h-dt-center d-dt-center',
                        mRender: (data) => {
                            return '<span class="btn btn-warning btn-sm" onclick="ButtonEditCustomerDetail();"><i class="fa fa-fw fa-edit"></i></span>';
                        }
                    },
                    { title: 'สถานะรอบ', data: 'ApplicationRoundStatus', className: 'h-dt-center d-dt-center', },

                    {
                        title: '',
                        data: null,
                        width: '25%',
                        className: 'h-dt-center d-dt-center',
                        mRender: (data) => {
                            return '<button type="button" class="btn btn-info btn-sm" onclick="ChooseApplicationRoundForImport(\'' + data.ApplicationRoundId + '\'); "><i class="fa fa-fw fa-plus"></i> นำเข้า</button> '
                                + '<a href = "' + data.UrlLinkScan + '" target = "_blank" class="btn btn-warning btn-sm" > <i class="fa fa-fw fa-upload"></i> Scan</a> '
                                + '<a href="' + data.UrlLinkOpen + '" target="_blank" class="btn btn-info btn-sm" > <i class="fa fa-fw fa-file"></i> เอกสาร</a > ';

                        }

                    }
                    //{ title: 'ทีม', data: 'ClaimCount', className: 'dt-center', },
                ],
                bLengthChange: false,
                createdRow: function (row, data, index) {
                    $('#hdfApplicationRoundStatusId').val(data.ApplicationRoundStatusId);

                    $('#hdfapplicationRoundId').val(data.ApplicationRoundId);
                },

         });
         var t_c = table.page.info().recordsTotal;
         if (t_c > 0) {
             $('#btnAddRound').prop('disabled', true);
         } else {
             $('#btnAddRound').prop('disabled', false);
         }

     }

     // โหลดข้อมูล ลงตาราง ApplicationSubRound ประวัติการแก้ไขจำนวนคนแต่ละรอบ
     const GetDTApplicationSubRound = () => {
         $('#dtApplicationSubRound').empty();

         var table = $('#dtApplicationSubRound').DataTable({
                pageLength: 2,
                processing: true,
                serverSide: true,
                responsive: true,
                destroy: true,
                searching: false,
                ajax: {
                    url: '@Url.Action("GetApplicationSubRoundDetail", "PACommunity")',
                    type: 'POST',
                    async: false,
                    data: function (d) {
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.pageStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = d.search.value;
                        d.applicationRoundID = $('#hdfapplicationRoundId').val();
                    }
                },
                columns: [

                    //{ title: 'รหัสรายการ', data: 'ApplicationRoundCode' },
                    {
                        title: 'วันที่ทำรายการ', data: 'CreatedDate',
                        className: 'h-dt-center d-dt-center',
                        mRender: function (data) {
                            moment.locale('th');
                            return moment(data).add(543, 'years').format("DD/MM/YYYY hh:mm","LLLL");
                        }
                    },
                    { title: 'คนชำระเบี้ย', data: 'CustomerBuy', className: 'h-dt-center d-dt-center', },
                    { title: 'สิทธิ์ฟรี', data: 'CustomerFree', className: 'h-dt-center d-dt-center' },
                ],
                bLengthChange: false,
                createdRow: function (row, data, index) {
                },
         });
     }

     //โหลดข้อมูล ApplicationRound
     const GetApplicationRoundofEdit = () => {
         $.ajax({
            type: "GET",
            url: '@Url.Action("GetApplicationRoundByID", "PACommunity")',
            data: {
                applicationRoundID: $('#hdfapplicationRoundId').val()
            },
            dataType: "json",
            success: function (response) {
                let effectiveDate = moment(response.EffectiveDate).add(543, 'years').format("DD/MM/YYYY") ;

                $('#txtEditRoundID').val(response.ApplicationRoundCode);
                $('#dtpEditEffectiveDate').val(effectiveDate);

            }
        });
     }

     //ปุ่ม แก้ไขจำนวนคน ในตารางนำเข้า
     const ButtonEditCustomerDetail = () => {

         //Open Modal
         $('#modal-EditRound').addClass("modal_itemcenter");
         $('#modal-EditRound').modal('show');

         //DoDTApplicationSubRound
         GetDTApplicationSubRound();
         GetApplicationRoundofEdit();
         $("#txtEditAddCustomerBuy").inputmask('decimal', {
             rightAlign: true
         });

         $("#txtEditAddCustomerFree").inputmask('decimal', {
             rightAlign: true
         });

         //if (ChecknowDateByStartCoverDate() == "") {
         //    //Open Modal
         //    $('#modal-EditRound').addClass("modal_itemcenter");
         //    $('#modal-EditRound').modal('show');

         //    //DoDTApplicationSubRound
         //    GetDTApplicationSubRound();
         //    GetApplicationRoundofEdit();
         //    $("#txtEditAddCustomerBuy").inputmask('decimal', {
         //        rightAlign: true
         //    });

         //    $("#txtEditAddCustomerFree").inputmask('decimal', {
         //        rightAlign: true
         //    });
         //} else {

         //    if (CheckStatusAppAndRound() == false) {
         //        swal("คำเตือน", ChecknowDateByStartCoverDate(), "warning");
         //    } else {
         //        //Open Modal
         //        $('#modal-EditRound').addClass("modal_itemcenter");
         //        $('#modal-EditRound').modal('show');

         //        //DoDTApplicationSubRound
         //        GetDTApplicationSubRound();
         //        GetApplicationRoundofEdit();
         //        $("#txtEditAddCustomerBuy").inputmask('decimal', {
         //            rightAlign: true
         //        });

         //        $("#txtEditAddCustomerFree").inputmask('decimal', {
         //            rightAlign: true
         //        });
         //    }
         //}
     }

     //ปุ่ม นำเข้า เมื่อคลิก ให้ แสดง Modal ให้เลือกการนำเข้า
     const ChooseApplicationRoundForImport = (applicationRoundID) => {
         $('#modal-ChooseImporting').addClass("modal_itemcenter");
         $('#modal-ChooseImporting').modal('show');

         //if (ChecknowDateByStartCoverDate() == "") {
         //    $('#modal-ChooseImporting').addClass("modal_itemcenter");
         //    $('#modal-ChooseImporting').modal('show');
         //} else {

         //    if (CheckStatusAppAndRound() == false) {
         //        swal("คำเตือน", ChecknowDateByStartCoverDate(), "warning");
         //    } else {
         //        $('#modal-ChooseImporting').addClass("modal_itemcenter");
         //        $('#modal-ChooseImporting').modal('show');
         //    }

         //}

     }

     //แสดงข้อมูล ผู้ประสานงานโครงการ
     const GetDTContractProject = () => {

         $('#dtContractPersent').empty();
          var table = $('#dtContractPersent').DataTable({
                pageLength: 10,
                processing: true,
                serverSide: true,
                responsive: true,
                destroy: true,
                ajax: {
                    url: '@Url.Action("GetContractProject","PACommunity")',
                    type: 'POST',
                    data: function (d) {
                        d.draw = d.draw;
                        d.pageSize = d.length;
                        d.pageStart = d.start;
                        d.sortField = d.columns[d.order[0].column].data;
                        d.orderType = d.order[0].dir;
                        d.search = d.search.value;
                        d.applicationID = $('#hdfAppID').val();
                    }
                },
                columns: [
                    { title: 'รหัสพนักงาน', data: 'EmployeeCode', className: 'h-dt-center d-dt-center', width: '15%'},
                    { title: 'ชื่อ - นามสกุล', data: 'EmployeeName', className: 'h-dt-center d-dt-center', },
                    { title: 'สาขา', data: 'Branch', className: 'h-dt-center d-dt-center', },
                    { title: 'ทีม', data: 'Team', className: 'h-dt-center d-dt-center', },
                    {
                        title: '',
                        data: null,
                        className: 'h-dt-center d-dt-center',
                        mRender: (data) => {
                            //if (ChecknowDateByStartCoverDate() == "") {
                            //    return '<button type="button"  onclick="DoDeleteContractAgent(\'' + data.ApplicationAgentId + '\');" class="btn btn-danger btn-sm"><i class="fa fa-fw fa-eraser"></i> ลบ</button>'
                            //} else {
                            //    if (CheckStatusAppAndRound() == false) {

                            //        return '<button type="button"  onclick="DoDeleteContractAgent(\'' + data.ApplicationAgentId + '\');" class="btn btn-danger btn-sm"><i class="fa fa-fw fa-eraser"></i> ลบ</button>'

                            //    } else {
                            //        return '<button type="button" class="btn btn-danger btn-sm" disabled="disabled"><i class="fa fa-fw fa-eraser"></i> ลบ</button>'
                            //    }

                            //}

                            return '<button type="button"  onclick="DoDeleteContractAgent(\'' + data.ApplicationAgentId + '\');" class="btn btn-danger btn-sm"><i class="fa fa-fw fa-eraser"></i> ลบ</button>'
                        }
                    }
                ],
                bLengthChange: false,
                //createdRow: function (row, data, index) {
                //    if (data.ClaimOnLineStatusId == 3) {
                //        $('td', row).addClass('selected');
                //    }
                //},

            });

     }

     //ปุ่ม ลบ ผู้ประสานงานโครงการ
     const DoDeleteContractAgent = (applicationAgentId) => {
         window.swal({
             title: 'ยืนยันการทำรายการหรือไม่?',
             type: 'warning',
             showCancelButton: true,
             confirmButtonColor: '#277020',
             confirmButtonText: 'ตกลง',
             cancelButtonText: 'ยกเลิก',
             closeOnConfirm: false,
             closeOnEsc: false,
             closeOnCancel: true
         }, function () {

             //ValidateForDeleteContractAgent
             let v_DeleteForContractAgent = IsvalidateForDeleteContractAgent();

             if (v_DeleteForContractAgent == "") {
                 $.ajax({
                type: "POST",
                url: '@Url.Action("DoDeleteContractAgent","PACommunity")',

                data: {
                      applicationAgentId: applicationAgentId
                    },
                    dataType: "json",
                    success: function (response) {
                        if (response[0] == "True") {
                            window.swal({
                            title: 'รายการ' ,
                            type: 'success',
                            text: 'ทำรายการสำเร็จ',
                            showCancelButton: false,
                            confirmButtonColor: '#26A65B',
                            confirmButtonText: 'ตกลง',
                            closeOnEsc: false,
                            className: "text"
                            }, function () {

                                GetDTContractProject();

                            });
                        } else {
                            window.swal({
                            title: 'ทำรายการไม่สำเร็จ' ,
                            type: 'error',
                            text: response[2],
                            showCancelButton: false,
                            confirmButtonColor: '#26A65B',
                            confirmButtonText: 'ตกลง',
                            closeOnEsc: false,
                            className: "text"
                            }, function () {
                                //GetDatatableQueue();
                                //GetDatatableQueueEmployee();
                                @*window.location = "@Url.Action("ClaimOnLine","ClaimOnLine")";*@
                            });
                        }
                    }
                 });

             } else {
                 window.swal({
                     title: 'ทำรายการไม่สำเร็จ',
                     type: 'error',
                     text: v_DeleteForContractAgent,
                     showCancelButton: false,
                     confirmButtonColor: '#26A65B',
                     confirmButtonText: 'ตกลง',
                     closeOnEsc: false,
                     className: "text"
                 }, function () {
                     //GetDatatableQueue();
                     //GetDatatableQueueEmployee();
                     @*window.location = "@Url.Action("ClaimOnLine","ClaimOnLine")";*@
                            });
             }
         });

     }

     //Set วันเริ่มคุ้มครอง
     const SetCoverDate = () => {
         var d = new Date();

         let date_nextmonth = GetProgramConfig_PermissionDate();

         $('#dtpStartCoverDate').datepicker("setDate", CheckStartCoverDate(new Date()));

         //window.alert($('#dtpStartCoverDate').val());
         SetEndCoverDate();

         //date_nextmonth = parseInt(date_nextmonth) + 1;

         //if (d.getDate() >= date_nextmonth) {
         //    $('#dtpStartCoverDate').datepicker("setDate", new Date(d.getFullYear(), d.getMonth() + 1, 1));

         //    SetEndCoverDate();

         //} else {
         //    $('#dtpStartCoverDate').datepicker("setDate", new Date(d.getFullYear(), d.getMonth(), 1));

         //    SetEndCoverDate();
         //}
     }

     //Set วันสิ้นสุดความคุ้มครอง
     const SetEndCoverDate = () => {

         var date = $('#dtpStartCoverDate').datepicker('getDate'),
             day = date.getDate(),
             month = date.getMonth(),
             year = date.getFullYear() + 1;

         $('#dtpEndCoverDeate').datepicker({ format: "dd/mm/yyyy", autoclose: true }).datepicker("setDate", new Date(year, month, day));

     }
    </script>
}