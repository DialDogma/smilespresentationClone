@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.0/css/select.bootstrap4.min.css">
    <link href="https://fonts.googleapis.com/css?family=Sarabun" rel="stylesheet" />
    <link rel="stylesheet" href="/Content/StylePortfolio.css" />
    <link rel="stylesheet" href="/Scripts/sweetalert/dist/sweetalert.css" />
    <title>Report</title>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div style="width:100%">
                <div class="sticky">
                    <div id="txtheader" style="font-weight:bold;white-space:nowrap"></div>
                    <div id="burger">&#9776;</div>
                    <nav>
                        <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active" id="nav-personalportfolio-tab" data-toggle="tab" href="#nav-personalportfolio"
                               role="tab" aria-controls="nav-personalportfolio" aria-selected="false">ผลงานส่วนตัว</a>
                            <a class="nav-item nav-link" id="nav-ranking-tab" data-toggle="tab" href="#nav-ranking"
                               role="tab" aria-controls="nav-ranking" aria-selected="false">Ranking ผลงานส่วนตัว</a>
                            <a class="nav-item nav-link" id="nav-area-tab" data-toggle="tab" href="#nav-area" role="tab"
                               aria-controls="nav-area" aria-selected="false">พื้นที่</a>
                            <a class="nav-item nav-link" id="nav-branch-tab" data-toggle="tab" href="#nav-branch" role="tab"
                               aria-controls="nav-branch" aria-selected="false">สาขา</a>
                            <a class="nav-item nav-link" id="nav-target-tab" data-toggle="tab" href="#nav-target" role="tab"
                               aria-controls="nav-target" aria-selected="false">เป้าการขาย</a>
                            <a class="nav-item nav-link" id="nav-signout"><i class="fa fa-power-off"></i></a>
                        </div>
                    </nav>
                </div>
                <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-personalportfolio" role="tabpanel" aria-labelledby="nav-personalportfolio-tab">
                        <!--profile-->
                        <div class="d-flex justify-content-sm-start mb-sm-4" style="border-style: none none solid none; border-color: #007BFF;">
                            <div class="d-inline-flex">
                                <div class="pl-sm-5 pt-0 pr-2 pb-2">
                                    <img src="https://cdn3.iconfinder.com/data/icons/business-round-flat-vol-1-1/36/user_account_profile_avatar_person_student_male-512.png" class="rounded-circle"
                                         alt="Image" style="width: 100px; height: auto" />
                                </div>
                                <div class="row">
                                    <div class="d-flex flex-column justify-content-center">
                                        <div class="p-2">
                                            <span style="font-size: 1.1em"><b>ID :</b></span>
                                            <span style="font-size: 1em"> @ViewBag.LoginDetail.UserName</span>
                                            <span style="font-size: 1em; text-overflow: ellipsis">@ViewBag.LoginDetail.FirstName @ViewBag.LoginDetail.LastName</span>
                                        </div>
                                        <div class="p-2">
                                            <span style="font-size: 1.1em"><b>ทีม :</b></span>
                                            <span style="font-size: 1em">@ViewBag.LoginDetail.EmployeeTeamDetail</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            เลือกผลิตภัณฑ์ :
                                        </span>
                                        <select class="form-control m-1" name="select-productgroup-personal" id="select-productgroup-personal"></select>
                                    </div>
                                </div>
                                <div class="col-12 offset-md-4 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">DCR : </span>
                                        <select class="form-control m-1" name="select-period-personal" id="select-period-personal"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="card border-primary">
                                <div class="card-header text-white" style="background-color: #007bff !important">
                                    <div class="d-flex flex-wrap justify-content-between">
                                        <div class="d-flex">
                                            ผลิตภัณฑ์ : <span id="header-text-tab1"></span>
                                        </div>
                                        <div class="d-flex">
                                            ข้อมูลล่าสุด :  @ViewBag.LastUpdate.ToString("dd-MM-yyyy HH:mm") น.
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="pills-newapp-tab" data-toggle="pill" href="#pills-newapp" role="tab"
                                               aria-controls="pills-newapp" aria-selected="true">
                                                NewApp
                                                <span id="badge-newapp" class="badge badge-pill badge-danger">0</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="pills-newapp-transfer-tab" data-toggle="pill" href="#pills-newapp-transfer" role="tab"
                                               aria-controls="pills-newapp-transfer" aria-selected="false">
                                                NewApp ยกยอดมา
                                                <span id="badge-newapp-transfer" class="badge badge-pill badge-danger">0</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="pills-newapp-noport-tab" data-toggle="pill" href="#pills-newapp-noport" role="tab"
                                               aria-controls="pills-newapp-noport" aria-selected="false">
                                                NewApp ไม่คิดผลงาน
                                                <span id="badge-newapp-noport" class="badge badge-pill badge-danger">0</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="pills-lapse-tab" data-toggle="pill" href="#pills-lapse" role="tab" aria-controls="pills-lapse"
                                               aria-selected="false">
                                                Lapse
                                                <span id="badge-lapse" class="badge badge-pill badge-danger">0</span>
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="tab-content p-0" id="pills-tabContent" style="border-top: unset !important">
                                        <div class="tab-pane fade show active" id="pills-newapp" role="tabpanel" aria-labelledby="pills-newapp-tab">
                                            <!--TABLE NEWAPP-->
                                            <table id="table-newapp" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                            <!--END-->
                                        </div>
                                        <div class="tab-pane fade" id="pills-newapp-transfer" role="tabpanel" aria-labelledby="pills-newapp-transfer-tab">
                                            <!--TABLE TRANSFER-->
                                            <table id="table-transfer" class="table table-striped table-bordered  nowrap" style="width:100%"></table>
                                            <!--END-->
                                        </div>
                                        <div class="tab-pane fade" id="pills-newapp-noport" role="tabpanel" aria-labelledby="pills-newapp-noport-tab">
                                            <!--TABLE NO PORT-->
                                            <table id="table-noport" class="table table-striped table-bordered  nowrap" style="width:100%"></table>
                                            <!--END-->
                                        </div>
                                        <div class="tab-pane fade" id="pills-lapse" role="tabpanel" aria-labelledby="pills-lapse-tab">
                                            <!--TABLE 3-->
                                            <table id="table-lapse" class="table table-striped table-bordered  nowrap" style="width:100%"></table>
                                            <!--END-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-ranking" role="tabpanel" aria-labelledby="nav-ranking-tab">
                        <!--Ranking-->
                        <div class="d-flex flex-wrap justify-content-between mb-4" style="border-style: none none solid none; border-color: #007BFF;">
                            <div class="d-inline-flex pl-sm-5 pt-0 pr-0 pb-2">
                                <span style="font-size: 1.7em">ลำดับผลงานยอดเยี่ยม</span>
                            </div>
                            <div class="d-inline-flex  pl-sm-5 pt-0 pr-5 pb-2">
                                <span style="font-size: 1.7em">ลำดับของคุณคือ <span id="RankNo"></span></span>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            เลือกผลิตภัณฑ์ :
                                        </span>
                                        <select class="form-control m-1" name="select-productgroup-ranking" id="select-productgroup-ranking"></select>
                                    </div>
                                </div>
                                <div class="col-12 offset-md-4 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">DCR : </span>
                                        <select class="form-control m-1" name="select-period-ranking" id="select-period-ranking"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="card border-primary">
                                <div class="card-header text-white" style="background-color: #007bff !important">
                                    <div class="d-flex flex-wrap justify-content-between">
                                        <div class="d-flex">
                                            ผลิตภัณฑ์ : <span id="header-text-tab2"></span>
                                        </div>
                                        <div class="d-flex">
                                            ข้อมูลล่าสุด : @ViewBag.LastUpdate.ToString("dd-MM-yyyy HH:mm") น.
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!--TABLE RANKING-->
                                    <table id="table-ranking" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    <!--END-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-area" role="tabpanel" aria-labelledby="nav-area-tab">
                        <!--Area-->
                        <div class="d-flex flex-wrap  justify-content-between mb-4" style="border-style: none none solid none; border-color: #007BFF;">
                            <div class="d-inline-flex  pl-sm-5 pt-0 pr-0 pb-2">
                                <span style="font-size: 1.7em">ประกันสุขภาพ</span>
                            </div>
                            <div class="d-inline-flex  pl-sm-0 pt-0 pr-5 pb-2">
                                <span style="font-size: 1.7em">ลำดับของคุณคือ <span id="RankNo-Area"></span></span>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            เลือกข้อมูล :
                                        </span>
                                        <select class="form-control m-1" name="select-gradetype-area" id="select-gradetype-area"></select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">DCR : </span>
                                        <select class="form-control m-1" name="select-period-area" id="select-period-area"></select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">พื้นที่ : </span>
                                        <select class="form-control m-1" name="select-period-area" id="select-area"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="card border-primary">
                                <div class="card-header text-white" style="background-color: #007bff !important">
                                    <div class="d-flex flex-wrap justify-content-between">
                                        <div class="d-flex">
                                            ผลิตภัณฑ์ :   <span id="header-text-tab3"></span>
                                        </div>
                                        <div class="d-flex">
                                            ข้อมูลล่าสุด : @ViewBag.LastUpdate.ToString("dd-MM-yyyy HH:mm") น.
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!--TABLE AREA-->
                                    <div id="d2" style="display: none">
                                        <table id="table-area-lapse" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="d3" style="display: none">
                                        <table id="table-area-psg" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="d4" style="display: none">
                                        <table id="table-area-pog" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="d5" style="display: none">
                                        <table id="table-area-newapp" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="d6" style="display: none">
                                        <table id="table-area-udw" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <!--END-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-branch" role="tabpanel" aria-labelledby="nav-branch-tab">
                        <!--branch-->
                        <div class="d-flex flex-wrap  justify-content-between mb-4" style="border-style: none none solid none; border-color: #007BFF;">
                            <div class="d-inline-flex  pl-sm-5 pt-0 pr-0 pb-2">
                                <span style="font-size: 1.7em">ประกันสุขภาพ</span>
                            </div>
                            <div class="d-inline-flex  pl-sm-0 pt-0 pr-5 pb-2">
                                <span id="sp-RankBranch" style="font-size: 1.7em !important">ลำดับของคุณคือ <span id="RankNo-Branch"></span></span>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            เลือกข้อมูล :
                                        </span>
                                        <select class="form-control m-1" name="select-gradetype-branch" id="select-gradetype-branch"></select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">DCR : </span>
                                        <select class="form-control m-1" name="select-period-branch" id="select-period-branch"></select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <div id="div-branch-fm" class="d-inline-flex col-12">
                                            <table style="width: 100%">
                                                <thead style="border-bottom: solid 1px;">
                                                    <tr>
                                                        <th style="text-align: center">ข้อมูล</th>
                                                        <th style="text-align: center">จำนวน</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center">เป้า FM</td>
                                                        <td style="text-align: center"><span id="FM"></span></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align: center">เป้า FO</td>
                                                        <td style="text-align: center"><span id="FO"></span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="div-branch-title" class="d-inline-flex  col-12">
                                            <table style="width: 100%">
                                                <thead style="border-bottom: solid 1px;">
                                                    <tr>
                                                        <th colspan="2">ผู้รับผิดชอบเป้าสาขา : @ViewBag.LoginDetail.BranchDetail</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>ผู้อำนวยการสาขา</td>
                                                        <td><span id="DBName"></span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>ผู้ที่ได้รับมอบหมาย </td>
                                                        <td><span id="MMName"></span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="card border-primary">
                                <div class="card-header text-white" style="background-color: #007bff !important">
                                    <div class="d-flex flex-wrap justify-content-between">
                                        <div class="d-flex">
                                            <span id="header-text-tab4">
                                            </span>
                                        </div>
                                        <div class="d-flex">
                                            ข้อมูลล่าสุด : @ViewBag.LastUpdate.ToString("dd-MM-yyyy HH:mm") น.
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!--card body-->
                                    <div id="div-graph" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <canvas id="myChart" style="max-width: 700px; height: auto;"></canvas>
                                        </div>
                                        <div class="d-flex justify-content-center">
                                            <canvas id="myChart2" style="max-width: 700px; height: auto;"></canvas>
                                        </div>
                                    </div>
                                    <div id="div-lapse" style="display:none">
                                        <table id="table-branch-lapse" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="div-psg" style="display:none">
                                        <table id="table-branch-psg" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="div-pog" style="display:none">
                                        <table id="table-branch-pog" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                    <div id="div-udw" style="display:none">
                                        <table id="table-branch-udw" class="table table-striped table-bordered nowrap" style="width:100%"></table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-target" role="tabpanel" aria-labelledby="nav-target-tab">
                        <!--target-->
                        <div class="d-flex flex-wrap  justify-content-between mb-4" style="border-style: none none solid none; border-color: #007BFF;">
                            <div class="d-inline-flex  pl-sm-5 pt-0 pr-0 pb-2">
                                <span style="font-size: 1.7em">เป้าการขาย</span>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span for="select-period-target" class="pt-2" style="font-weight: bold">DCR : </span>
                                        <select class="form-control m-1" name="select-period-target" id="select-period-target"></select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            มุมมองเป้าของ :
                                        </span>
                                        <select class="form-control m-1" name="select-viewtype-target" id="select-viewtype-target">
                                            <option value="1">ส่วนตัว</option>
                                            <option value="2">สาขา</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <div class="form-group" style="margin-bottom:0px;width:100%">
                                        <span class="pt-2" style="font-weight: bold">
                                            เลือกข้อมูล :
                                        </span>
                                        <select class="form-control m-1" name="select-productgroup-target" id="select-productgroup-target"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 px-sm-5">
                            <div class="card border-primary">
                                <div class="card-header text-white" style="background-color: #007bff !important">
                                    <div class="d-flex flex-wrap justify-content-between">
                                        <div class="d-flex">
                                            <span id="header-text-tab5">
                                            </span>
                                        </div>
                                        <div class="d-flex">
                                            ข้อมูลล่าสุด : @ViewBag.LastUpdate.ToString("dd-MM-yyyy HH:mm") น.
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!--card body-->
                                    <div id="div-graph-target" style="display:none">
                                        <div class="d-flex justify-content-center">
                                            <canvas id="myChartTarget" style="max-width: 700px; height: auto;"></canvas>
                                        </div>
                                        <div class="d-flex justify-content-center">
                                            <canvas id="myChartTarget2" style="max-width: 700px; height: auto;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loading">
        <div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
    </div>
</body>
</html>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

<!-- data table -->
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js"></script>

<!--ChartJs-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<!--other-->
<script src="/Scripts/moment/moment.min.js"></script>
<script src="/Scripts/sweetalert/dist/sweetalert.min.js"></script>
<script src="/Scripts/myScript.js"></script>
<script src="/Scripts/stickyfill.min.js"></script>

<script>
    $(document).ready(function () {
        var txt = $('a.active').prop('text');
        $('#txtheader').text(txt);

        $('a.nav-item').click(function () {
            txt = $(this).text();
            if (txt != "") $('#txtheader').text(txt);

            $('#nav-tab').toggleClass("hidden");
        }
        );

        $("#burger").click(function () {
            $("#nav-tab").toggleClass("hidden");
        });

        loadingSpinner('fadeIn', 500);
        var tableName = 'table-newapp';
        var typeId = 1; //typeId 1 = NewApp
        /************LOAD**************/
        $.when(getProductGroup(2, 'select-productgroup-personal'), getPeriod('select-period-personal')).then(
            function (d) {
                //ASSIGN VALUES TO VARIABLES
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });

        $('#nav-signout').on('click',
            function (e) {
                swal_confirm("ออกจากระบบ",
                    "คุณต้องการออกจากระบบหรือไม่?",
                    function (e) {
                        window.location.href = '@Url.Action("Logout", "Auth")';
                    });
            });
        /*****************************/

        /************EVENT**************/
        $('#select-productgroup-personal').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName');
                loadDatatables(period, productgroup, 1, typeId, tableName);
                $('#header-text-tab1').text($('option:selected', this).text());
            });

        $('#select-period-personal').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName');
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });
        $('#select-productgroup-ranking').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-ranking').val();
                const productgroup = $('#select-productgroup-ranking').val();
                getStartPageRanking(period, productgroup, '@ViewBag.LoginDetail.UserName', tableName);
                $('#header-text-tab2').text($('option:selected', this).text());
            });

        $('#select-period-ranking').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-ranking').val();
                const productgroup = $('#select-productgroup-ranking').val();
                getStartPageRanking(period, productgroup, '@ViewBag.LoginDetail.UserName', tableName);
            });
        $('#select-gradetype-area').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-area').val();
                const gradetypeId = $('#select-gradetype-area').val();
                const areaCode = $('#select-area').val();
                const productgroup = "1000"; //PH
                getStartPageArea(period, productgroup, areaCode, gradetypeId, 4, tableName);
                $('#header-text-tab3').text($('option:selected', this).text());
            });

        $('#select-period-area').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-area').val();
                const gradetypeId = $('#select-gradetype-area').val();
                const areaCode = $('#select-area').val();
                const productgroup = "1000"; //PH
                getStartPageArea(period, productgroup, areaCode, gradetypeId, 4, tableName);
            });
        $('#select-area').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-area').val();
                const gradetypeId = $('#select-gradetype-area').val();
                const areaCode = $('#select-area').val();
                const productgroup = "1000"; //PH
                getStartPageArea(period, productgroup, areaCode, gradetypeId, 4, tableName);
            });
        $('#select-gradetype-branch').on('change',
           function (e) {
               e.preventDefault();
               const period = $('#select-period-branch').val();
               const gradetype = $('#select-gradetype-branch').val();
               const productgroup = "1000"; //PH
               getBranchGraphTitle();
               getBranchGraphFM();
               $('#header-text-tab4').text($('#select-gradetype-branch option:selected').text());

               switch (Number(gradetype)) {
                   case 2: //Lapse
                       $('#div-graph').hide();
                       $('#div-lapse').show();
                       $('#div-psg').hide();
                       $('#div-pog').hide();
                       $('#div-udw').hide();
                       $('#div-branch-fm').attr("style", "display: none !important;");
                       $('#sp-RankBranch').show();
                       getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                       // code block
                       break;
                   case 3: //PSG
                       $('#div-graph').hide();
                       $('#div-lapse').hide();
                       $('#div-psg').show();
                       $('#div-pog').hide();
                       $('#div-udw').hide();
                       $('#div-branch-fm').attr("style", "display: none !important;");
                       $('#sp-RankBranch').show();
                       getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                       // code block
                       break;
                   case 4: //POG
                       $('#div-graph').hide();
                       $('#div-lapse').hide();
                       $('#div-psg').hide();
                       $('#div-pog').show();
                       $('#div-udw').hide();
                       $('#div-branch-fm').attr("style", "display: none !important;");
                       $('#sp-RankBranch').show();
                       getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                       // code block
                       break;
                   case 5: //NewApp
                       $('#div-graph').show();
                       $('#div-lapse').hide();
                       $('#div-psg').hide();
                       $('#div-pog').hide();
                       $('#div-udw').hide();
                       $('#div-branch-fm').attr("style", "display: block !important;");
                       $('#sp-RankBranch').hide();
                       drawGraph();
                       getBranchGraph(barChartData1);
                       getBranchGraph2(barChartData2);
                       break;
                   case 6: //Udw
                       $('#div-graph').hide();
                       $('#div-lapse').hide();
                       $('#div-psg').hide();
                       $('#div-pog').hide();
                       $('#div-udw').show();
                       $('#div-branch-fm').attr("style", "display: none !important;");
                       $('#sp-RankBranch').show();
                       getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                       // code block
                       break;
                   default:
                       // code block
               }
           });

        $('#select-period-branch').on('change',
            function (e) {
                e.preventDefault();
                const period = $('#select-period-branch').val();
                const gradetype = $('#select-gradetype-branch').val();
                const productgroup = "1000"; //PH
                getBranchGraphTitle();
                getBranchGraphFM();
                $('#header-text-tab4').text($('#select-gradetype-branch option:selected').text());

                switch (Number(gradetype)) {
                    case 2: //Lapse
                        $('#div-graph').hide();
                        $('#div-lapse').show();
                        $('#div-psg').hide();
                        $('#div-pog').hide();
                        $('#div-udw').hide();
                        $('#div-branch-fm').attr("style", "display: none !important;");
                        $('#sp-RankBranch').show();
                        getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                        // code block
                        break;
                    case 3: //PSG
                        $('#div-graph').hide();
                        $('#div-lapse').hide();
                        $('#div-psg').show();
                        $('#div-pog').hide();
                        $('#div-udw').hide();
                        $('#div-branch-fm').attr("style", "display: none !important;");
                        $('#sp-RankBranch').show();
                        getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                        // code block
                        break;
                    case 4: //POG
                        $('#div-graph').hide();
                        $('#div-lapse').hide();
                        $('#div-psg').hide();
                        $('#div-pog').show();
                        $('#div-udw').hide();
                        $('#div-branch-fm').attr("style", "display: none !important;");
                        $('#sp-RankBranch').show();
                        getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                        // code block
                        break;
                    case 5: //NewApp
                        $('#div-graph').show();
                        $('#div-lapse').hide();
                        $('#div-psg').hide();
                        $('#div-pog').hide();
                        $('#div-udw').hide();
                        $('#div-branch-fm').attr("style", "display: block !important;");
                        $('#sp-RankBranch').hide();
                        drawGraph();
                        getBranchGraph(barChartData1);
                        getBranchGraph2(barChartData2);
                        break;
                    case 6: //Udw
                        $('#div-graph').hide();
                        $('#div-lapse').hide();
                        $('#div-psg').hide();
                        $('#div-pog').hide();
                        $('#div-udw').show();
                        $('#div-branch-fm').attr("style", "display: none !important;");
                        $('#sp-RankBranch').show();
                        getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                        // code block
                        break;
                    default:
                        // code block
                }
            });

        $('#select-period-target,#select-viewtype-target,#select-productgroup-target').on('change',
        function (e) {
            e.preventDefault();
            loadingSpinner('fadeIn', 500);
            var str = "";
            switch ($('#select-viewtype-target').val()) {
                case "1":
                    str = $('#select-productgroup-target option:selected').text();
                    break;

                case "2":
                    str = $('#select-productgroup-target option:selected').text() + " - สาขา: @ViewBag.LoginDetail.BranchDetail";
                    break;
                default:
            }

            $('#header-text-tab5').text(str);
            $('#div-graph-target').show();
            drawGraphTarget();
            getAppGraphTarget(barChartData1);
            getAppGraphTarget2(barChartData2);
        });

        //MAIN TAB
        $('#nav-personalportfolio-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                loadingSpinner('fadeIn', 500);
                tableName = 'table-newapp';
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });
        //RANKING TAB
        $('#nav-ranking-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                loadingSpinner('fadeIn', 500);
                $.when(getProductGroup(3, 'select-productgroup-ranking'), getPeriod('select-period-ranking')).then(
                    function (d) {
                        tableName = 'table-ranking';
                        const period = $('#select-period-ranking').val();
                        const productgroup = $('#select-productgroup-ranking').val();
                        $('#header-text-tab2').text($('#select-productgroup-ranking option:selected').text());
                        getStartPageRanking(period, productgroup, '@ViewBag.LoginDetail.UserName', tableName);
                    });
            });
        //AREA TAB
        $('#nav-area-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                loadingSpinner('fadeIn', 500);
                $.when(getProductGroup(4, 'select-gradetype-area'),
                    getPeriod('select-period-area'),
                    getArea('select-area')).then(function (d) {
                        tableName = 'table-area';
                        const period = $('#select-period-area').val();
                        const gradetypeId = $('#select-gradetype-area').val();
                        const areaCode = $('#select-area').val();
                        const productgroup = "1000"; //PH
                        $('#header-text-tab3').text($('#select-gradetype-area option:selected').text());
                        getStartPageArea(period, productgroup, areaCode, gradetypeId, 4, tableName);
                    });
            });
        //BRANCH TAB
        $('#nav-branch-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                loadingSpinner('fadeIn', 500);
                $.when(getProductGroup(5, 'select-gradetype-branch'), getPeriod('select-period-branch')).then(
                    function (d) {
                        const period = $('#select-period-branch').val();
                        const gradetype = $('#select-gradetype-branch').val();
                        const productgroup = "1000"; //PH
                        $('#header-text-tab4').text($('#select-gradetype-branch option:selected').text());
                        getBranchGraphTitle();
                        getBranchGraphFM();

                        switch (Number(gradetype)) {
                            case 2: //Lapse
                                $('#div-graph').hide();
                                $('#div-lapse').show();
                                $('#div-psg').hide();
                                $('#div-pog').hide();
                                $('#div-udw').hide();
                                $('#div-branch-fm').attr("style", "display: none !important;");
                                $('#sp-RankBranch').show();
                                getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                                // code block
                                break;
                            case 3: //PSG
                                $('#div-graph').hide();
                                $('#div-lapse').hide();
                                $('#div-psg').show();
                                $('#div-pog').hide();
                                $('#div-udw').hide();
                                $('#div-branch-fm').attr("style", "display: none !important;");
                                $('#sp-RankBranch').show();
                                getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                                // code block
                                break;
                            case 4: //POG
                                $('#div-graph').hide();
                                $('#div-lapse').hide();
                                $('#div-psg').hide();
                                $('#div-pog').show();
                                $('#div-udw').hide();
                                $('#div-branch-fm').attr("style", "display: none !important;");
                                $('#sp-RankBranch').show();
                                getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                                // code block
                                break;
                            case 5: //NewApp
                                $('#div-graph').show();
                                $('#div-lapse').hide();
                                $('#div-psg').hide();
                                $('#div-pog').hide();
                                $('#div-udw').hide();
                                $('#div-branch-fm').attr("style", "display: block !important;");
                                $('#sp-RankBranch').hide();
                                drawGraph();
                                getBranchGraph(barChartData1);
                                getBranchGraph2(barChartData2);
                                break;
                            case 6: //Udw
                                $('#div-graph').hide();
                                $('#div-lapse').hide();
                                $('#div-psg').hide();
                                $('#div-pog').hide();
                                $('#div-udw').show();
                                $('#div-branch-fm').attr("style", "display: none !important;");
                                $('#sp-RankBranch').show();
                                getStartPageBranch(period, productgroup, '@ViewBag.BranchCode', gradetype, 3);
                                // code block
                                break;
                            default:
                                // code block
                        }
                    });
            });

        //TARGET TAB
        $('#nav-target-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                loadingSpinner('fadeIn', 500);
                $.when(getProductGroup(6, 'select-productgroup-target'), getPeriod('select-period-target')).then(
                    function (d) {
                        $('#header-text-tab5').text($('#select-productgroup-target option:selected').text());
                        $('#div-graph-target').show();
                        drawGraphTarget();
                        getAppGraphTarget(barChartData1);
                        getAppGraphTarget2(barChartData2);
                    });
            });

        //SUB TAB
        $('#pills-newapp-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                tableName = 'table-newapp';
                typeId = 1;
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });

        $('#pills-newapp-transfer-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                tableName = 'table-transfer';
                typeId = 3;
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });

        $('#pills-newapp-noport-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                tableName = 'table-noport';
                typeId = 4;
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });

        $('#pills-lapse-tab').on('shown.bs.tab',
            function (e) {
                e.preventDefault();
                tableName = 'table-lapse';
                typeId = 2;
                const period = $('#select-period-personal').val();
                const productgroup = $('#select-productgroup-personal').val();
                getAppDetailCount(period, productgroup, 1, '@ViewBag.LoginDetail.UserName'); //TEST USER ID
                loadDatatables(period, productgroup, 1, typeId, tableName);
            });
        /************END EVENT**************/
    });

    /*********************FUNCTION******************/
    const getProductGroup = (type, element) => {
        var deferred = $.get('@Url.Action("GetProductGroupList")',
            { typeId: type },
             function (response) {
                 if (response != null) {
                     $(`#${element}`).empty();
                     for (let i = 0; i < response.length; i++) {
                         $(`#${element}`)
                             .append(`<option value="${response[i].ValueCode}">${response[i].ValueString}</option>`);
                     }
                     //SET HEADER
                     $('#header-text-tab1').text($(`#${element} option:selected`).text());
                 }
             });
        return deferred;
    }

    const getPeriod = (element) => {
        var deferred = $.get('@Url.Action("GetPeriodList")',
            function (response) {
                if (response != null) {
                    $(`#${element}`).empty();
                    for (let i = 0; i < response.length; i++) {
                        $(`#${element}`)
                            .append(`<option value="${moment(response[i].Period).format('YYYY-MM-DD')}">${response[i].PeriodString}</option>`);
                    }
                }
            });
        return deferred;
    }

    const getArea = (element) => {
        var deferred = $.get('@Url.Action("GetAreaList")',
            function (response) {
                if (response != null) {
                    $(`#${element}`).empty();
                    for (let i = 0; i < response.length; i++) {
                        $(`#${element}`)
                            .append(`<option value="${response[i].StudyAreaCode}">${response[i].StudyArea}</option>`);
                    }
                }
            });
        return deferred;
    }

    const getBranchGraphTitle = () => {
        var deferred = $.get('@Url.Action("GetBranchGraph_Title")',
                 {
                     branchCode: '@ViewBag.BranchCode',
                     period: $('#select-period-branch').val()
                 },
             function (response) {
                 if (response != null) {
                     $('#DBName').text(response.DBName);
                     $('#MMName').text(response.MMName);
                 }
             });
        return deferred;
    }

    const getBranchGraphFM = () => {
        var deferred = $.get('@Url.Action("GetBranchGraph_FM")',
            {
                branchCode: '@ViewBag.BranchCode',
                period: $('#select-period-branch').val()
            },
            function (response) {
                if (response != null) {
                    $('#FM').text(response.FM);
                    $('#FO').text(response.FO);
                }
            });
        return deferred;
    }

    const getAppDetailCount = (period, productGroupCode, refTypeId, refCode) => {
        var deferred = $.Deferred();
        $.get('@Url.Action("GetAppDetailCount")', {
            period: period,
            productGroupCode: productGroupCode,
            referanceTypeId: refTypeId,
            referanceCode: refCode
        }).done(function (response) {
            if (response.length > 0) {
                $('#badge-newapp').text(response[0].NewApp);
                $('#badge-newapp-transfer').text(response[0].NewAppTransfer);
                $('#badge-newapp-noport').text(response[0].NewAppNoPort);
                $('#badge-lapse').text(response[0].Lapse);

            } else {
                $('#badge-newapp').text("0");
                $('#badge-newapp-transfer').text("0");
                $('#badge-newapp-noport').text("0");
                $('#badge-lapse').text("0");
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    const loadDatatables = (period, productGroupCode, refType, type, tableName) => {
        var deferred = $.Deferred();
        var columns = [];
        switch (type) {
            case 1:
                columns = [
               {
                   title: 'AppID',
                   data: 'AppCode',
                   orderable: false,
                   className: 'h-dt-center'

               },
               {
                   title: 'แผน',
                   data: 'Product',
                   orderable: true,
                   className: 'h-dt-center'
               },
               {
                   title: 'ผู้เอาประกัน',
                   data: 'CustName',
                   orderable: true,
                   className: 'h-dt-center'
               },
               {
                   title: 'สถานะคัดกรอง',
                   data: 'UdwStatus',
                   orderable: true,
                   className: 'h-dt-center d-dt-center'
               },
               {
                   title: 'สถานะของ App',
                   data: 'Status',
                   orderable: true,
                   className: 'h-dt-center d-dt-center'
               }
                ];
                break;
            case 2:
                columns = [
                    {
                        title: 'AppID',
                        data: 'AppCode',
                        orderable: false,
                        className: 'h-dt-center'

                    },
                    {
                        title: 'วันที่เริ่มคุ้มครอง',
                        data: 'StartCoverDate',
                        orderable: false,
                        className: 'h-dt-center',
                        render: (data) => {
                            return moment(data).format('DD/MM/YYYY');
                        }

                    },
                    {
                        title: 'แผน',
                        data: 'Product',
                        orderable: true,
                        className: 'h-dt-center'
                    },
                    {
                        title: 'ผู้เอาประกัน',
                        data: 'CustName',
                        orderable: true,
                        className: 'h-dt-center'
                    },
                    {
                        title: 'สาเหตุ',
                        data: 'CancelCause',
                        orderable: true,
                        className: 'h-dt-center d-dt-center'
                    }
                ];
                break;
            case 3:
            case 4:
                columns = [
                    {
                        title: 'AppID',
                        data: 'AppCode',
                        orderable: false,
                        className: 'h-dt-center'

                    },
                    {
                        title: 'แผน',
                        data: 'Product',
                        orderable: true,
                        className: 'h-dt-center'
                    },
                    {
                        title: 'ผู้เอาประกัน',
                        data: 'CustName',
                        orderable: true,
                        className: 'h-dt-center'
                    },
                    {
                        title: 'สถานะคัดกรอง',
                        data: 'UdwStatus',
                        orderable: true,
                        className: 'h-dt-center d-dt-center'
                    }
                ];
                break;
            default:
                break;
        }

        $(`#${tableName}`).empty();
        const table = $(`#${tableName}`).DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.AppCode;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: true,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: true,
            ajax: {
                url: '@Url.Action("GetAppDetail")',
                method: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.sortField = d.columns[d.order[0].column].data;
                    d.orderType = d.order[0].dir;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceTypeId = refType;
                    d.referanceCode = '@ViewBag.LoginDetail.UserName';
                    d.typeId = type;
                }
            },
            // ReSharper disable once IdentifierTypo
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //PAGE RANKING
    const getStartPageRanking = (period, productGroupCode, refCode, tableName) => {
        $.get('@Url.Action("GetRankNewAppSalePage")',
            {
                period: period,
                productGroupCode: productGroupCode,
                referanceCode: refCode,
                indexStart: 0,
                pageSize: 10
            }).done((response) => {
                if (response.length > 0) {
                    $('#RankNo').text(response[0].RankNo);
                    loadDatatablesRanking(period, productGroupCode, tableName, refCode, response[0].PageNo);
                } else {
                    $('#RankNo').text("-");
                    loadDatatablesRanking(period, productGroupCode, tableName, refCode, 0);
                }
            });
    }

    //RANKING
    const loadDatatablesRanking = (period, productGroupCode, tableName, refCode, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
            {
                title: 'Rank',
                data: 'RankNo',
                orderable: false,
                className: 'h-dt-center d-dt-center'

            },
            {
                title: 'รหัสพนักงาน',
                data: 'ReferenceCode',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            },
            {
                title: 'ชื่อ - สกุล',
                data: 'ReferenceName',
                orderable: true,
                className: 'h-dt-center'
            },
            {
                title: 'ตำแหน่ง',
                data: 'Position',
                orderable: true,
                className: 'h-dt-center'
            },
            {
                title: 'ทีม',
                data: 'Team',
                orderable: true,
                className: 'h-dt-center'
            },
            {
                title: 'สาขา',
                data: 'Branch',
                orderable: true,
                className: 'h-dt-center'
            },
            {
                title: 'NewApp',
                data: 'Value',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }
        ];

        $(`#${tableName}`).empty();
        const table = $(`#${tableName}`).DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceCode;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankNewAppSale")',
                method: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //PAGE AREA
    const getStartPageArea = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId, tableName) => {
        $.get('@Url.Action("GetRankPayerStudyAreaPage")',
            {
                period: period,
                productGroupCode: productGroupCode,
                referanceCode: refCode,
                gradeTypeId: gradeTypeId,
                referanceTypeId: referanceTypeId,
                indexStart: 0,
                pageSize: 10
            }).done((response) => {
                if (response.length > 0) {
                    $('#RankNo-Area').text(response[0].RankNo);
                    switch (gradeTypeId) {
                        case "2":
                            loadDatatablesArea_Lapse(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "3":
                            loadDatatablesArea_PSG(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "4":
                            loadDatatablesArea_POG(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "5":
                            loadDatatablesArea_NewApp(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "6":
                            loadDatatablesArea_UDW(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        default:
                            break;
                    }
                } else {
                    $('#RankNo-Area').text("-");
                    switch (gradeTypeId) {
                        case "2":
                            loadDatatablesArea_Lapse(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "3":
                            loadDatatablesArea_PSG(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "4":
                            loadDatatablesArea_POG(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "5":
                            loadDatatablesArea_NewApp(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "6":
                            loadDatatablesArea_UDW(period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        default:
                            break;
                    }
                }
            });
    }

    //Area Lapse
    const loadDatatablesArea_Lapse = (period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                      {
                          title: 'ลำดับ',
                          data: 'RankNo',
                          orderable: false,
                          className: 'h-dt-center d-dt-center'

                      },
                      {
                          title: 'พื้นที่',
                          data: 'ReferenceDetail',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      },
                      {
                          title: 'ผู้อำนวยการพื้นที่',
                          data: 'PersonName',
                          orderable: true,
                          className: 'h-dt-center'
                      },
                      {
                          title: 'BalancePH',
                          data: 'BalancePH',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'Lapse โดยลูกค้า',
                          data: 'LapseCust',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'Lapse จัดเก็บ',
                          data: 'LapseStudyArea',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'รวม',
                          data: 'LapseAll',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: '% Lapse',
                          data: 'Value',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'LG',
                          data: 'ValueString',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      }
        ];
        $('#table-area-lapse').empty();
        const table = $('#table-area-lapse').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerStudyArea")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            },
            drawCallback: function (d) {
                $('#d2').css('display', 'block');
                $('#d3').css('display', 'none');
                $('#d4').css('display', 'none');
                $('#d5').css('display', 'none');
                $('#d6').css('display', 'none');
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //Area PSG
    const loadDatatablesArea_PSG = (period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
            {
                title: 'ลำดับ',
                data: 'RankNo',
                orderable: false,
                className: 'h-dt-center d-dt-center'

            },
            {
                title: 'พื้นที่',
                data: 'ReferenceDetail',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            },
            {
                title: 'ผู้อำนวยการพื้นที่',
                data: 'PersonName',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            },
            {
                title: 'Balance',
                data: 'BalanceReceive',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            },
            {
                title: 'หักไม่ได้',
                data: 'UnReceive',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            },
            {
                title: 'หักได้',
                data: 'Receive',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            },
            {
                title: '%หักได้',
                data: 'Value',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            },
            {
                title: 'เกรด',
                data: 'ValueString',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            }
        ];

        $('#table-area-psg').empty();
        const table = $('#table-area-psg').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerStudyArea")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            },
            drawCallback: function (d) {
                $('#d2').css('display', 'none');
                $('#d3').css('display', 'block');
                $('#d4').css('display', 'none');
                $('#d5').css('display', 'none');
                $('#d6').css('display', 'none');
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //Area POG
    const loadDatatablesArea_POG = (period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
            {
                title: 'ลำดับ',
                data: 'RankNo',
                orderable: false,
                className: 'h-dt-center d-dt-center'

            },
            {
                title: 'พื้นที่',
                data: 'ReferenceDetail',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            },
            {
                title: 'ผู้อำนวยการพื้นที่',
                data: 'PersonName',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            }
        ];

        $('#table-area-pog').empty();
        const table = $('#table-area-pog').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerStudyArea")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            },
            drawCallback: function (d) {
                $('#d2').css('display', 'none');
                $('#d3').css('display', 'none');
                $('#d4').css('display', 'block');
                $('#d5').css('display', 'none');
                $('#d6').css('display', 'none');
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //AREA NEWAPP
    const loadDatatablesArea_NewApp = (period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                    {
                        title: 'ลำดับ',
                        data: 'RankNo',
                        orderable: false,
                        className: 'h-dt-center d-dt-center'

                    },
                    {
                        title: 'พื้นที่',
                        data: 'ReferenceDetail',
                        orderable: true,
                        className: 'h-dt-center d-dt-center'
                    },
                    {
                        title: 'ผู้อำนวยการพื้นที่',
                        data: 'PersonName',
                        orderable: true,
                        className: 'h-dt-center'
                    },
                    {
                        title: 'NewApp',
                        data: 'Value',
                        orderable: true,
                        className: 'h-dt-center d-dt-right'
                    }
        ];

        $('#table-area-newapp').empty();
        const table = $('#table-area-newapp').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerStudyArea")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            },
            drawCallback: function (d) {
                $('#d2').css('display', 'none');
                $('#d3').css('display', 'none');
                $('#d4').css('display', 'none');
                $('#d5').css('display', 'block');
                $('#d6').css('display', 'none');
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //AREA Underwrite
    const loadDatatablesArea_UDW = (period, productGroupCode, tableName, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
            {
                title: 'ลำดับ',
                data: 'RankNo',
                orderable: false,
                className: 'h-dt-center d-dt-center'

            },
            {
                title: 'พื้นที่',
                data: 'ReferenceDetail',
                orderable: true,
                className: 'h-dt-center d-dt-center'
            },
            {
                title: 'ผู้อำนวยการพื้นที่',
                data: 'PersonName',
                orderable: true,
                className: 'h-dt-center'
            },
            {
                title: 'NewApp',
                data: 'UdwAll',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }, {
                title: 'คัดกรองผ่าน',
                data: 'UdwPass',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }, {
                title: 'คัดกรองไม่ผ่าน',
                data: 'UdwUnPass',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }, {
                title: 'ระหว่างตรวจสอบ',
                data: 'UdwWait',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }, {
                title: '%คัดกรองไม่ผ่าน',
                data: 'Value',
                orderable: true,
                className: 'h-dt-center d-dt-right'
            }
        ];

        $('#table-area-udw').empty();
        const table = $('#table-area-udw').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerStudyArea")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            },
            drawCallback: function (d) {
                $('#d2').css('display', 'none');
                $('#d3').css('display', 'none');
                $('#d4').css('display', 'none');
                $('#d5').css('display', 'none');
                $('#d6').css('display', 'block');
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //PAGE BRANCE
    const getStartPageBranch = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId) => {
        $.get('@Url.Action("GetRankPayerBranchPage")',
            {
                period: period,
                productGroupCode: productGroupCode,
                referanceCode: refCode,
                gradeTypeId: gradeTypeId,
                referanceTypeId: referanceTypeId,
                indexStart: 0,
                pageSize: 10
            }).done((response) => {
                if (response.length > 0) {
                    $('#RankNo-Branch').text(response[0].RankNo);
                    switch (gradeTypeId) {
                        case "2":
                            loadDatatablesBranch_Lapse(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "3":
                            loadDatatablesBranch_PSG(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "4":
                            loadDatatablesBranch_POG(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "5":
                            //loadDatatablesBranch_NewApp(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        case "6":
                            loadDatatablesBranch_UDW(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, response[0].PageNo);
                            break;
                        default:
                            break;
                    }
                } else {
                    $('#RankNo-Branch').text("-");
                    switch (gradeTypeId) {
                        case "2":
                            loadDatatablesBranch_Lapse(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "3":
                            loadDatatablesBranch_PSG(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "4":
                            loadDatatablesBranch_POG(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "5":
                            //loadDatatablesBranch_NewApp(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        case "6":
                            loadDatatablesBranch_UDW(period, productGroupCode, refCode, gradeTypeId, referanceTypeId, 0);
                            break;
                        default:
                            break;
                    }
                }
            });
    }

    //Branch Lapse
    const loadDatatablesBranch_Lapse = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                      {
                          title: 'ลำดับ',
                          data: 'RankNo',
                          orderable: false,
                          className: 'h-dt-center d-dt-center'

                      },
                      {
                          title: 'สาขา',
                          data: 'ReferenceDetail',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      },
                      {
                          title: 'BalancePH',
                          data: 'BalancePH',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'Lapse โดยลูกค้า',
                          data: 'LapseCust',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'Lapse จัดเก็บ',
                          data: 'LapseStudyArea',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'รวม',
                          data: 'LapseAll',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: '% Lapse',
                          data: 'Value',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'LG',
                          data: 'ValueString',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      }
        ];
        $('#table-branch-lapse').empty();
        const table = $('#table-branch-lapse').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerBranch")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //Branch PSG
    const loadDatatablesBranch_PSG = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                      {
                          title: 'ลำดับ',
                          data: 'RankNo',
                          orderable: false,
                          className: 'h-dt-center d-dt-center'

                      },
                      {
                          title: 'สาขา',
                          data: 'ReferenceDetail',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      },
                      {
                          title: 'Balance',
                          data: 'BalanceReceive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'หักไม่ได้',
                          data: 'UnReceive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'หักได้',
                          data: 'Receive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: '%หักได้',
                          data: 'Value',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'เกรด',
                          data: 'ValueString',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      }
        ];
        $('#table-branch-psg').empty();
        const table = $('#table-branch-psg').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerBranch")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //Branch POG
    const loadDatatablesBranch_POG = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                      {
                          title: 'ลำดับ',
                          data: 'RankNo',
                          orderable: false,
                          className: 'h-dt-center d-dt-center'

                      },
                      {
                          title: 'สาขา',
                          data: 'ReferenceDetail',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      },
                      {
                          title: 'ขึ้นจัดเก็บ',
                          data: 'BalanceReceive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'เก็บได้',
                          data: 'Receive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'เก็บไม่ได้',
                          data: 'UnReceive',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: '%ที่เก็บไม่ได้',
                          data: 'Value',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'เกรด',
                          data: 'ValueString',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      }
        ];
        $('#table-branch-pog').empty();
        const table = $('#table-branch-pog').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerBranch")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }

    //Branch UDW
    const loadDatatablesBranch_UDW = (period, productGroupCode, refCode, gradeTypeId, referanceTypeId, pageStart) => {
        var deferred = $.Deferred();
        var columns = [
                      {
                          title: 'ลำดับ',
                          data: 'RankNo',
                          orderable: false,
                          className: 'h-dt-center d-dt-center'

                      },
                      {
                          title: 'สาขา',
                          data: 'ReferenceDetail',
                          orderable: true,
                          className: 'h-dt-center d-dt-center'
                      },
                      {
                          title: 'คัดกรองผ่าน',
                          data: 'UdwPass',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'คัดกรองไม่ผ่าน',
                          data: 'UdwUnPass',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'ระหว่างตรวจสอบ',
                          data: 'UdwWait',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: 'NewApp',
                          data: 'UdwAll',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      },
                      {
                          title: '%คัดกรองไม่ผ่าน',
                          data: 'Value',
                          orderable: true,
                          className: 'h-dt-center d-dt-right'
                      }
        ];
        $('#table-branch-udw').empty();
        const table = $('#table-branch-udw').DataTable({
            pageLength: 10,
            processing: true,
            serverSide: true,
            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            const data = row.data();
                            return 'รายละเอียด : ' + data.ReferenceDetail;
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: 'table'
                    })
                }
            },
            destroy: true,
            lengthChange: false,
            searching: false,
            ordering: false,
            info: true,
            paging: true,
            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.10.19/i18n/Thai.json',
                select: {
                    rows: "เลือก %d แถว "
                }
            },
            select: false,
            displayStart: pageStart * 10,
            ajax: {
                url: '@Url.Action("GetRankPayerBranch")',
                type: "POST",
                data: function (d) {
                    d.draw = 1;
                    d.pageSize = d.length;
                    d.indexStart = d.start;
                    d.search = d.search.value;
                    d.period = period;
                    d.productGroupCode = productGroupCode;
                    d.referanceCode = refCode;
                    d.gradeTypeId = gradeTypeId;
                    d.referanceTypeId = referanceTypeId;
                }
            },
            columnDefs: [
                {
                    searchable: false,
                    orderable: false,
                    targets: 0
                }
            ],
            columns: columns,
            createdRow: function (row, data) {
                if (data.ReferenceCode === refCode) {
                    $('td', row).addClass('selected');
                }
            }
        });
        deferred.resolve();// เรียกเฉพาะเมื่อทำงานสำเร็จแล้วเท่านั้น.
        return deferred.promise();
    }
    /*********************END FUNCTION******************/

    /*********************Bar Chart********************/
    const drawGraph = () => {
        const ctx = document.getElementById("myChart").getContext("2d");
        window.myBar = new Chart(ctx,
            {
                type: "bar",
                data: barChartData1,
                options: chartOptions1
            });

        var ctx2 = document.getElementById("myChart2").getContext("2d");
        window.myBar2 = new Chart(ctx2,
            {
                type: "bar",
                data: barChartData2,
                options: chartOptions2
            });
    }

    const getBranchGraph = (config) => {
        const newDataset = [
            {
                label: "เป้าที่ตั้งไว้",
                backgroundColor: "pink",
                borderColor: "red",
                borderWidth: 1,
                data: []
            },
            {
                label: "ผลงานที่ได้",
                backgroundColor: "lightblue",
                borderColor: "blue",
                borderWidth: 1,
                data: []
            }
        ];
        var deferred = $.get('@Url.Action("GetBranchGraph")',
            {
                branchCode: '@ViewBag.BranchCode',
                period: $('#select-period-branch').val()
            },
            function (data) {
                config.labels = [];
                config.datasets = [];

                for (let key in data) {
                    if (data.hasOwnProperty(key)) {
                        /*push key to labels*/
                        const n = Number(key) + 1;
                        config.labels.push("สัปดาห์ที่ " + n);
                        /*push data to array*/
                        newDataset[0].data.push(data[key].Target);
                        newDataset[1].data.push(data[key].Value);
                        /*push color to array*/
                        // newDataset.backgroundColor.push();
                    }
                }
                config.datasets.push(newDataset[0]);
                config.datasets.push(newDataset[1]);
                /*update*/
                window.myBar.update();
            });
        return deferred;
    }

    const getBranchGraph2 = (config) => {
        const newDataset = [
            {
                label: "เป้าที่ตั้งไว้",
                backgroundColor: "pink",
                borderColor: "red",
                borderWidth: 1,
                data: []
            },
            {
                label: "ผลงานที่ได้",
                backgroundColor: "lightblue",
                borderColor: "blue",
                borderWidth: 1,
                data: []
            }
        ];
        var deferred = $.get('@Url.Action("GetBranchGraph")',
            {
                branchCode: '@ViewBag.BranchCode',
                period: $('#select-period-branch').val()
            },
        function (data) {
            const arrTarget = [];
            const arrValue = [];

            config.labels = [];
            config.datasets = [];

            for (let key in data) {
                if (data.hasOwnProperty(key)) {
                    /*push data to array*/
                    arrTarget.push(Number(data[key].Target));
                    arrValue.push(Number(data[key].Value));
                }
            }

            newDataset[0].data.push(arrTarget.reduce((target, current) =>  target + current));
            newDataset[1].data.push(arrValue.reduce((target, current) => target + current));

            config.datasets.push(newDataset[0]);
            config.datasets.push(newDataset[1]);
            /*update*/
            window.myBar2.update();
        });
        return deferred;
    }

    /*******CHART TARGET*******/
    const drawGraphTarget = () => {
        const ctx = document.getElementById("myChartTarget").getContext("2d");
        window.myBar = new Chart(ctx,
            {
                type: "bar",
                data: barChartData1,
                options: chartOptions1
            });

        var ctx2 = document.getElementById("myChartTarget2").getContext("2d");
        window.myBar2 = new Chart(ctx2,
            {
                type: "bar",
                data: barChartData2,
                options: chartOptions2
            });
    }

    const getAppGraphTarget = (config) => {
        const newDataset = [
            {
                label: "เป้าที่ตั้งไว้",
                backgroundColor: "pink",
                borderColor: "red",
                borderWidth: 1,
                data: []
            },
            {
                label: "ผลงานที่ได้",
                backgroundColor: "lightblue",
                borderColor: "blue",
                borderWidth: 1,
                data: []
            }
        ];
        var deferred = $.get('@Url.Action("GetAppTarget")',
            {
                period: $('#select-period-target').val(),
                productGroupCode: $('#select-productgroup-target').val(),
                refTypeId: $('#select-viewtype-target').val()
            },
            function (data) {
                config.labels = [];
                config.datasets = [];
                for (let key in data) {
                    if (data.hasOwnProperty(key)) {
                        /*push key to labels*/
                        const n = Number(key) + 1;
                        config.labels.push("สัปดาห์ที่ " + n);
                        /*push data to array*/
                        newDataset[0].data.push(data[key].Target);
                        newDataset[1].data.push(data[key].Value);
                        /*push color to array*/
                        // newDataset.backgroundColor.push();
                    }
                }
                config.datasets.push(newDataset[0]);
                config.datasets.push(newDataset[1]);
                /*update*/
                window.myBar.update();
            });
        return deferred;
    }

    const getAppGraphTarget2 = (config) => {
        const newDataset = [
            {
                label: "เป้าที่ตั้งไว้",
                backgroundColor: "pink",
                borderColor: "red",
                borderWidth: 1,
                data: []
            },
            {
                label: "ผลงานที่ได้",
                backgroundColor: "lightblue",
                borderColor: "blue",
                borderWidth: 1,
                data: []
            }
        ];
        var deferred = $.get('@Url.Action("GetAppTarget")',
            {
                period: $('#select-period-target').val(),
                productGroupCode: $('#select-productgroup-target').val(),
                refTypeId: $('#select-viewtype-target').val()
            },
        function (data) {
            const arrTarget = [];
            const arrValue = [];

            config.labels = [];
            config.datasets = [];

            for (let key in data) {
                if (data.hasOwnProperty(key)) {
                    /*push data to array*/
                    arrTarget.push(Number(data[key].Target));
                    arrValue.push(Number(data[key].Value));
                }
            }

            newDataset[0].data.push(arrTarget.reduce((target, current) => target + current));
            newDataset[1].data.push(arrValue.reduce((target, current) => target + current));

            config.datasets.push(newDataset[0]);
            config.datasets.push(newDataset[1]);
            /*update*/
            window.myBar2.update();
        });
        return deferred;
    }
    /*******END CHART TARGET*******/

    var barChartData1 = {
        labels: [],
        datasets: []
    };

    var barChartData2 = {
        labels: [],
        datasets: []
    };

    var chartOptions1 = {
        plugins: {
            // Change options for ALL labels of THIS CHART
            datalabels: {
                anchor: 'end',
                clamp: true,
                align: 'end',
                color: '#000000'
            }
        },
        responsive: true,
        legend: {
            position: "bottom"
        },
        title: {
            display: true,
            padding: 20,
            text: "เป้าต่อสัปดาห์"
        },
        scales: {
            yAxes: [
                {
                    ticks: {
                        beginAtZero: true
                    }
                }
            ]
        }
    }

    var chartOptions2 = {
        plugins: {
            // Change options for ALL labels of THIS CHART
            datalabels: {
                anchor: 'end',
                clamp: true,
                align: 'end',
                color: '#000000'
            }
        },
        responsive: true,
        legend: {
            position: "bottom"
        },
        title: {
            display: true,
            padding: 20,
            text: "เป้ารายเดือน"
        },
        scales: {
            yAxes: [
                {
                    ticks: {
                        beginAtZero: true
                    }
                }
            ],
            xAxes: [
                {
                    categoryPercentage: 1,
                    barPercentage: 0.5,
                    //barThickness: 6,
                    //maxBarThickness: 8,
                    //minBarLength: 2,
                    gridLines: {
                        offsetGridLines: true
                    }
                }
            ]
        }
    };
    /*********************END Chart********************/
</script>